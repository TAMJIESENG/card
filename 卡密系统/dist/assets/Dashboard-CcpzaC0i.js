import{_ as ye,U as Se,r as x,P as re,o as ge,h as r,a as z,d as y,e,w as t,f as a,t as m,i as n,u as $,V as Ie,F as $e,g as xe,W as Ee,X as He,Y as ve,R as k,b as I,B as Qe,Q as je,Z as Ue,p as Ce,k as J,$ as Le,a0 as ke,l as Ne,c as de,a1 as Re,a2 as Je,a3 as Fe,a4 as De,z as Ge,a5 as he,a6 as qe,a7 as Te,a8 as Ye,C as We,D as Ze,G as Me,a9 as Ke,H as Xe,I as et}from"./index-ihp2IIuf.js";import{useVipStore as tt}from"./vip-BiGGnL87.js";import{u as lt,O as at}from"./contact-BhUA68-k.js";const st={class:"card-generator"},ot={class:"card-header"},nt={class:"generator-stats"},rt={class:"stat-item"},ut={class:"stat-number"},it={class:"stat-item"},dt={class:"stat-number"},pt={class:"stat-item"},mt={class:"stat-number"},ct={class:"stat-item"},_t={class:"stat-number"},ft={class:"quick-actions"},vt={class:"generate-preview"},yt={class:"preview-info"},gt={class:"preview-info"},bt={class:"generate-result"},wt={class:"result-header"},Ct={class:"result-actions"},kt={class:"card-list"},$t={__name:"CardGenerator",setup(be){const V=Se(),S=x(!1),A=x(!1),O=x(),M=x(!1),T=x([]),q=re({totalGenerated:156,unusedCount:89,usedCount:52,expiredCount:15}),u=re({type:"",quantity:10,value:"",batchId:"",expireTime:null}),P=[{label:"月卡",value:"monthly"},{label:"季卡",value:"quarterly"},{label:"年卡",value:"yearly"}],U={type:[{required:!0,message:"请选择卡密类型",trigger:"change"}],quantity:[{required:!0,message:"请输入生成数量",trigger:"blur"}],value:[{required:!0,message:"请输入卡密面值",trigger:"blur"},{pattern:/^\d+(\.\d{1,2})?$/,message:"请输入正确的金额格式",trigger:"blur"}]},Z=H=>{const o=P.find(c=>c.value===H);return o?o.label:""},N=()=>u.value&&u.quantity?(parseFloat(u.value)*u.quantity).toFixed(2):"0.00",L=async(H,o)=>{const c={monthly:"29.90",quarterly:"79.90",yearly:"299.90"};M.value=!0;try{const R=await V.generateCards({type:H,quantity:o,value:c[H]});R.success?(k.success(R.message),T.value=R.data.cards,A.value=!0,te()):k.error(R.message)}finally{M.value=!1}},E=async()=>{O.value&&await O.value.validate(async H=>{if(H){M.value=!0;try{const o=await V.generateCards(u);o.success?(k.success(o.message),T.value=o.data.cards,S.value=!1,A.value=!0,te()):k.error(o.message)}finally{M.value=!1}}})},W=()=>{u.type="",u.quantity=10,u.value="",u.batchId="",u.expireTime=null,O.value&&O.value.clearValidate()},B=async H=>{try{await navigator.clipboard.writeText(H),k.success("卡号已复制到剪贴板")}catch{k.error("复制失败")}},se=async()=>{const H=T.value.map(o=>o.cardNumber).join(`
`);try{await navigator.clipboard.writeText(H),k.success("所有卡号已复制到剪贴板")}catch{k.error("复制失败")}},oe=()=>{V.exportCards(T.value),k.success("导出成功")},te=()=>{q.totalGenerated+=T.value.length,q.unusedCount+=T.value.length};return ge(()=>{}),(H,o)=>{const c=r("el-icon"),R=r("el-button"),D=r("el-col"),le=r("el-row"),C=r("el-card"),s=r("el-option"),ae=r("el-select"),p=r("el-form-item"),i=r("el-input-number"),F=r("el-input"),G=r("el-date-picker"),K=r("el-form"),Q=r("el-dialog"),j=r("el-table-column"),Y=r("el-table");return y(),z("div",st,[e(C,null,{header:t(()=>[a("div",ot,[o[14]||(o[14]=a("span",null,"卡密生成器",-1)),e(R,{type:"primary",onClick:o[0]||(o[0]=_=>S.value=!0)},{default:t(()=>[e(c,null,{default:t(()=>[e($(Ie))]),_:1}),o[13]||(o[13]=n(" 生成卡密 ",-1))]),_:1,__:[13]})])]),default:t(()=>[a("div",nt,[e(le,{gutter:20},{default:t(()=>[e(D,{span:6},{default:t(()=>[a("div",rt,[a("div",ut,m(q.totalGenerated),1),o[15]||(o[15]=a("div",{class:"stat-label"},"总生成数",-1))])]),_:1}),e(D,{span:6},{default:t(()=>[a("div",it,[a("div",dt,m(q.unusedCount),1),o[16]||(o[16]=a("div",{class:"stat-label"},"未使用",-1))])]),_:1}),e(D,{span:6},{default:t(()=>[a("div",pt,[a("div",mt,m(q.usedCount),1),o[17]||(o[17]=a("div",{class:"stat-label"},"已使用",-1))])]),_:1}),e(D,{span:6},{default:t(()=>[a("div",ct,[a("div",_t,m(q.expiredCount),1),o[18]||(o[18]=a("div",{class:"stat-label"},"已过期",-1))])]),_:1})]),_:1})]),a("div",ft,[o[22]||(o[22]=a("h4",null,"快捷生成",-1)),e(le,{gutter:12},{default:t(()=>[e(D,{span:8},{default:t(()=>[e(R,{type:"success",class:"quick-btn",onClick:o[1]||(o[1]=_=>L("monthly",10)),loading:M.value},{default:t(()=>o[19]||(o[19]=[n(" 生成10张月卡 ",-1)])),_:1,__:[19]},8,["loading"])]),_:1}),e(D,{span:8},{default:t(()=>[e(R,{type:"warning",class:"quick-btn",onClick:o[2]||(o[2]=_=>L("quarterly",5)),loading:M.value},{default:t(()=>o[20]||(o[20]=[n(" 生成5张季卡 ",-1)])),_:1,__:[20]},8,["loading"])]),_:1}),e(D,{span:8},{default:t(()=>[e(R,{type:"danger",class:"quick-btn",onClick:o[3]||(o[3]=_=>L("yearly",2)),loading:M.value},{default:t(()=>o[21]||(o[21]=[n(" 生成2张年卡 ",-1)])),_:1,__:[21]},8,["loading"])]),_:1})]),_:1})])]),_:1}),e(Q,{modelValue:S.value,"onUpdate:modelValue":o[10]||(o[10]=_=>S.value=_),title:"批量生成卡密",width:"500px",onClose:W},{footer:t(()=>[e(R,{onClick:o[9]||(o[9]=_=>S.value=!1)},{default:t(()=>o[26]||(o[26]=[n("取消",-1)])),_:1,__:[26]}),e(R,{type:"primary",onClick:E,loading:M.value},{default:t(()=>o[27]||(o[27]=[n(" 确认生成 ",-1)])),_:1,__:[27]},8,["loading"])]),default:t(()=>[e(K,{model:u,rules:U,ref_key:"generateFormRef",ref:O,"label-width":"100px"},{default:t(()=>[e(p,{label:"卡密类型",prop:"type"},{default:t(()=>[e(ae,{modelValue:u.type,"onUpdate:modelValue":o[4]||(o[4]=_=>u.type=_),placeholder:"请选择卡密类型",class:"full-width"},{default:t(()=>[(y(),z($e,null,xe(P,_=>e(s,{key:_.value,label:_.label,value:_.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"生成数量",prop:"quantity"},{default:t(()=>[e(i,{modelValue:u.quantity,"onUpdate:modelValue":o[5]||(o[5]=_=>u.quantity=_),min:1,max:1e3,step:1,class:"full-width"},null,8,["modelValue"])]),_:1}),e(p,{label:"卡密面值",prop:"value"},{default:t(()=>[e(F,{modelValue:u.value,"onUpdate:modelValue":o[6]||(o[6]=_=>u.value=_),placeholder:"请输入面值",class:"full-width"},{prefix:t(()=>o[23]||(o[23]=[n("¥",-1)])),_:1},8,["modelValue"])]),_:1}),e(p,{label:"批次标识"},{default:t(()=>[e(F,{modelValue:u.batchId,"onUpdate:modelValue":o[7]||(o[7]=_=>u.batchId=_),placeholder:"可选，用于标识这批卡密",class:"full-width"},null,8,["modelValue"])]),_:1}),e(p,{label:"有效期"},{default:t(()=>[e(G,{modelValue:u.expireTime,"onUpdate:modelValue":o[8]||(o[8]=_=>u.expireTime=_),type:"datetime",placeholder:"选择过期时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",class:"full-width"},null,8,["modelValue"])]),_:1}),e(p,null,{default:t(()=>[a("div",vt,[a("div",yt,[o[24]||(o[24]=a("span",null,"预计生成：",-1)),a("strong",null,m(u.quantity)+" 张"+m(Z(u.type)),1)]),a("div",gt,[o[25]||(o[25]=a("span",null,"总价值：",-1)),a("strong",null,"¥"+m(N()),1)])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(Q,{modelValue:A.value,"onUpdate:modelValue":o[12]||(o[12]=_=>A.value=_),title:"生成结果",width:"600px","close-on-click-modal":!1},{footer:t(()=>[e(R,{type:"primary",onClick:o[11]||(o[11]=_=>A.value=!1)},{default:t(()=>o[32]||(o[32]=[n(" 完成 ",-1)])),_:1,__:[32]})]),default:t(()=>[a("div",bt,[a("div",wt,[e(c,{class:"success-icon",color:"#67C23A"},{default:t(()=>[e($(Ee))]),_:1}),o[28]||(o[28]=a("h3",null,"生成成功！",-1)),a("p",null,"已成功生成 "+m(T.value.length)+" 张卡密",1)]),a("div",Ct,[e(R,{type:"primary",onClick:oe},{default:t(()=>[e(c,null,{default:t(()=>[e($(He))]),_:1}),o[29]||(o[29]=n(" 导出卡密 ",-1))]),_:1,__:[29]}),e(R,{onClick:se},{default:t(()=>[e(c,null,{default:t(()=>[e($(ve))]),_:1}),o[30]||(o[30]=n(" 复制所有 ",-1))]),_:1,__:[30]})]),a("div",kt,[e(Y,{data:T.value,"max-height":"300"},{default:t(()=>[e(j,{prop:"cardNumber",label:"卡号"}),e(j,{prop:"cardType",label:"类型",width:"80"}),e(j,{prop:"value",label:"面值",width:"80"}),e(j,{label:"操作",width:"100"},{default:t(_=>[e(R,{type:"text",size:"small",onClick:ee=>B(_.row.cardNumber)},{default:t(()=>o[31]||(o[31]=[n(" 复制 ",-1)])),_:2,__:[31]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])])]),_:1},8,["modelValue"])])}}},xt=ye($t,[["__scopeId","data-v-0c0afe35"]]),Vt={class:"card-query"},Tt={class:"query-form"},ht={key:0,class:"query-result"},St={key:0,class:"card-details"},Lt={class:"value-text"},Nt={class:"card-actions"},qt={key:1,class:"error-actions"},Mt={key:1,class:"query-history"},zt={class:"history-list"},It={class:"batch-query"},Ut={key:0,class:"batch-results"},Rt={__name:"CardQuery",setup(be){const V=Se(),S=x(),A=x(!1),O=x(!1),M=x(!1),T=x(!1),q=x(!1),u=x(null),P=x([]),U=x([]),Z=re({cardNumber:""}),N=re({cardNumbers:""}),L={cardNumber:[{required:!0,message:"请输入卡号",trigger:"blur"},{min:10,message:"卡号长度不能少于10位",trigger:"blur"}]},E=async()=>{S.value&&await S.value.validate(async p=>{if(p){A.value=!0;try{const i=await V.queryCard(Z.cardNumber);u.value=i,i.success?(o(Z.cardNumber),k.success("查询成功")):k.error(i.message)}finally{A.value=!1}}})},W=async()=>{if(!N.cardNumbers.trim()){k.error("请输入卡号");return}const p=N.cardNumbers.split(`
`).map(i=>i.trim()).filter(i=>i);if(p.length===0){k.error("请输入有效的卡号");return}T.value=!0,U.value=[];try{for(const i of p){const F=await V.queryCard(i);U.value.push({cardNumber:i,success:F.success,cardType:F.success?F.data.cardType:"",value:F.success?F.data.value:"",status:F.success?F.data.status:""})}k.success(`批量查询完成，共查询 ${p.length} 张卡密`)}finally{T.value=!1}},B=async p=>{try{await ke.confirm(`确认使用卡密 ${p}？使用后将无法撤销。`,"确认使用",{confirmButtonText:"确认使用",cancelButtonText:"取消",type:"warning"}),O.value=!0;const i=await V.useCard(p);i.success?(k.success(i.message),u.value.data.status="used",u.value.data.useTime=new Date().toLocaleString("zh-CN")):k.error(i.message)}catch{}finally{O.value=!1}},se=async p=>{try{await ke.confirm(`确认激活卡密 ${p}？激活后可正常使用。`,"确认激活",{confirmButtonText:"确认激活",cancelButtonText:"取消",type:"warning"}),M.value=!0;const i=await V.activateCard(p,u.value.data.purchasedBy);i.success?(k.success(i.message),u.value.data.status="used",u.value.data.useTime=new Date().toLocaleString("zh-CN")):k.error(i.message)}catch{}finally{M.value=!1}},oe=async p=>{try{await navigator.clipboard.writeText(p),k.success("卡号已复制到剪贴板")}catch{k.error("复制失败")}},te=()=>{u.value=null,Z.cardNumber="",S.value&&S.value.clearValidate()},H=p=>{Z.cardNumber=p,E()},o=p=>{P.value.includes(p)||(P.value.unshift(p),P.value.length>10&&P.value.pop(),localStorage.setItem("cardQueryHistory",JSON.stringify(P.value)))},c=p=>{P.value.splice(p,1),localStorage.setItem("cardQueryHistory",JSON.stringify(P.value))},R=()=>u.value?u.value.success?"success":"error":"info",D=()=>u.value?u.value.success?"查询成功":"查询失败":"",le=()=>{if(!u.value)return"";if(u.value.success){const p=u.value.data;return`找到卡密：${p.cardNumber}，状态：${s(p.status)}`}else return u.value.message},C=p=>V.getCardStatusType(p),s=p=>V.getCardStatusText(p),ae=p=>({月卡:"success",季卡:"warning",年卡:"danger"})[p]||"info";return ge(()=>{const p=localStorage.getItem("cardQueryHistory");if(p)try{P.value=JSON.parse(p)}catch{P.value=[]}}),(p,i)=>{const F=r("el-icon"),G=r("el-button"),K=r("el-input"),Q=r("el-form-item"),j=r("el-form"),Y=r("el-descriptions-item"),_=r("el-tag"),ee=r("el-descriptions"),d=r("el-result"),l=r("el-card"),f=r("el-table-column"),v=r("el-table"),b=r("el-dialog");return y(),z("div",Vt,[e(l,null,{header:t(()=>i[7]||(i[7]=[a("span",null,"卡密查询",-1)])),default:t(()=>[a("div",Tt,[e(j,{model:Z,rules:L,ref_key:"queryFormRef",ref:S,onSubmit:Qe(E,["prevent"])},{default:t(()=>[e(Q,{prop:"cardNumber"},{default:t(()=>[e(K,{modelValue:Z.cardNumber,"onUpdate:modelValue":i[0]||(i[0]=h=>Z.cardNumber=h),placeholder:"请输入卡号进行查询",size:"large",clearable:"",onKeyup:je(E,["enter"])},{prefix:t(()=>[e(F,null,{default:t(()=>[e($(Ce))]),_:1})]),append:t(()=>[e(G,{type:"primary",onClick:E,loading:A.value},{default:t(()=>[e(F,null,{default:t(()=>[e($(Ue))]),_:1}),i[8]||(i[8]=n(" 查询 ",-1))]),_:1,__:[8]},8,["loading"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),u.value?(y(),z("div",ht,[e(d,{icon:R(),title:D(),"sub-title":le()},{extra:t(()=>[u.value.success?(y(),z("div",St,[e(ee,{column:2,border:""},{default:t(()=>[e(Y,{label:"卡号"},{default:t(()=>[n(m(u.value.data.cardNumber)+" ",1),e(G,{type:"text",size:"small",onClick:i[1]||(i[1]=h=>oe(u.value.data.cardNumber)),style:{"margin-left":"8px"}},{default:t(()=>[e(F,null,{default:t(()=>[e($(ve))]),_:1})]),_:1})]),_:1}),e(Y,{label:"类型"},{default:t(()=>[e(_,{type:ae(u.value.data.cardType)},{default:t(()=>[n(m(u.value.data.cardType),1)]),_:1},8,["type"])]),_:1}),e(Y,{label:"面值"},{default:t(()=>[a("span",Lt,m(u.value.data.value),1)]),_:1}),e(Y,{label:"状态"},{default:t(()=>[e(_,{type:C(u.value.data.status)},{default:t(()=>[n(m(s(u.value.data.status)),1)]),_:1},8,["type"])]),_:1}),e(Y,{label:"创建时间"},{default:t(()=>[n(m(u.value.data.createTime),1)]),_:1}),e(Y,{label:"过期时间"},{default:t(()=>[n(m(u.value.data.expireTime||"永久有效"),1)]),_:1}),u.value.data.useTime?(y(),J(Y,{key:0,label:"使用时间"},{default:t(()=>[n(m(u.value.data.useTime),1)]),_:1})):I("",!0),u.value.data.useTime?(y(),J(Y,{key:1,label:"使用用户"},{default:t(()=>[n(m(u.value.data.username||"未知"),1)]),_:1})):I("",!0),u.value.data.purchaser?(y(),J(Y,{key:2,label:"购买用户"},{default:t(()=>[n(m(u.value.data.purchaser),1)]),_:1})):I("",!0),u.value.data.purchaseTime?(y(),J(Y,{key:3,label:"购买时间"},{default:t(()=>[n(m(u.value.data.purchaseTime),1)]),_:1})):I("",!0)]),_:1}),a("div",Nt,[u.value.data.status==="unused"?(y(),J(G,{key:0,type:"primary",onClick:i[2]||(i[2]=h=>B(u.value.data.cardNumber)),loading:O.value},{default:t(()=>[e(F,null,{default:t(()=>[e($(Ce))]),_:1}),i[9]||(i[9]=n(" 使用此卡密 ",-1))]),_:1,__:[9]},8,["loading"])):I("",!0),u.value.data.status==="sold"&&u.value.data.purchasedBy?(y(),J(G,{key:1,type:"success",onClick:i[3]||(i[3]=h=>se(u.value.data.cardNumber)),loading:M.value},{default:t(()=>[e(F,null,{default:t(()=>[e($(Ce))]),_:1}),i[10]||(i[10]=n(" 激活此卡密 ",-1))]),_:1,__:[10]},8,["loading"])):I("",!0),e(G,{onClick:te},{default:t(()=>[e(F,null,{default:t(()=>[e($(Le))]),_:1}),i[11]||(i[11]=n(" 查询其他 ",-1))]),_:1,__:[11]})])])):(y(),z("div",qt,[e(G,{type:"primary",onClick:te},{default:t(()=>i[12]||(i[12]=[n(" 重新查询 ",-1)])),_:1,__:[12]})]))]),_:1},8,["icon","title","sub-title"])])):I("",!0),P.value.length>0?(y(),z("div",Mt,[i[13]||(i[13]=a("h4",null,"最近查询",-1)),a("div",zt,[(y(!0),z($e,null,xe(P.value,(h,X)=>(y(),J(_,{key:X,class:"history-item",type:"info",closable:"",onClose:ne=>c(X),onClick:ne=>H(h)},{default:t(()=>[n(m(h),1)]),_:2},1032,["onClose","onClick"]))),128))])])):I("",!0)]),_:1}),e(b,{modelValue:q.value,"onUpdate:modelValue":i[6]||(i[6]=h=>q.value=h),title:"批量查询",width:"600px"},{footer:t(()=>[e(G,{onClick:i[5]||(i[5]=h=>q.value=!1)},{default:t(()=>i[15]||(i[15]=[n("关闭",-1)])),_:1,__:[15]}),e(G,{type:"primary",onClick:W,loading:T.value},{default:t(()=>i[16]||(i[16]=[n(" 批量查询 ",-1)])),_:1,__:[16]},8,["loading"])]),default:t(()=>[a("div",It,[e(j,null,{default:t(()=>[e(Q,{label:"卡号列表"},{default:t(()=>[e(K,{modelValue:N.cardNumbers,"onUpdate:modelValue":i[4]||(i[4]=h=>N.cardNumbers=h),type:"textarea",rows:6,placeholder:"请输入卡号，每行一个"},null,8,["modelValue"])]),_:1})]),_:1}),U.value.length>0?(y(),z("div",Ut,[i[14]||(i[14]=a("h4",null,"查询结果",-1)),e(v,{data:U.value,"max-height":"300"},{default:t(()=>[e(f,{prop:"cardNumber",label:"卡号"}),e(f,{prop:"status",label:"状态"},{default:t(h=>[e(_,{type:h.row.success?"success":"danger"},{default:t(()=>[n(m(h.row.success?"找到":"未找到"),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"cardType",label:"类型"}),e(f,{prop:"value",label:"面值"})]),_:1},8,["data"])])):I("",!0)])]),_:1},8,["modelValue"])])}}},Ft=ye(Rt,[["__scopeId","data-v-22cd1bc2"]]),Dt={class:"contact-admin"},Pt={class:"card-header"},Bt={class:"submit-form"},At={class:"contact-history"},Ot={key:0,class:"contact-detail"},Et={class:"message-content"},Ht={key:0,class:"admin-reply"},Qt={class:"reply-content"},jt={class:"reply-meta"},Jt={class:"reply-time"},Gt={class:"reply-message"},Yt={key:1,class:"no-reply"},Wt={__name:"ContactAdmin",setup(be){const V=lt(),S=Ne(),A=x("submit"),O=x(!1),M=x(!1),T=x(null),q=x(),u=de(()=>V.contacts),P=de(()=>V.loading),U=re({category:"",priority:"normal",subject:"",message:"",email:""}),Z={category:[{required:!0,message:"请选择问题类别",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],subject:[{required:!0,message:"请输入问题标题",trigger:"blur"},{min:5,max:100,message:"标题长度在 5 到 100 个字符",trigger:"blur"}],message:[{required:!0,message:"请详细描述问题",trigger:"blur"},{min:10,max:1e3,message:"描述长度在 10 到 1000 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入联系邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},N=async()=>{q.value&&await q.value.validate(async o=>{if(o){O.value=!0;try{const c=S.user;if(!c){k.error("请先登录");return}const R={...U,userId:c.id,username:c.username},D=await V.submitContact(R);D.success?(k.success(D.message),L(),A.value="history",W()):k.error(D.message)}finally{O.value=!1}}})},L=()=>{var o;Object.assign(U,{category:"",priority:"normal",subject:"",message:"",email:((o=S.user)==null?void 0:o.email)||""}),q.value&&q.value.clearValidate()},E=o=>{T.value=o,M.value=!0},W=async()=>{await V.fetchContacts(!1)},B=o=>V.getStatusType(o),se=o=>V.getStatusText(o),oe=o=>V.getPriorityType(o),te=o=>V.getPriorityText(o),H=o=>V.getCategoryText(o);return ge(()=>{var o;U.email=((o=S.user)==null?void 0:o.email)||"",W()}),(o,c)=>{const R=r("el-icon"),D=r("el-option"),le=r("el-select"),C=r("el-form-item"),s=r("el-radio"),ae=r("el-radio-group"),p=r("el-input"),i=r("el-button"),F=r("el-form"),G=r("el-tab-pane"),K=r("el-table-column"),Q=r("el-tag"),j=r("el-table"),Y=r("el-tabs"),_=r("el-card"),ee=r("el-descriptions-item"),d=r("el-descriptions"),l=r("el-empty"),f=r("el-dialog"),v=Re("loading");return y(),z("div",Dt,[e(_,null,{header:t(()=>[a("div",Pt,[e(R,{class:"header-icon"},{default:t(()=>[e($(De))]),_:1}),c[8]||(c[8]=a("span",null,"联系管理员",-1))])]),default:t(()=>[e(Y,{modelValue:A.value,"onUpdate:modelValue":c[5]||(c[5]=b=>A.value=b),type:"border-card"},{default:t(()=>[e(G,{label:"提交问题",name:"submit"},{default:t(()=>[a("div",Bt,[e(F,{model:U,rules:Z,ref_key:"contactFormRef",ref:q,"label-width":"100px"},{default:t(()=>[e(C,{label:"问题类别",prop:"category"},{default:t(()=>[e(le,{modelValue:U.category,"onUpdate:modelValue":c[0]||(c[0]=b=>U.category=b),placeholder:"请选择问题类别"},{default:t(()=>[e(D,{label:"技术问题",value:"technical"}),e(D,{label:"账户问题",value:"account"}),e(D,{label:"支付问题",value:"payment"}),e(D,{label:"卡密问题",value:"card"}),e(D,{label:"意见建议",value:"suggestion"}),e(D,{label:"投诉举报",value:"complaint"}),e(D,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"优先级",prop:"priority"},{default:t(()=>[e(ae,{modelValue:U.priority,"onUpdate:modelValue":c[1]||(c[1]=b=>U.priority=b)},{default:t(()=>[e(s,{label:"low"},{default:t(()=>c[9]||(c[9]=[n("一般",-1)])),_:1,__:[9]}),e(s,{label:"normal"},{default:t(()=>c[10]||(c[10]=[n("普通",-1)])),_:1,__:[10]}),e(s,{label:"high"},{default:t(()=>c[11]||(c[11]=[n("紧急",-1)])),_:1,__:[11]}),e(s,{label:"urgent"},{default:t(()=>c[12]||(c[12]=[n("非常紧急",-1)])),_:1,__:[12]})]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"问题标题",prop:"subject"},{default:t(()=>[e(p,{modelValue:U.subject,"onUpdate:modelValue":c[2]||(c[2]=b=>U.subject=b),placeholder:"请简要描述您的问题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(C,{label:"详细描述",prop:"message"},{default:t(()=>[e(p,{modelValue:U.message,"onUpdate:modelValue":c[3]||(c[3]=b=>U.message=b),type:"textarea",rows:6,placeholder:"请详细描述您遇到的问题，包括具体操作步骤、错误信息等",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(C,{label:"联系邮箱",prop:"email"},{default:t(()=>[e(p,{modelValue:U.email,"onUpdate:modelValue":c[4]||(c[4]=b=>U.email=b),placeholder:"用于接收回复通知",disabled:!0},null,8,["modelValue"])]),_:1}),e(C,null,{default:t(()=>[e(i,{type:"primary",onClick:N,loading:O.value},{default:t(()=>[e(R,null,{default:t(()=>[e($(Je))]),_:1}),c[13]||(c[13]=n(" 提交问题 ",-1))]),_:1,__:[13]},8,["loading"]),e(i,{onClick:L},{default:t(()=>[e(R,null,{default:t(()=>[e($(Le))]),_:1}),c[14]||(c[14]=n(" 重置 ",-1))]),_:1,__:[14]})]),_:1})]),_:1},8,["model"])])]),_:1}),e(G,{label:"提交记录",name:"history"},{default:t(()=>[a("div",At,[Fe((y(),J(j,{data:u.value,style:{width:"100%"}},{default:t(()=>[e(K,{prop:"subject",label:"问题标题","min-width":"200"}),e(K,{prop:"category",label:"类别",width:"120"},{default:t(b=>[n(m(H(b.row.category)),1)]),_:1}),e(K,{prop:"priority",label:"优先级",width:"100"},{default:t(b=>[e(Q,{type:oe(b.row.priority),size:"small"},{default:t(()=>[n(m(te(b.row.priority)),1)]),_:2},1032,["type"])]),_:1}),e(K,{prop:"status",label:"状态",width:"100"},{default:t(b=>[e(Q,{type:B(b.row.status)},{default:t(()=>[n(m(se(b.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(K,{prop:"createTime",label:"提交时间",width:"160"}),e(K,{prop:"replyTime",label:"回复时间",width:"160"},{default:t(b=>[n(m(b.row.replyTime||"-"),1)]),_:1}),e(K,{label:"操作",width:"120",fixed:"right"},{default:t(b=>[e(i,{type:"primary",size:"small",onClick:h=>E(b.row)},{default:t(()=>c[15]||(c[15]=[n(" 查看详情 ",-1)])),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[v,P.value]])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{modelValue:M.value,"onUpdate:modelValue":c[7]||(c[7]=b=>M.value=b),title:"问题详情",width:"700px"},{footer:t(()=>[e(i,{onClick:c[6]||(c[6]=b=>M.value=!1)},{default:t(()=>c[17]||(c[17]=[n("关闭",-1)])),_:1,__:[17]})]),default:t(()=>[T.value?(y(),z("div",Ot,[e(d,{column:2,border:""},{default:t(()=>[e(ee,{label:"问题标题",span:2},{default:t(()=>[n(m(T.value.subject),1)]),_:1}),e(ee,{label:"类别"},{default:t(()=>[n(m(H(T.value.category)),1)]),_:1}),e(ee,{label:"优先级"},{default:t(()=>[e(Q,{type:oe(T.value.priority),size:"small"},{default:t(()=>[n(m(te(T.value.priority)),1)]),_:1},8,["type"])]),_:1}),e(ee,{label:"状态"},{default:t(()=>[e(Q,{type:B(T.value.status)},{default:t(()=>[n(m(se(T.value.status)),1)]),_:1},8,["type"])]),_:1}),e(ee,{label:"提交时间"},{default:t(()=>[n(m(T.value.createTime),1)]),_:1}),e(ee,{label:"问题描述",span:2},{default:t(()=>[a("div",Et,m(T.value.message),1)]),_:1})]),_:1}),T.value.adminReply?(y(),z("div",Ht,[c[16]||(c[16]=a("h4",null,"管理员回复",-1)),a("div",Qt,[a("div",jt,[a("span",Jt,"回复时间: "+m(T.value.replyTime),1)]),a("div",Gt,m(T.value.adminReply),1)])])):(y(),z("div",Yt,[e(l,{description:"暂无回复","image-size":80})]))])):I("",!0)]),_:1},8,["modelValue"])])}}},Zt=ye(Wt,[["__scopeId","data-v-76b42d60"]]),ze="/assets/b89592612409de7b5878f9f32fdee8a4-DrtI88ac.jpg",Kt={class:"balance-recharge"},Xt={class:"balance-info"},el={class:"current-balance"},tl={class:"balance-content"},ll={class:"balance-amount"},al={class:"recharge-buttons"},sl={class:"card-header"},ol={class:"amount-text"},nl={class:"quick-amount"},rl={key:0,class:"no-payment-methods"},ul={class:"recharge-summary"},il={class:"summary-item"},dl={class:"amount"},pl={class:"summary-item"},ml={class:"amount final-amount"},cl={key:0,class:"recharge-detail"},_l={class:"amount-text"},fl={key:0,class:"payment-confirmation"},vl={class:"payment-info"},yl={class:"info-item"},gl={class:"amount"},bl={class:"info-item"},wl={class:"payment-notice"},Cl={class:"wechat-recharge"},kl={class:"wechat-info"},$l={class:"wechat-header"},xl={class:"wechat-details"},Vl={class:"wechat-id-section"},Tl={class:"wechat-id"},hl={class:"wechat-qr"},Sl={class:"qr-code"},Ll={class:"recharge-steps"},Nl={class:"recharge-notice"},ql={class:"wechat-footer"},Ml={class:"image-preview"},zl={class:"preview-info"},Il={__name:"BalanceRecharge",setup(be){const V=Ne(),S=x({alipay:!1,wechat:!1,bankTransfer:!1,paypal:!1}),A=de(()=>Object.values(S.value).some(d=>d)),O=x(!1),M=x(!1),T=x(!1),q=x(!1),u=x(!1),P=x(!1),U=x(!1),Z=x(!1),N=x(),L=x(null),E=x([]),W=re({currentPage:1,pageSize:10,total:0}),B=re({amount:"",paymentMethod:"alipay"}),se=[10,50,100,200,500,1e3],oe={amount:[{required:!0,message:"请输入充值金额",trigger:"blur"},{validator:(d,l,f)=>{const v=parseFloat(l);isNaN(v)||v<=0?f(new Error("充值金额必须大于0")):v<.01?f(new Error("最小充值金额为0.01元")):v>5e4?f(new Error("单次充值金额不能超过50000元")):f()},trigger:"blur"}],paymentMethod:[{required:!0,message:"请选择支付方式",trigger:"change"}]},te=()=>{const d=new Date,l=d.getFullYear(),f=String(d.getMonth()+1).padStart(2,"0"),v=String(d.getDate()).padStart(2,"0"),b=Date.now().toString().slice(-6);return`RCH${l}${f}${v}${b}`},H=async()=>{N.value&&await N.value.validate(async d=>{if(d){P.value=!0;try{const l=parseFloat(B.amount),f=te(),v={id:Date.now(),orderNumber:f,userId:V.user.id,username:V.user.username,amount:l,paymentMethod:B.paymentMethod,status:"pending",createTime:new Date().toLocaleString("zh-CN"),completeTime:null},b=JSON.parse(localStorage.getItem("all_recharges")||"[]");b.unshift(v),localStorage.setItem("all_recharges",JSON.stringify(b)),E.value.unshift(v),W.total++,k.success("充值订单创建成功"),O.value=!1,F(),L.value=v,T.value=!0}finally{P.value=!1}}})},o=d=>{L.value=d,T.value=!0},c=async()=>{U.value=!0;try{await new Promise(h=>setTimeout(h,1500));const d=L.value.id,l=L.value.amount,f=JSON.parse(localStorage.getItem("all_recharges")||"[]"),v=f.findIndex(h=>h.id===d);if(v!==-1){f[v].status="completed",f[v].completeTime=new Date().toLocaleString("zh-CN"),localStorage.setItem("all_recharges",JSON.stringify(f));const h=E.value.findIndex(X=>X.id===d);h!==-1&&(E.value[h].status="completed",E.value[h].completeTime=f[v].completeTime)}(await V.updateUserBalance(V.user.id,(V.user.balance||0)+l,`充值到账：${L.value.orderNumber}`)).success?(k.success(`充值成功！余额已增加 ¥${l.toFixed(2)}`),T.value=!1,await V.refreshCurrentUser()):k.error("余额更新失败")}finally{U.value=!1}},R=async d=>{try{await ke.confirm(`确认取消充值订单 ${d.orderNumber}？`,"确认取消",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const l=JSON.parse(localStorage.getItem("all_recharges")||"[]"),f=l.findIndex(v=>v.id===d.id);if(f!==-1){l[f].status="cancelled",l[f].completeTime=new Date().toLocaleString("zh-CN"),localStorage.setItem("all_recharges",JSON.stringify(l));const v=E.value.findIndex(b=>b.id===d.id);v!==-1&&(E.value[v].status="cancelled",E.value[v].completeTime=l[f].completeTime)}k.success("充值订单已取消")}catch{}},D=d=>{L.value=d,M.value=!0},le=d=>({alipay:"primary",wechat:"success",bank:"warning"})[d]||"info",C=d=>({alipay:"支付宝",wechat:"微信支付",bank:"银行转账",paypal:"PayPal"})[d]||d,s=d=>({pending:"warning",completed:"success",cancelled:"danger",failed:"danger"})[d]||"info",ae=d=>({pending:"待支付",completed:"已完成",cancelled:"已取消",failed:"支付失败"})[d]||"未知",p=()=>{Z.value=!0;try{const l=JSON.parse(localStorage.getItem("all_recharges")||"[]").filter(f=>{var v;return f.userId===((v=V.user)==null?void 0:v.id)});E.value=l,W.total=l.length}finally{Z.value=!1}},i=()=>{p(),k.success("充值记录已刷新")},F=()=>{B.amount="";const d=Object.entries(S.value).find(([l,f])=>f);B.paymentMethod=d?d[0]:"alipay"},G=()=>{var d,l,f,v,b,h;try{const X=localStorage.getItem("payment_settings");if(X){const ne=JSON.parse(X);S.value.alipay=((d=ne.alipay)==null?void 0:d.enabled)||!1,S.value.wechat=((l=ne.wechat)==null?void 0:l.enabled)||!1,S.value.bankTransfer=((v=(f=ne.other)==null?void 0:f.bankTransfer)==null?void 0:v.enabled)||!1,S.value.paypal=((h=(b=ne.other)==null?void 0:b.paypal)==null?void 0:h.enabled)||!1,console.log("💳 已加载支付设置:",S.value),Object.values(S.value).some(pe=>pe)||console.warn("⚠️ 所有支付方式都已禁用，充值功能受限")}else console.log("⚠️ 未找到支付设置，使用默认配置"),S.value.alipay=!0}catch(X){console.error("加载支付设置失败:",X),k.warning("加载支付设置失败，可能影响充值功能")}},K=d=>{W.pageSize=d},Q=d=>{W.currentPage=d},j=async()=>{const d="AQ0007N";try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(d),k.success("微信号已复制到剪贴板");else{const l=document.createElement("textarea");l.value=d,l.style.position="fixed",l.style.opacity="0",document.body.appendChild(l),l.focus(),l.select();try{if(document.execCommand("copy"))k.success("微信号已复制到剪贴板");else throw new Error("复制失败")}catch{k.warning(`请手动复制微信号：${d}`)}finally{document.body.removeChild(l)}}}catch{k.warning(`请手动复制微信号：${d}`)}},Y=d=>{const f=d.target.parentElement;f.innerHTML=`
    <div class="qr-fallback">
      <el-icon size="60" color="#909399"><Position /></el-icon>
      <p>二维码加载失败</p>
      <small>请手动搜索微信号：AQ0007N</small>
    </div>
  `},_=d=>{d.key==="payment_settings"&&(console.log("💳 检测到支付设置变更（跨标签页），重新加载..."),G(),F(),k.info("支付设置已更新"))},ee=d=>{console.log("💳 检测到支付设置变更（同标签页），重新加载...",d.detail),G(),F(),k.info("支付设置已更新")};return ge(()=>{V.user&&p(),G(),F(),window.addEventListener("storage",_),window.addEventListener("payment-settings-updated",ee)}),Ge(()=>{window.removeEventListener("storage",_),window.removeEventListener("payment-settings-updated",ee)}),(d,l)=>{const f=r("el-icon"),v=r("el-button"),b=r("el-card"),h=r("el-table-column"),X=r("el-tag"),ne=r("el-table"),we=r("el-pagination"),pe=r("el-input"),me=r("el-form-item"),w=r("el-radio"),ue=r("el-radio-group"),Ve=r("el-alert"),Pe=r("el-form"),ce=r("el-dialog"),ie=r("el-descriptions-item"),Be=r("el-descriptions"),_e=r("el-step"),Ae=r("el-steps"),Oe=Re("loading");return y(),z("div",Kt,[e(b,{class:"balance-card"},{default:t(()=>{var g;return[a("div",Xt,[a("div",el,[e(f,{class:"balance-icon"},{default:t(()=>[e($(he))]),_:1}),a("div",tl,[l[17]||(l[17]=a("h3",null,"当前余额",-1)),a("div",ll,"¥"+m((((g=$(V).user)==null?void 0:g.balance)||0).toFixed(2)),1)])]),a("div",al,[e(v,{type:"primary",onClick:l[0]||(l[0]=fe=>O.value=!0),disabled:!A.value},{default:t(()=>[e(f,null,{default:t(()=>[e($(Ie))]),_:1}),l[18]||(l[18]=n(" 在线充值 ",-1))]),_:1,__:[18]},8,["disabled"]),e(v,{type:"success",onClick:l[1]||(l[1]=fe=>q.value=!0)},{default:t(()=>[e(f,null,{default:t(()=>[e($(qe))]),_:1}),l[19]||(l[19]=n(" 微信充值 ",-1))]),_:1,__:[19]})])])]}),_:1}),e(b,{class:"recharge-history-card"},{header:t(()=>[a("div",sl,[l[21]||(l[21]=a("span",null,"充值记录",-1)),e(v,{size:"small",onClick:i},{default:t(()=>[e(f,null,{default:t(()=>[e($(Le))]),_:1}),l[20]||(l[20]=n(" 刷新 ",-1))]),_:1,__:[20]})])]),default:t(()=>[Fe((y(),J(ne,{data:E.value,style:{width:"100%"}},{default:t(()=>[e(h,{prop:"orderNumber",label:"充值订单号",width:"180"}),e(h,{prop:"amount",label:"充值金额",width:"120"},{default:t(g=>[a("span",ol,"+¥"+m(g.row.amount.toFixed(2)),1)]),_:1}),e(h,{prop:"paymentMethod",label:"支付方式",width:"120"},{default:t(g=>[e(X,{type:le(g.row.paymentMethod)},{default:t(()=>[n(m(C(g.row.paymentMethod)),1)]),_:2},1032,["type"])]),_:1}),e(h,{prop:"status",label:"状态",width:"100"},{default:t(g=>[e(X,{type:s(g.row.status)},{default:t(()=>[n(m(ae(g.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(h,{prop:"createTime",label:"创建时间",width:"160"}),e(h,{prop:"completeTime",label:"完成时间",width:"160"},{default:t(g=>[n(m(g.row.completeTime||"-"),1)]),_:1}),e(h,{label:"操作",width:"150",fixed:"right"},{default:t(g=>[g.row.status==="pending"?(y(),J(v,{key:0,type:"primary",size:"small",onClick:fe=>o(g.row)},{default:t(()=>l[22]||(l[22]=[n(" 完成支付 ",-1)])),_:2,__:[22]},1032,["onClick"])):I("",!0),g.row.status==="pending"?(y(),J(v,{key:1,type:"danger",size:"small",onClick:fe=>R(g.row)},{default:t(()=>l[23]||(l[23]=[n(" 取消 ",-1)])),_:2,__:[23]},1032,["onClick"])):I("",!0),e(v,{type:"info",size:"small",onClick:fe=>D(g.row)},{default:t(()=>l[24]||(l[24]=[n(" 详情 ",-1)])),_:2,__:[24]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Oe,Z.value]]),e(we,{"current-page":W.currentPage,"onUpdate:currentPage":l[2]||(l[2]=g=>W.currentPage=g),"page-size":W.pageSize,"onUpdate:pageSize":l[3]||(l[3]=g=>W.pageSize=g),"page-sizes":[10,20,50],total:W.total,layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:K,onCurrentChange:Q},null,8,["current-page","page-size","total"])]),_:1}),e(ce,{modelValue:O.value,"onUpdate:modelValue":l[7]||(l[7]=g=>O.value=g),title:"账户充值",width:"500px"},{footer:t(()=>[e(v,{onClick:l[6]||(l[6]=g=>O.value=!1)},{default:t(()=>l[34]||(l[34]=[n("取消",-1)])),_:1,__:[34]}),e(v,{type:"primary",onClick:H,loading:P.value,disabled:!A.value},{default:t(()=>l[35]||(l[35]=[n(" 确认充值 ",-1)])),_:1,__:[35]},8,["loading","disabled"])]),default:t(()=>[e(Pe,{model:B,rules:oe,ref_key:"rechargeFormRef",ref:N,"label-width":"100px"},{default:t(()=>[e(me,{label:"充值金额",prop:"amount"},{default:t(()=>[e(pe,{modelValue:B.amount,"onUpdate:modelValue":l[4]||(l[4]=g=>B.amount=g),placeholder:"请输入充值金额",type:"number",min:"0.01",step:"0.01"},{prepend:t(()=>l[25]||(l[25]=[n("¥",-1)])),_:1},8,["modelValue"]),a("div",nl,[l[26]||(l[26]=a("span",null,"快速选择：",-1)),(y(),z($e,null,xe(se,g=>e(v,{key:g,size:"small",onClick:fe=>B.amount=g},{default:t(()=>[n(" ¥"+m(g),1)]),_:2},1032,["onClick"])),64))])]),_:1}),e(me,{label:"支付方式",prop:"paymentMethod"},{default:t(()=>[e(ue,{modelValue:B.paymentMethod,"onUpdate:modelValue":l[5]||(l[5]=g=>B.paymentMethod=g)},{default:t(()=>[S.value.alipay?(y(),J(w,{key:0,label:"alipay"},{default:t(()=>[e(f,null,{default:t(()=>[e($(Te))]),_:1}),l[27]||(l[27]=n(" 支付宝 ",-1))]),_:1,__:[27]})):I("",!0),S.value.wechat?(y(),J(w,{key:1,label:"wechat"},{default:t(()=>[e(f,null,{default:t(()=>[e($(Te))]),_:1}),l[28]||(l[28]=n(" 微信支付 ",-1))]),_:1,__:[28]})):I("",!0),S.value.bankTransfer?(y(),J(w,{key:2,label:"bank"},{default:t(()=>[e(f,null,{default:t(()=>[e($(Ye))]),_:1}),l[29]||(l[29]=n(" 银行转账 ",-1))]),_:1,__:[29]})):I("",!0),S.value.paypal?(y(),J(w,{key:3,label:"paypal"},{default:t(()=>[e(f,null,{default:t(()=>[e($(Te))]),_:1}),l[30]||(l[30]=n(" PayPal ",-1))]),_:1,__:[30]})):I("",!0)]),_:1},8,["modelValue"]),A.value?I("",!0):(y(),z("div",rl,[e(Ve,{title:"暂无可用支付方式",type:"warning",closable:!1},{default:t(()=>l[31]||(l[31]=[n(" 管理员尚未启用任何在线支付方式，请使用其他充值方式或联系客服。 ",-1)])),_:1,__:[31]})]))]),_:1}),e(me,null,{default:t(()=>[a("div",ul,[a("div",il,[l[32]||(l[32]=a("span",null,"充值金额：",-1)),a("span",dl,"¥"+m(parseFloat(B.amount||0).toFixed(2)),1)]),a("div",pl,[l[33]||(l[33]=a("span",null,"到账金额：",-1)),a("span",ml,"¥"+m(parseFloat(B.amount||0).toFixed(2)),1)])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(ce,{modelValue:M.value,"onUpdate:modelValue":l[9]||(l[9]=g=>M.value=g),title:"充值详情",width:"500px"},{footer:t(()=>[e(v,{type:"primary",onClick:l[8]||(l[8]=g=>M.value=!1)},{default:t(()=>l[36]||(l[36]=[n(" 关闭 ",-1)])),_:1,__:[36]})]),default:t(()=>[L.value?(y(),z("div",cl,[e(Be,{column:1,border:""},{default:t(()=>[e(ie,{label:"充值订单号"},{default:t(()=>[n(m(L.value.orderNumber),1)]),_:1}),e(ie,{label:"充值金额"},{default:t(()=>[a("span",_l,"¥"+m(L.value.amount.toFixed(2)),1)]),_:1}),e(ie,{label:"支付方式"},{default:t(()=>[e(X,{type:le(L.value.paymentMethod)},{default:t(()=>[n(m(C(L.value.paymentMethod)),1)]),_:1},8,["type"])]),_:1}),e(ie,{label:"状态"},{default:t(()=>[e(X,{type:s(L.value.status)},{default:t(()=>[n(m(ae(L.value.status)),1)]),_:1},8,["type"])]),_:1}),e(ie,{label:"创建时间"},{default:t(()=>[n(m(L.value.createTime),1)]),_:1}),e(ie,{label:"完成时间"},{default:t(()=>[n(m(L.value.completeTime||"-"),1)]),_:1})]),_:1})])):I("",!0)]),_:1},8,["modelValue"]),e(ce,{modelValue:T.value,"onUpdate:modelValue":l[11]||(l[11]=g=>T.value=g),title:"支付确认",width:"400px"},{footer:t(()=>[e(v,{onClick:l[10]||(l[10]=g=>T.value=!1)},{default:t(()=>l[41]||(l[41]=[n("取消",-1)])),_:1,__:[41]}),e(v,{type:"primary",onClick:c,loading:U.value},{default:t(()=>l[42]||(l[42]=[n(" 确认支付 ",-1)])),_:1,__:[42]},8,["loading"])]),default:t(()=>[L.value?(y(),z("div",fl,[a("div",vl,[l[39]||(l[39]=a("h4",null,"请确认支付信息",-1)),a("div",yl,[l[37]||(l[37]=a("span",null,"充值金额：",-1)),a("span",gl,"¥"+m(L.value.amount.toFixed(2)),1)]),a("div",bl,[l[38]||(l[38]=a("span",null,"支付方式：",-1)),a("span",null,m(C(L.value.paymentMethod)),1)])]),a("div",wl,[e(Ve,{title:"支付说明",type:"info",closable:!1},{default:t(()=>l[40]||(l[40]=[a("p",null,'这是演示系统，点击"确认支付"将直接完成充值。',-1),a("p",null,"实际系统中会跳转到第三方支付平台。",-1)])),_:1,__:[40]})])])):I("",!0)]),_:1},8,["modelValue"]),e(ce,{modelValue:q.value,"onUpdate:modelValue":l[14]||(l[14]=g=>q.value=g),title:"微信客服充值",width:"500px"},{footer:t(()=>[a("div",ql,[e(v,{onClick:l[13]||(l[13]=g=>q.value=!1)},{default:t(()=>l[55]||(l[55]=[n("关闭",-1)])),_:1,__:[55]}),e(v,{type:"success",onClick:j},{default:t(()=>[e(f,null,{default:t(()=>[e($(ve))]),_:1}),l[56]||(l[56]=n(" 复制微信号 ",-1))]),_:1,__:[56]})])]),default:t(()=>[a("div",Cl,[a("div",kl,[a("div",$l,[e(f,{class:"wechat-icon",color:"#07C160"},{default:t(()=>[e($(qe))]),_:1}),l[43]||(l[43]=a("h3",null,"添加客服微信进行充值",-1))]),a("div",xl,[e(b,{class:"wechat-card"},{default:t(()=>[a("div",Vl,[a("div",Tl,[l[45]||(l[45]=a("span",{class:"label"},"客服微信号：",-1)),l[46]||(l[46]=a("span",{class:"wechat-number"},"AQ0007N",-1)),e(v,{type:"primary",size:"small",onClick:j,class:"copy-btn"},{default:t(()=>[e(f,null,{default:t(()=>[e($(ve))]),_:1}),l[44]||(l[44]=n(" 复制 ",-1))]),_:1,__:[44]})]),a("div",hl,[a("div",Sl,[a("img",{src:ze,alt:"客服微信二维码",class:"qr-image",onError:Y,onDblclick:l[12]||(l[12]=g=>u.value=!0),title:"双击放大查看"},null,32),l[47]||(l[47]=a("p",null,"扫码添加客服微信",-1)),l[48]||(l[48]=a("small",null,"微信号：AQ0007N",-1))])])])]),_:1})]),a("div",Ll,[l[49]||(l[49]=a("h4",null,"充值步骤：",-1)),e(Ae,{direction:"vertical",active:4},{default:t(()=>[e(_e,{title:"复制微信号",description:"点击上方按钮复制客服微信号：AQ0007N"}),e(_e,{title:"添加客服",description:"在微信中搜索并添加客服微信"}),e(_e,{title:"发送充值信息",description:"告知客服您的用户名和充值金额"}),e(_e,{title:"完成转账",description:"按客服指引完成微信转账"}),e(_e,{title:"等待到账",description:"客服确认后将为您充值到账"})]),_:1})]),a("div",Nl,[e(Ve,{title:"充值说明",type:"warning",closable:!1},{default:t(()=>{var g;return[a("ul",null,[l[51]||(l[51]=a("li",null,'添加客服微信时请备注"充值"',-1)),a("li",null,[l[50]||(l[50]=n("请提供正确的用户名：",-1)),a("strong",null,m((g=$(V).user)==null?void 0:g.username),1)]),l[52]||(l[52]=a("li",null,"转账时请备注充值金额，便于客服快速处理",-1)),l[53]||(l[53]=a("li",null,"微信充值通常在1-10分钟内到账",-1)),l[54]||(l[54]=a("li",null,"如有疑问请联系客服咨询",-1))])]}),_:1})])])])]),_:1},8,["modelValue"]),e(ce,{modelValue:u.value,"onUpdate:modelValue":l[16]||(l[16]=g=>u.value=g),title:"微信二维码",width:"90%","show-close":!0,center:""},{footer:t(()=>[e(v,{type:"primary",onClick:l[15]||(l[15]=g=>u.value=!1)},{default:t(()=>l[61]||(l[61]=[n(" 关闭 ",-1)])),_:1,__:[61]})]),default:t(()=>[a("div",Ml,[l[60]||(l[60]=a("img",{src:ze,alt:"客服微信二维码 - 放大版",class:"preview-image"},null,-1)),a("div",zl,[l[58]||(l[58]=a("p",null,[a("strong",null,"客服微信号：AQ0007N")],-1)),l[59]||(l[59]=a("p",null,"扫描二维码或搜索微信号添加客服",-1)),e(v,{type:"success",onClick:j,class:"copy-in-preview"},{default:t(()=>[e(f,null,{default:t(()=>[e($(ve))]),_:1}),l[57]||(l[57]=n(" 复制微信号 ",-1))]),_:1,__:[57]})])])]),_:1},8,["modelValue"])])}}},Ul=ye(Il,[["__scopeId","data-v-0a3194bc"]]),Rl={class:"dashboard"},Fl={class:"header-content"},Dl={class:"user-info"},Pl={class:"user-status"},Bl={class:"balance-display"},Al={key:0,width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",style:{"margin-right":"4px"}},Ol={key:1,width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",style:{"margin-right":"4px"}},El={class:"el-dropdown-link"},Hl={class:"info-item"},Ql={class:"info-content"},jl={class:"info-item"},Jl={class:"info-content"},Gl={class:"info-item"},Yl={class:"info-content"},Wl={class:"info-item"},Zl={class:"info-content"},Kl={class:"card-header"},Xl={class:"tab-content"},ea={key:0},ta={key:1},la={key:2},aa={key:3},sa={key:4},oa={key:5},na={class:"quick-actions"},ra={width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",style:{"margin-right":"4px"}},ua={key:0,d:"M6,2L8,6L12,7L8,8L6,12L4,8L0,7L4,6L6,2M12,8L13.5,11L17,12L13.5,13L12,16L10.5,13L7,12L10.5,11L12,8M19,2L20.5,5L24,6L20.5,7L19,10L17.5,7L14,6L17.5,5L19,2Z"},ia={key:1,d:"M5 16L3 14l5.5-5.5L10 10l4-4L16.5 8.5L18 7l3 3-8.5 8.5L8 14l-3 2z"},da={__name:"Dashboard",setup(be){const V=We(),S=Ne(),A=Se(),O=tt(),M=de(()=>S.user),T=de(()=>S.isAdmin),q=de(()=>M.value?O.getUserVipInfo(M.value.level):O.vipLevels.普通),u=x(!1),P=x(1),U=x(10),Z=x(0),N=x("cards"),L=re({balance:"¥0.00",totalCards:0,usedCards:0,expiredCards:0}),E=x([]),W=x([{id:1,description:"购买月卡 x1",time:"2024-01-01 10:00:00"},{id:2,description:"使用季卡",time:"2024-01-02 14:30:00"}]),B=re({cardNumber:""}),se=C=>{switch(C){case"home":V.push("/");break;case"profile":V.push("/profile");break;case"settings":V.push("/settings");break;case"admin":V.push("/admin");break;case"logout":S.logout(),V.push("/");break}},oe=C=>A.getCardStatusType(C),te=C=>A.getCardStatusText(C),H=async()=>{if(!B.cardNumber){k.error("请输入卡号");return}k.success("查询功能开发中..."),u.value=!1},o=async C=>{try{await ke.confirm(`确认激活卡密 ${C.cardNumber}？`,"确认激活",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const s=await A.activateCard(C.cardNumber,M.value.id);s.success?(k.success(s.message),c()):k.error(s.message)}catch{}},c=async()=>{if(!M.value)return;const C=await A.getUserCards(M.value.id);C.success&&(E.value=C.data,L.totalCards=C.data.length,L.usedCards=C.data.filter(s=>s.status==="used").length,L.expiredCards=C.data.filter(s=>s.status==="expired").length)},R=C=>{k.info(`查看卡密: ${C.cardNumber}`)},D=C=>{U.value=C},le=C=>{P.value=C};return ge(()=>{S.refreshCurrentUser(),c()}),(C,s)=>{const ae=r("el-tag"),p=r("el-icon"),i=r("el-dropdown-item"),F=r("el-dropdown-menu"),G=r("el-dropdown"),K=r("el-header"),Q=r("el-card"),j=r("el-col"),Y=r("el-row"),_=r("el-button"),ee=r("el-button-group"),d=r("el-table-column"),l=r("el-table"),f=r("el-pagination"),v=r("el-timeline-item"),b=r("el-timeline"),h=r("el-main"),X=r("el-container"),ne=r("el-input"),we=r("el-form-item"),pe=r("el-form"),me=r("el-dialog");return y(),z("div",Rl,[e(X,null,{default:t(()=>[e(K,null,{default:t(()=>{var w;return[a("div",Fl,[s[25]||(s[25]=a("h2",null,"个人中心",-1)),a("div",Dl,[a("div",Pl,[a("span",Bl,"余额: ¥"+m((((w=M.value)==null?void 0:w.balance)||0).toFixed(2)),1),e(ae,{type:q.value.level===0?"info":q.value.level===1?"warning":"",color:q.value.level===2?"#9333ea":"",class:"vip-badge"},{default:t(()=>[q.value.level===1?(y(),z("svg",Al,s[18]||(s[18]=[a("path",{d:"M5 16L3 14l5.5-5.5L10 10l4-4L16.5 8.5L18 7l3 3-8.5 8.5L8 14l-3 2z"},null,-1)]))):q.value.level===2?(y(),z("svg",Ol,s[19]||(s[19]=[a("path",{d:"M6,2L8,6L12,7L8,8L6,12L4,8L0,7L4,6L6,2M12,8L13.5,11L17,12L13.5,13L12,16L10.5,13L7,12L10.5,11L12,8M19,2L20.5,5L24,6L20.5,7L19,10L17.5,7L14,6L17.5,5L19,2Z"},null,-1)]))):I("",!0),n(" "+m(q.value.name),1)]),_:1},8,["type","color"])]),e(G,{onCommand:se},{dropdown:t(()=>[e(F,null,{default:t(()=>[e(i,{command:"home"},{default:t(()=>s[20]||(s[20]=[n("返回首页",-1)])),_:1,__:[20]}),e(i,{command:"profile"},{default:t(()=>s[21]||(s[21]=[n("个人资料",-1)])),_:1,__:[21]}),e(i,{command:"settings"},{default:t(()=>s[22]||(s[22]=[n("系统设置",-1)])),_:1,__:[22]}),T.value?(y(),J(i,{key:0,command:"admin"},{default:t(()=>s[23]||(s[23]=[n("管理后台",-1)])),_:1,__:[23]})):I("",!0),e(i,{divided:"",command:"logout"},{default:t(()=>s[24]||(s[24]=[n("退出登录",-1)])),_:1,__:[24]})]),_:1})]),default:t(()=>{var ue;return[a("span",El,[n(m((ue=M.value)==null?void 0:ue.username)+" ",1),e(p,{class:"el-icon--right"},{default:t(()=>[e($(Ze))]),_:1})])]}),_:1})])])]}),_:1}),e(h,null,{default:t(()=>[e(Y,{gutter:20,class:"mobile-stack"},{default:t(()=>[e(j,{xs:12,sm:6,md:6},{default:t(()=>[e(Q,{class:"info-card stats-card hover-lift"},{default:t(()=>{var w;return[a("div",Hl,[e(p,{class:"info-icon",color:"#409eff"},{default:t(()=>[e($(he))]),_:1}),a("div",Ql,[a("h3",null,"¥"+m((((w=M.value)==null?void 0:w.balance)||0).toFixed(2)),1),s[26]||(s[26]=a("p",null,"账户余额",-1))])])]}),_:1})]),_:1}),e(j,{xs:12,sm:6,md:6},{default:t(()=>[e(Q,{class:"info-card stats-card hover-lift"},{default:t(()=>[a("div",jl,[e(p,{class:"info-icon",color:"#67C23A"},{default:t(()=>[e($(Ce))]),_:1}),a("div",Jl,[a("h3",null,m(L.totalCards),1),s[27]||(s[27]=a("p",null,"拥有卡密",-1))])])]),_:1})]),_:1}),e(j,{xs:12,sm:6,md:6},{default:t(()=>[e(Q,{class:"info-card stats-card hover-lift"},{default:t(()=>[a("div",Gl,[e(p,{class:"info-icon",color:"#E6A23C"},{default:t(()=>[e($(Me))]),_:1}),a("div",Yl,[a("h3",null,m(L.usedCards),1),s[28]||(s[28]=a("p",null,"已使用",-1))])])]),_:1})]),_:1}),e(j,{xs:12,sm:6,md:6},{default:t(()=>[e(Q,{class:"info-card stats-card hover-lift"},{default:t(()=>[a("div",Wl,[e(p,{class:"info-icon",color:"#F56C6C"},{default:t(()=>[e($(Ke))]),_:1}),a("div",Zl,[a("h3",null,m(L.expiredCards),1),s[29]||(s[29]=a("p",null,"已过期",-1))])])]),_:1})]),_:1})]),_:1}),e(Y,{gutter:20,class:"mt-20 mobile-stack"},{default:t(()=>[e(j,{xs:24,md:16},{default:t(()=>[e(Q,null,{header:t(()=>[a("div",Kl,[s[36]||(s[36]=a("span",null,"功能模块",-1)),e(ee,null,{default:t(()=>[e(_,{type:N.value==="cards"?"primary":"",onClick:s[0]||(s[0]=w=>N.value="cards")},{default:t(()=>s[30]||(s[30]=[n(" 卡密管理 ",-1)])),_:1,__:[30]},8,["type"]),e(_,{type:N.value==="orders"?"primary":"",onClick:s[1]||(s[1]=w=>N.value="orders")},{default:t(()=>s[31]||(s[31]=[n(" 订单管理 ",-1)])),_:1,__:[31]},8,["type"]),e(_,{type:N.value==="recharge"?"primary":"",onClick:s[2]||(s[2]=w=>N.value="recharge")},{default:t(()=>s[32]||(s[32]=[n(" 余额充值 ",-1)])),_:1,__:[32]},8,["type"]),T.value?(y(),J(_,{key:0,type:N.value==="generator"?"primary":"",onClick:s[3]||(s[3]=w=>N.value="generator")},{default:t(()=>s[33]||(s[33]=[n(" 卡密生成器 ",-1)])),_:1,__:[33]},8,["type"])):I("",!0),e(_,{type:N.value==="query"?"primary":"",onClick:s[4]||(s[4]=w=>N.value="query")},{default:t(()=>s[34]||(s[34]=[n(" 卡密查询 ",-1)])),_:1,__:[34]},8,["type"]),e(_,{type:N.value==="contact"?"primary":"",onClick:s[5]||(s[5]=w=>N.value="contact")},{default:t(()=>s[35]||(s[35]=[n(" 联系客服 ",-1)])),_:1,__:[35]},8,["type"])]),_:1})])]),default:t(()=>[a("div",Xl,[N.value==="cards"?(y(),z("div",ea,[e(l,{data:E.value,style:{width:"100%"}},{default:t(()=>[e(d,{prop:"cardNumber",label:"卡号"}),e(d,{prop:"cardType",label:"类型"}),e(d,{prop:"value",label:"面值"}),e(d,{prop:"status",label:"状态"},{default:t(w=>[e(ae,{type:oe(w.row.status)},{default:t(()=>[n(m(te(w.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"createTime",label:"创建时间"}),e(d,{label:"操作"},{default:t(w=>[w.row.status==="sold"?(y(),J(_,{key:0,type:"primary",size:"small",onClick:ue=>o(w.row)},{default:t(()=>s[37]||(s[37]=[n(" 激活 ",-1)])),_:2,__:[37]},1032,["onClick"])):I("",!0),w.row.status==="used"?(y(),J(_,{key:1,type:"success",size:"small",disabled:""},{default:t(()=>s[38]||(s[38]=[n(" 已激活 ",-1)])),_:1,__:[38]})):I("",!0),e(_,{type:"info",size:"small",onClick:ue=>R(w.row)},{default:t(()=>s[39]||(s[39]=[n(" 查看 ",-1)])),_:2,__:[39]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(f,{"current-page":P.value,"onUpdate:currentPage":s[6]||(s[6]=w=>P.value=w),"page-size":U.value,"onUpdate:pageSize":s[7]||(s[7]=w=>U.value=w),"page-sizes":[10,20,50,100],total:Z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:D,onCurrentChange:le,class:"mt-20"},null,8,["current-page","page-size","total"])])):I("",!0),N.value==="orders"?(y(),z("div",ta,[e(at)])):I("",!0),N.value==="recharge"?(y(),z("div",la,[e(Ul)])):I("",!0),N.value==="generator"&&T.value?(y(),z("div",aa,[e(xt)])):I("",!0),N.value==="query"?(y(),z("div",sa,[e(Ft)])):I("",!0),N.value==="contact"?(y(),z("div",oa,[e(Zt)])):I("",!0)])]),_:1})]),_:1}),e(j,{xs:24,md:8},{default:t(()=>[e(Q,null,{header:t(()=>s[40]||(s[40]=[a("span",null,"快速操作",-1)])),default:t(()=>[a("div",na,[e(_,{type:"success",onClick:s[8]||(s[8]=w=>N.value="recharge"),class:"action-btn"},{default:t(()=>[e(p,null,{default:t(()=>[e($(he))]),_:1}),s[41]||(s[41]=n(" 余额充值 ",-1))]),_:1,__:[41]}),e(_,{type:"primary",onClick:s[9]||(s[9]=w=>C.$router.push("/cards")),class:"action-btn"},{default:t(()=>[e(p,null,{default:t(()=>[e($(Me))]),_:1}),s[42]||(s[42]=n(" 购买卡密 ",-1))]),_:1,__:[42]}),e(_,{type:"info",onClick:s[10]||(s[10]=w=>u.value=!0),class:"action-btn"},{default:t(()=>[e(p,null,{default:t(()=>[e($(Ue))]),_:1}),s[43]||(s[43]=n(" 查询卡密 ",-1))]),_:1,__:[43]}),e(_,{type:q.value.level===2?"info":"primary",onClick:s[11]||(s[11]=w=>C.$router.push("/vip")),class:"action-btn vip-action"},{default:t(()=>[(y(),z("svg",ra,[q.value.level===2?(y(),z("path",ua)):(y(),z("path",ia))])),n(" "+m(q.value.level===2?"VIP中心":q.value.level===1?"升级SVIP":"升级VIP"),1)]),_:1},8,["type"]),e(_,{type:"warning",onClick:s[12]||(s[12]=w=>C.$router.push("/profile")),class:"action-btn"},{default:t(()=>[e(p,null,{default:t(()=>[e($(Xe))]),_:1}),s[44]||(s[44]=n(" 个人资料 ",-1))]),_:1,__:[44]}),e(_,{type:"info",onClick:s[13]||(s[13]=w=>C.$router.push("/settings")),class:"action-btn"},{default:t(()=>[e(p,null,{default:t(()=>[e($(et))]),_:1}),s[45]||(s[45]=n(" 系统设置 ",-1))]),_:1,__:[45]}),e(_,{type:"info",onClick:s[14]||(s[14]=w=>N.value="contact"),class:"action-btn"},{default:t(()=>[e(p,null,{default:t(()=>[e($(De))]),_:1}),s[46]||(s[46]=n(" 联系客服 ",-1))]),_:1,__:[46]})])]),_:1}),e(Q,{class:"mt-20"},{header:t(()=>s[47]||(s[47]=[a("span",null,"最近交易",-1)])),default:t(()=>[e(b,null,{default:t(()=>[(y(!0),z($e,null,xe(W.value,w=>(y(),J(v,{key:w.id,timestamp:w.time},{default:t(()=>[n(m(w.description),1)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(me,{modelValue:u.value,"onUpdate:modelValue":s[17]||(s[17]=w=>u.value=w),title:"查询卡密",width:"400px"},{footer:t(()=>[e(_,{onClick:s[16]||(s[16]=w=>u.value=!1)},{default:t(()=>s[48]||(s[48]=[n("取消",-1)])),_:1,__:[48]}),e(_,{type:"primary",onClick:H},{default:t(()=>s[49]||(s[49]=[n("查询",-1)])),_:1,__:[49]})]),default:t(()=>[e(pe,{model:B,"label-width":"80px"},{default:t(()=>[e(we,{label:"卡号"},{default:t(()=>[e(ne,{modelValue:B.cardNumber,"onUpdate:modelValue":s[15]||(s[15]=w=>B.cardNumber=w),placeholder:"请输入卡号"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},_a=ye(da,[["__scopeId","data-v-fda3b16c"]]);export{_a as default};
