import{_ as he,aF as Me,l as Oe,r as x,P as G,c as U,o as Ne,h as c,a1 as ke,a as se,d as h,e,w as a,f as u,u as b,G as Ie,t as i,a9 as De,W as qe,a5 as oe,a3 as ze,i as r,Z as Fe,$ as Pe,k as q,b as z,X as Ue,V as Re,a7 as ne,R as M,a0 as Ae,aE as Le}from"./index-ihp2IIuf.js";const $e={class:"order-management"},Je={class:"stats-item"},Ye={class:"stats-content"},Be={class:"stats-item"},Ee={class:"stats-content"},je={class:"stats-item"},Ge={class:"stats-content"},We={class:"stats-item"},Xe={class:"stats-content"},Ze={class:"card-header"},He={class:"header-actions"},Ke={class:"filter-bar"},Qe={class:"amount-text"},et={class:"order-summary"},tt={class:"summary-item"},at={class:"price"},lt={class:"payment-info"},st={class:"amount-text"},ot={class:"payment-methods"},nt={key:0,class:"order-detail"},rt={class:"amount-text"},ut={__name:"OrderManagement",setup(S){const f=Me(),W=Oe(),X=x(!1),R=x(!1),A=x(!1),k=x(!1),I=x(!1),F=x(!1),L=x(),p=x(null),s=G({status:"",cardType:"",orderNumber:"",dateRange:null}),n=G({cardType:"",quantity:1,paymentMethod:"balance"}),d=G({method:"balance"}),m={cardType:[{required:!0,message:"请选择卡密类型",trigger:"change"}],quantity:[{required:!0,message:"请输入购买数量",trigger:"blur"}],paymentMethod:[{required:!0,message:"请选择支付方式",trigger:"change"}]},w=U(()=>f.orders),_=U(()=>f.pagination),Y=U(()=>W.isAdmin),$=U(()=>f.calculateOrderStats()),Z=U(()=>{let o=w.value;if(s.status&&(o=o.filter(t=>t.status===s.status)),s.cardType&&(o=o.filter(t=>t.cardType===s.cardType)),s.orderNumber&&(o=o.filter(t=>t.orderNumber.toLowerCase().includes(s.orderNumber.toLowerCase()))),s.dateRange&&s.dateRange.length===2){const[t,y]=s.dateRange;o=o.filter(O=>{const N=new Date(O.createTime).toISOString().split("T")[0];return N>=t&&N<=y})}return o}),H=o=>f.getOrderStatusType(o),K=o=>f.getOrderStatusText(o),B=o=>f.getCardTypeName(o),Q=o=>f.getPaymentMethodName(o),ee=o=>({monthly:"success",quarterly:"warning",yearly:"danger"})[o]||"info",re=()=>{const o={monthly:29.9,quarterly:79.9,yearly:299.9};return n.cardType&&n.quantity?(o[n.cardType]*n.quantity).toFixed(2):"0.00"},ue=()=>{M.success("筛选功能开发中...")},de=()=>{s.status="",s.cardType="",s.orderNumber="",s.dateRange=null},ie=async()=>{L.value&&await L.value.validate(async o=>{if(o){R.value=!0;try{const t=await f.createOrder(n);t.success?(M.success(t.message),k.value=!1,ye()):M.error(t.message)}finally{R.value=!1}}})},ce=o=>{p.value=o,d.method=o.paymentMethod||"balance",I.value=!0},pe=async()=>{A.value=!0;try{const o=await f.payOrder(p.value.id,{paymentMethod:d.method});o.success?(M.success(o.message),I.value=!1):M.error(o.message)}finally{A.value=!1}},me=async o=>{try{await Ae.confirm(`确认取消订单 ${o.orderNumber}？`,"确认取消",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const t=await f.cancelOrder(o.id);t.success?M.success(t.message):M.error(t.message)}catch{}},fe=o=>{p.value=o,F.value=!0},_e=()=>{f.exportOrders(Z.value),M.success("导出成功")},ye=()=>{n.cardType="",n.quantity=1,n.paymentMethod="balance"},ge=o=>{_.value.pageSize=o},ve=o=>{_.value.currentPage=o};return Ne(()=>{f.fetchOrders()}),(o,t)=>{const y=c("el-icon"),O=c("el-card"),N=c("el-col"),be=c("el-row"),g=c("el-button"),T=c("el-option"),E=c("el-select"),V=c("el-form-item"),we=c("el-input"),Te=c("el-date-picker"),te=c("el-form"),C=c("el-table-column"),J=c("el-tag"),Ce=c("el-table"),xe=c("el-pagination"),Se=c("el-input-number"),D=c("el-radio"),ae=c("el-radio-group"),j=c("el-dialog"),v=c("el-descriptions-item"),le=c("el-descriptions"),Ve=ke("loading");return h(),se("div",$e,[e(be,{gutter:20,class:"stats-row"},{default:a(()=>[e(N,{span:6},{default:a(()=>[e(O,{class:"stats-card"},{default:a(()=>[u("div",Je,[e(y,{class:"stats-icon",color:"#409eff"},{default:a(()=>[e(b(Ie))]),_:1}),u("div",Ye,[u("h3",null,i($.value.totalOrders),1),t[17]||(t[17]=u("p",null,"总订单数",-1))])])]),_:1})]),_:1}),e(N,{span:6},{default:a(()=>[e(O,{class:"stats-card"},{default:a(()=>[u("div",Be,[e(y,{class:"stats-icon",color:"#E6A23C"},{default:a(()=>[e(b(De))]),_:1}),u("div",Ee,[u("h3",null,i($.value.pendingOrders),1),t[18]||(t[18]=u("p",null,"待支付",-1))])])]),_:1})]),_:1}),e(N,{span:6},{default:a(()=>[e(O,{class:"stats-card"},{default:a(()=>[u("div",je,[e(y,{class:"stats-icon",color:"#67C23A"},{default:a(()=>[e(b(qe))]),_:1}),u("div",Ge,[u("h3",null,i($.value.completedOrders),1),t[19]||(t[19]=u("p",null,"已完成",-1))])])]),_:1})]),_:1}),e(N,{span:6},{default:a(()=>[e(O,{class:"stats-card"},{default:a(()=>[u("div",We,[e(y,{class:"stats-icon",color:"#F56C6C"},{default:a(()=>[e(b(oe))]),_:1}),u("div",Xe,[u("h3",null,"¥"+i($.value.totalAmount.toFixed(2)),1),t[20]||(t[20]=u("p",null,"总收入",-1))])])]),_:1})]),_:1})]),_:1}),e(O,{class:"order-list-card"},{header:a(()=>[u("div",Ze,[t[23]||(t[23]=u("span",null,"订单列表",-1)),u("div",He,[e(g,{type:"success",onClick:_e},{default:a(()=>[e(y,null,{default:a(()=>[e(b(Ue))]),_:1}),t[21]||(t[21]=r(" 导出订单 ",-1))]),_:1,__:[21]}),Y.value?(h(),q(g,{key:0,type:"primary",onClick:t[0]||(t[0]=l=>k.value=!0)},{default:a(()=>[e(y,null,{default:a(()=>[e(b(Re))]),_:1}),t[22]||(t[22]=r(" 创建订单 ",-1))]),_:1,__:[22]})):z("",!0)])])]),default:a(()=>[u("div",Ke,[e(te,{model:s,inline:""},{default:a(()=>[e(V,{label:"订单状态"},{default:a(()=>[e(E,{modelValue:s.status,"onUpdate:modelValue":t[1]||(t[1]=l=>s.status=l),placeholder:"全部状态",clearable:""},{default:a(()=>[e(T,{label:"待支付",value:"pending"}),e(T,{label:"已支付",value:"paid"}),e(T,{label:"已完成",value:"completed"}),e(T,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"卡密类型"},{default:a(()=>[e(E,{modelValue:s.cardType,"onUpdate:modelValue":t[2]||(t[2]=l=>s.cardType=l),placeholder:"全部类型",clearable:""},{default:a(()=>[e(T,{label:"月卡",value:"monthly"}),e(T,{label:"季卡",value:"quarterly"}),e(T,{label:"年卡",value:"yearly"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"订单号"},{default:a(()=>[e(we,{modelValue:s.orderNumber,"onUpdate:modelValue":t[3]||(t[3]=l=>s.orderNumber=l),placeholder:"请输入订单号",clearable:""},null,8,["modelValue"])]),_:1}),e(V,{label:"日期范围"},{default:a(()=>[e(Te,{modelValue:s.dateRange,"onUpdate:modelValue":t[4]||(t[4]=l=>s.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(V,null,{default:a(()=>[e(g,{type:"primary",onClick:ue},{default:a(()=>[e(y,null,{default:a(()=>[e(b(Fe))]),_:1}),t[24]||(t[24]=r(" 筛选 ",-1))]),_:1,__:[24]}),e(g,{onClick:de},{default:a(()=>[e(y,null,{default:a(()=>[e(b(Pe))]),_:1}),t[25]||(t[25]=r(" 重置 ",-1))]),_:1,__:[25]})]),_:1})]),_:1},8,["model"])]),ze((h(),q(Ce,{data:Z.value,style:{width:"100%"}},{default:a(()=>[e(C,{prop:"orderNumber",label:"订单号",width:"180"}),Y.value?(h(),q(C,{key:0,prop:"username",label:"用户",width:"120"})):z("",!0),e(C,{prop:"cardType",label:"卡密类型",width:"100"},{default:a(l=>[e(J,{type:ee(l.row.cardType)},{default:a(()=>[r(i(B(l.row.cardType)),1)]),_:2},1032,["type"])]),_:1}),e(C,{prop:"quantity",label:"数量",width:"80"}),e(C,{prop:"totalAmount",label:"总金额",width:"120"},{default:a(l=>[u("span",Qe,"¥"+i(l.row.totalAmount.toFixed(2)),1)]),_:1}),e(C,{prop:"paymentMethod",label:"支付方式",width:"120"},{default:a(l=>[r(i(Q(l.row.paymentMethod)),1)]),_:1}),e(C,{prop:"status",label:"状态",width:"100"},{default:a(l=>[e(J,{type:H(l.row.status)},{default:a(()=>[r(i(K(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(C,{prop:"createTime",label:"创建时间",width:"160"}),Y.value?(h(),q(C,{key:1,prop:"paymentTime",label:"支付时间",width:"160"},{default:a(l=>[r(i(l.row.paymentTime||"-"),1)]),_:1})):z("",!0),e(C,{label:"操作",width:"200",fixed:"right"},{default:a(l=>[l.row.status==="pending"?(h(),q(g,{key:0,type:"primary",size:"small",onClick:P=>ce(l.row)},{default:a(()=>t[26]||(t[26]=[r(" 支付 ",-1)])),_:2,__:[26]},1032,["onClick"])):z("",!0),l.row.status==="pending"?(h(),q(g,{key:1,type:"danger",size:"small",onClick:P=>me(l.row)},{default:a(()=>t[27]||(t[27]=[r(" 取消 ",-1)])),_:2,__:[27]},1032,["onClick"])):z("",!0),e(g,{type:"info",size:"small",onClick:P=>fe(l.row)},{default:a(()=>t[28]||(t[28]=[r(" 详情 ",-1)])),_:2,__:[28]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ve,X.value]]),e(xe,{"current-page":_.value.currentPage,"onUpdate:currentPage":t[5]||(t[5]=l=>_.value.currentPage=l),"page-size":_.value.pageSize,"onUpdate:pageSize":t[6]||(t[6]=l=>_.value.pageSize=l),"page-sizes":[10,20,50,100],total:_.value.total,layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:ge,onCurrentChange:ve},null,8,["current-page","page-size","total"])]),_:1}),e(j,{modelValue:k.value,"onUpdate:modelValue":t[11]||(t[11]=l=>k.value=l),title:"创建订单",width:"500px"},{footer:a(()=>[e(g,{onClick:t[10]||(t[10]=l=>k.value=!1)},{default:a(()=>t[33]||(t[33]=[r("取消",-1)])),_:1,__:[33]}),e(g,{type:"primary",onClick:ie,loading:R.value},{default:a(()=>t[34]||(t[34]=[r(" 创建订单 ",-1)])),_:1,__:[34]},8,["loading"])]),default:a(()=>[e(te,{model:n,rules:m,ref_key:"createFormRef",ref:L,"label-width":"100px"},{default:a(()=>[e(V,{label:"卡密类型",prop:"cardType"},{default:a(()=>[e(E,{modelValue:n.cardType,"onUpdate:modelValue":t[7]||(t[7]=l=>n.cardType=l),placeholder:"请选择卡密类型",class:"full-width"},{default:a(()=>[e(T,{label:"月卡 - ¥29.90",value:"monthly"}),e(T,{label:"季卡 - ¥79.90",value:"quarterly"}),e(T,{label:"年卡 - ¥299.90",value:"yearly"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"购买数量",prop:"quantity"},{default:a(()=>[e(Se,{modelValue:n.quantity,"onUpdate:modelValue":t[8]||(t[8]=l=>n.quantity=l),min:1,max:100,class:"full-width"},null,8,["modelValue"])]),_:1}),e(V,{label:"支付方式",prop:"paymentMethod"},{default:a(()=>[e(ae,{modelValue:n.paymentMethod,"onUpdate:modelValue":t[9]||(t[9]=l=>n.paymentMethod=l)},{default:a(()=>[e(D,{label:"balance"},{default:a(()=>t[29]||(t[29]=[r("余额支付",-1)])),_:1,__:[29]}),e(D,{label:"alipay"},{default:a(()=>t[30]||(t[30]=[r("支付宝",-1)])),_:1,__:[30]}),e(D,{label:"wechat"},{default:a(()=>t[31]||(t[31]=[r("微信支付",-1)])),_:1,__:[31]})]),_:1},8,["modelValue"])]),_:1}),e(V,null,{default:a(()=>[u("div",et,[u("div",tt,[t[32]||(t[32]=u("span",null,"商品总价：",-1)),u("span",at,"¥"+i(re()),1)])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(j,{modelValue:I.value,"onUpdate:modelValue":t[14]||(t[14]=l=>I.value=l),title:"订单支付",width:"400px"},{footer:a(()=>[e(g,{onClick:t[13]||(t[13]=l=>I.value=!1)},{default:a(()=>t[40]||(t[40]=[r("取消",-1)])),_:1,__:[40]}),e(g,{type:"primary",onClick:pe,loading:A.value},{default:a(()=>t[41]||(t[41]=[r(" 确认支付 ",-1)])),_:1,__:[41]},8,["loading"])]),default:a(()=>[u("div",lt,[t[39]||(t[39]=u("h4",null,"订单信息",-1)),e(le,{column:1,border:""},{default:a(()=>[e(v,{label:"订单号"},{default:a(()=>{var l;return[r(i((l=p.value)==null?void 0:l.orderNumber),1)]}),_:1}),e(v,{label:"商品"},{default:a(()=>{var l,P;return[r(i(B((l=p.value)==null?void 0:l.cardType))+" × "+i((P=p.value)==null?void 0:P.quantity),1)]}),_:1}),e(v,{label:"应付金额"},{default:a(()=>{var l;return[u("span",st,"¥"+i((l=p.value)==null?void 0:l.totalAmount.toFixed(2)),1)]}),_:1})]),_:1}),u("div",ot,[t[38]||(t[38]=u("h4",null,"选择支付方式",-1)),e(ae,{modelValue:d.method,"onUpdate:modelValue":t[12]||(t[12]=l=>d.method=l)},{default:a(()=>[e(D,{label:"balance"},{default:a(()=>[e(y,null,{default:a(()=>[e(b(oe))]),_:1}),t[35]||(t[35]=r(" 余额支付 ",-1))]),_:1,__:[35]}),e(D,{label:"alipay"},{default:a(()=>[e(y,null,{default:a(()=>[e(b(ne))]),_:1}),t[36]||(t[36]=r(" 支付宝 ",-1))]),_:1,__:[36]}),e(D,{label:"wechat"},{default:a(()=>[e(y,null,{default:a(()=>[e(b(ne))]),_:1}),t[37]||(t[37]=r(" 微信支付 ",-1))]),_:1,__:[37]})]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"]),e(j,{modelValue:F.value,"onUpdate:modelValue":t[16]||(t[16]=l=>F.value=l),title:"订单详情",width:"600px"},{footer:a(()=>[e(g,{type:"primary",onClick:t[15]||(t[15]=l=>F.value=!1)},{default:a(()=>t[42]||(t[42]=[r(" 关闭 ",-1)])),_:1,__:[42]})]),default:a(()=>[p.value?(h(),se("div",nt,[e(le,{column:2,border:""},{default:a(()=>[e(v,{label:"订单号",span:2},{default:a(()=>[r(i(p.value.orderNumber),1)]),_:1}),e(v,{label:"卡密类型"},{default:a(()=>[e(J,{type:ee(p.value.cardType)},{default:a(()=>[r(i(B(p.value.cardType)),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"购买数量"},{default:a(()=>[r(i(p.value.quantity),1)]),_:1}),e(v,{label:"单价"},{default:a(()=>[r(" ¥"+i(p.value.unitPrice.toFixed(2)),1)]),_:1}),e(v,{label:"总金额"},{default:a(()=>[u("span",rt,"¥"+i(p.value.totalAmount.toFixed(2)),1)]),_:1}),e(v,{label:"支付方式"},{default:a(()=>[r(i(Q(p.value.paymentMethod)),1)]),_:1}),e(v,{label:"订单状态"},{default:a(()=>[e(J,{type:H(p.value.status)},{default:a(()=>[r(i(K(p.value.status)),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"创建时间"},{default:a(()=>[r(i(p.value.createTime),1)]),_:1}),e(v,{label:"支付时间"},{default:a(()=>[r(i(p.value.paymentTime||"-"),1)]),_:1})]),_:1})])):z("",!0)]),_:1},8,["modelValue"])])}}},it=he(ut,[["__scopeId","data-v-1c52e521"]]),ct=Le("contact",()=>{const S=x([]),f=x(!1);return{contacts:S,loading:f,submitContact:async s=>{try{const n=JSON.parse(localStorage.getItem("all_contacts")||"[]"),d={id:Date.now(),userId:s.userId,username:s.username,email:s.email,subject:s.subject,category:s.category,priority:s.priority||"normal",message:s.message,status:"pending",createTime:new Date().toLocaleString("zh-CN"),updateTime:new Date().toLocaleString("zh-CN"),adminReply:null,replyTime:null};return n.unshift(d),localStorage.setItem("all_contacts",JSON.stringify(n)),{success:!0,message:"消息提交成功，我们会尽快回复您",data:d}}catch{return{success:!1,message:"提交失败，请稍后重试"}}},fetchContacts:async(s=!1)=>{try{f.value=!0;const n=JSON.parse(localStorage.getItem("all_contacts")||"[]");if(s)S.value=n.sort((d,m)=>new Date(m.createTime)-new Date(d.createTime));else{const d=JSON.parse(localStorage.getItem("user_data")||"{}").id;S.value=n.filter(m=>m.userId===d).sort((m,w)=>new Date(w.createTime)-new Date(m.createTime))}return{success:!0}}catch{return{success:!1,message:"获取联系记录失败"}}finally{f.value=!1}},replyContact:async(s,n)=>{try{const d=JSON.parse(localStorage.getItem("all_contacts")||"[]"),m=d.findIndex(_=>_.id===s);if(m===-1)return{success:!1,message:"联系记录不存在"};d[m]={...d[m],adminReply:n.reply,replyTime:new Date().toLocaleString("zh-CN"),status:n.status||"resolved",updateTime:new Date().toLocaleString("zh-CN")},localStorage.setItem("all_contacts",JSON.stringify(d));const w=S.value.findIndex(_=>_.id===s);return w!==-1&&(S.value[w]=d[m]),{success:!0,message:"回复成功"}}catch{return{success:!1,message:"回复失败"}}},updateContactStatus:async(s,n)=>{try{const d=JSON.parse(localStorage.getItem("all_contacts")||"[]"),m=d.findIndex(_=>_.id===s);if(m===-1)return{success:!1,message:"联系记录不存在"};d[m].status=n,d[m].updateTime=new Date().toLocaleString("zh-CN"),localStorage.setItem("all_contacts",JSON.stringify(d));const w=S.value.findIndex(_=>_.id===s);return w!==-1&&(S.value[w].status=n,S.value[w].updateTime=d[m].updateTime),{success:!0,message:"状态更新成功"}}catch{return{success:!1,message:"状态更新失败"}}},getStatusType:s=>({pending:"warning",processing:"primary",resolved:"success",closed:"info"})[s]||"info",getStatusText:s=>({pending:"待处理",processing:"处理中",resolved:"已解决",closed:"已关闭"})[s]||"未知",getPriorityType:s=>({low:"info",normal:"primary",high:"warning",urgent:"danger"})[s]||"primary",getPriorityText:s=>({low:"低",normal:"普通",high:"高",urgent:"紧急"})[s]||"普通",getCategoryText:s=>({technical:"技术问题",account:"账户问题",payment:"支付问题",card:"卡密问题",suggestion:"意见建议",complaint:"投诉举报",other:"其他"})[s]||"其他"}});export{it as O,ct as u};
