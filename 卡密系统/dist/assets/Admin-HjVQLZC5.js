import{_ as Xe,l as Ct,r as $,P as ve,c as Ae,o as et,h as u,a1 as dt,a as S,d as y,e,w as t,f as l,a3 as ct,Q as Bt,i as r,u as F,Z as $t,$ as It,k as Ve,t as d,at as jt,b as q,n as Vt,R as b,a0 as Ee,F as Be,g as je,au as Et,ar as Lt,av as Ht,aw as Zt,ab as ft,H as gt,V as nt,B as Jt,ac as Mt,J as ht,W as qt,a9 as Gt,ax as Kt,q as Ft,E as Yt,ay as Qt,X as Rt,az as Nt,aa as Wt,U as Xt,C as el,aA as tl,aB as ll,p as zt,G as Pt,j as al,a4 as ol,a5 as _t,a8 as nl,I as sl,D as rl,aC as Ot,aD as il}from"./index-ihp2IIuf.js";import{u as ul,O as dl}from"./contact-BhUA68-k.js";import{useVipStore as cl}from"./vip-BiGGnL87.js";import{u as ml}from"./announcement-ClVxNpKE.js";const pl={class:"user-management"},_l={class:"card-header"},fl={class:"filter-bar"},gl={class:"balance-text"},vl={key:0,class:"balance-management"},yl={class:"current-balance"},bl={class:"balance-text"},wl={class:"balance-operation"},Vl={key:0,style:{"margin-left":"10px",color:"#909399"}},hl={key:1,style:{"margin-left":"10px",color:"#67C23A"}},Cl={key:2,style:{"margin-left":"10px",color:"#F56C6C"}},$l={class:"balance-history"},Il={key:0,class:"user-detail"},Sl={class:"balance-text"},kl={class:"user-history"},xl={__name:"UserManagement",setup(tt){const ae=Ct(),pe=$(!1),te=$(!1),G=$(!1),j=$(!1),K=$(!1),P=$(!1),T=$(null),h=$(null),V=$(null),D=$(),le=$([]),me=$([]),fe=$([]),ce=ve({role:"",status:"",keyword:""}),R=ve({currentPage:1,pageSize:10,total:0}),I=ve({username:"",email:"",password:"",realName:"",phone:"",role:"user",status:"active",balance:0,level:"普通"}),v=ve({operationType:"set",amount:0,reason:""}),X={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少 6 个字符",trigger:"blur"}],role:[{required:!0,message:"请选择用户角色",trigger:"change"}],status:[{required:!0,message:"请选择账户状态",trigger:"change"}]},f=Ae(()=>{let A=le.value;if(ce.role&&(A=A.filter(M=>M.role===ce.role)),ce.status&&(A=A.filter(M=>M.status===ce.status)),ce.keyword){const M=ce.keyword.toLowerCase();A=A.filter(H=>H.username.toLowerCase().includes(M)||H.email.toLowerCase().includes(M)||H.realName&&H.realName.toLowerCase().includes(M))}R.total=A.length;const p=(R.currentPage-1)*R.pageSize,g=p+R.pageSize;return A.slice(p,g)}),ie=A=>A==="active"?"success":"danger",W=A=>A==="active"?"正常":"禁用",i=A=>({VIP:"warning",SVIP:"success",普通:"info"})[A]||"info",s=()=>{pe.value=!0;try{const A=JSON.parse(localStorage.getItem("all_users")||"[]");le.value=A}catch{b.error("获取用户列表失败")}finally{pe.value=!1}},O=()=>{R.currentPage=1},k=()=>{ce.role="",ce.status="",ce.keyword="",R.currentPage=1},N=A=>{T.value=A,Object.assign(I,{username:A.username,email:A.email,realName:A.realName||"",phone:A.phone||"",role:A.role,status:A.status||"active",level:A.level||"普通"}),j.value=!0},c=async()=>{D.value&&await D.value.validate(async A=>{if(A){te.value=!0;try{const p=JSON.parse(localStorage.getItem("all_users")||"[]");if(T.value){const g=p.findIndex(M=>String(M.id)===String(T.value.id));if(g!==-1){p[g]={...p[g],email:I.email,realName:I.realName,phone:I.phone,role:I.role,status:I.status,level:I.level};const M=JSON.parse(localStorage.getItem("user_data")||"{}");if(M.id&&String(M.id)===String(T.value.id)){const H={...M,email:I.email,realName:I.realName,phone:I.phone,role:I.role,status:I.status,level:I.level};localStorage.setItem("user_data",JSON.stringify(H))}b.success("用户更新成功")}else{b.error("未找到要编辑的用户");return}}else{if(p.find(H=>H.username===I.username||H.email===I.email)){b.error("用户名或邮箱已存在");return}const M={id:Date.now(),username:I.username,email:I.email,password:I.password,realName:I.realName,phone:I.phone,role:I.role,status:I.status,balance:I.balance,level:I.level,registerTime:new Date().toLocaleString("zh-CN"),twoFactorEnabled:!1,emailVerified:!1};p.push(M),b.success("用户添加成功")}localStorage.setItem("all_users",JSON.stringify(p)),j.value=!1,s()}finally{te.value=!1}}})},se=async A=>{try{const{value:p}=await Ee.prompt(`为用户 "${A.username}" 设置新密码:`,"重置密码",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/.{6,}/,inputErrorMessage:"密码长度至少 6 个字符"}),g=JSON.parse(localStorage.getItem("all_users")||"[]"),M=g.findIndex(H=>String(H.id)===String(A.id));if(M!==-1){g[M].password=p,localStorage.setItem("all_users",JSON.stringify(g));const H=JSON.parse(localStorage.getItem("user_data")||"{}");H.id&&String(H.id)===String(A.id)?b.warning("您的密码已被重置，请重新登录"):b.success("密码重置成功")}else b.error("未找到要重置密码的用户")}catch{}},ne=async A=>{try{const p=A.status==="active"?"禁用":"启用";await Ee.confirm(`确认${p}用户 "${A.username}"？`,`确认${p}`,{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const g=JSON.parse(localStorage.getItem("all_users")||"[]"),M=g.findIndex(H=>String(H.id)===String(A.id));if(M!==-1){const H=A.status==="active"?"disabled":"active";g[M].status=H,localStorage.setItem("all_users",JSON.stringify(g));const B=JSON.parse(localStorage.getItem("user_data")||"{}");if(B.id&&String(B.id)===String(A.id)){const de={...B,status:H};localStorage.setItem("user_data",JSON.stringify(de)),H==="disabled"&&b.warning("您的账户已被禁用，请联系管理员")}A.status=H,b.success(`用户${p}成功`)}else b.error("未找到要修改状态的用户")}catch{}},Ce=A=>{h.value=A,me.value=[{action:"登录",description:"用户登录系统",time:new Date().toLocaleString("zh-CN")},{action:"修改资料",description:"更新个人信息",time:new Date(Date.now()-864e5).toLocaleString("zh-CN")}],K.value=!0},Se=A=>{V.value=A,v.operationType="set",v.amount=A.balance||0,v.reason="",fe.value=ae.getBalanceHistory(A.id),P.value=!0},E=async()=>{if(!v.amount||!v.reason){b.error("请填写完整信息");return}G.value=!0;try{let A=0;const p=V.value.balance||0;switch(v.operationType){case"set":A=v.amount;break;case"add":A=p+v.amount;break;case"subtract":A=Math.max(0,p-v.amount);break}const g=await ae.updateUserBalance(V.value.id,A,v.reason);if(g.success){b.success(g.message),V.value.balance=A;const M=le.value.findIndex(H=>H.id===V.value.id);M!==-1&&(le.value[M].balance=A),ae.user&&String(ae.user.id)===String(V.value.id)&&ae.refreshCurrentUser(),fe.value=ae.getBalanceHistory(V.value.id),P.value=!1}else b.error(g.message)}catch{b.error("更新余额失败")}finally{G.value=!1}},x=()=>{T.value=null,Object.assign(I,{username:"",email:"",password:"",realName:"",phone:"",role:"user",status:"active",balance:0,level:"普通"}),D.value&&D.value.clearValidate()},ye=A=>{R.pageSize=A,R.currentPage=1},Y=A=>{R.currentPage=A};return et(()=>{s()}),(A,p)=>{const g=u("el-icon"),M=u("el-button"),H=u("el-option"),B=u("el-select"),de=u("el-form-item"),ee=u("el-input"),Pe=u("el-form"),be=u("el-table-column"),ge=u("el-tag"),Ne=u("el-table"),De=u("el-pagination"),ue=u("el-card"),ze=u("el-radio"),Ke=u("el-radio-group"),re=u("el-input-number"),Ye=u("el-dialog"),ke=u("el-descriptions-item"),He=u("el-descriptions"),st=dt("loading");return y(),S("div",pl,[e(ue,null,{header:t(()=>[l("div",_l,[p[25]||(p[25]=l("span",null,"用户管理",-1)),e(M,{type:"primary",onClick:p[0]||(p[0]=z=>j.value=!0)},{default:t(()=>[e(g,null,{default:t(()=>[e(F(jt))]),_:1}),p[24]||(p[24]=r(" 添加用户 ",-1))]),_:1,__:[24]})])]),default:t(()=>[l("div",fl,[e(Pe,{model:ce,inline:""},{default:t(()=>[e(de,{label:"用户角色"},{default:t(()=>[e(B,{modelValue:ce.role,"onUpdate:modelValue":p[1]||(p[1]=z=>ce.role=z),placeholder:"全部角色",clearable:""},{default:t(()=>[e(H,{label:"管理员",value:"admin"}),e(H,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),e(de,{label:"账户状态"},{default:t(()=>[e(B,{modelValue:ce.status,"onUpdate:modelValue":p[2]||(p[2]=z=>ce.status=z),placeholder:"全部状态",clearable:""},{default:t(()=>[e(H,{label:"正常",value:"active"}),e(H,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),e(de,{label:"搜索用户"},{default:t(()=>[e(ee,{modelValue:ce.keyword,"onUpdate:modelValue":p[3]||(p[3]=z=>ce.keyword=z),placeholder:"用户名或邮箱",clearable:"",onKeyup:Bt(O,["enter"])},null,8,["modelValue"])]),_:1}),e(de,null,{default:t(()=>[e(M,{type:"primary",onClick:O},{default:t(()=>[e(g,null,{default:t(()=>[e(F($t))]),_:1}),p[26]||(p[26]=r(" 搜索 ",-1))]),_:1,__:[26]}),e(M,{onClick:k},{default:t(()=>[e(g,null,{default:t(()=>[e(F(It))]),_:1}),p[27]||(p[27]=r(" 重置 ",-1))]),_:1,__:[27]})]),_:1})]),_:1},8,["model"])]),ct((y(),Ve(Ne,{data:f.value,style:{width:"100%"}},{default:t(()=>[e(be,{prop:"id",label:"ID",width:"80"}),e(be,{prop:"username",label:"用户名","min-width":"120"}),e(be,{prop:"email",label:"邮箱","min-width":"180"}),e(be,{prop:"realName",label:"真实姓名",width:"120"},{default:t(z=>[r(d(z.row.realName||"-"),1)]),_:1}),e(be,{prop:"role",label:"角色",width:"100"},{default:t(z=>[e(ge,{type:z.row.role==="admin"?"danger":"primary"},{default:t(()=>[r(d(z.row.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),e(be,{prop:"status",label:"状态",width:"100"},{default:t(z=>[e(ge,{type:ie(z.row.status)},{default:t(()=>[r(d(W(z.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(be,{prop:"balance",label:"余额",width:"120"},{default:t(z=>[l("span",gl,"¥"+d((z.row.balance||0).toFixed(2)),1)]),_:1}),e(be,{prop:"registerTime",label:"注册时间",width:"160"}),e(be,{label:"操作",width:"280",fixed:"right"},{default:t(z=>[e(M,{type:"primary",size:"small",onClick:Qe=>N(z.row)},{default:t(()=>p[28]||(p[28]=[r(" 编辑 ",-1)])),_:2,__:[28]},1032,["onClick"]),e(M,{type:"success",size:"small",onClick:Qe=>Se(z.row)},{default:t(()=>p[29]||(p[29]=[r(" 余额 ",-1)])),_:2,__:[29]},1032,["onClick"]),e(M,{type:"warning",size:"small",onClick:Qe=>se(z.row)},{default:t(()=>p[30]||(p[30]=[r(" 重置密码 ",-1)])),_:2,__:[30]},1032,["onClick"]),e(M,{type:z.row.status==="active"?"danger":"success",size:"small",onClick:Qe=>ne(z.row)},{default:t(()=>[r(d(z.row.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),e(M,{type:"info",size:"small",onClick:Qe=>Ce(z.row)},{default:t(()=>p[31]||(p[31]=[r(" 详情 ",-1)])),_:2,__:[31]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[st,pe.value]]),e(De,{"current-page":R.currentPage,"onUpdate:currentPage":p[4]||(p[4]=z=>R.currentPage=z),"page-size":R.pageSize,"onUpdate:pageSize":p[5]||(p[5]=z=>R.pageSize=z),"page-sizes":[10,20,50,100],total:R.total,layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:ye,onCurrentChange:Y},null,8,["current-page","page-size","total"])]),_:1}),e(Ye,{modelValue:j.value,"onUpdate:modelValue":p[16]||(p[16]=z=>j.value=z),title:T.value?"编辑用户":"添加用户",width:"600px",onClose:x},{footer:t(()=>[e(M,{onClick:p[15]||(p[15]=z=>j.value=!1)},{default:t(()=>p[36]||(p[36]=[r("取消",-1)])),_:1,__:[36]}),e(M,{type:"primary",onClick:c,loading:te.value},{default:t(()=>[r(d(T.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:t(()=>[e(Pe,{model:I,rules:X,ref_key:"userFormRef",ref:D,"label-width":"100px"},{default:t(()=>[e(de,{label:"用户名",prop:"username"},{default:t(()=>[e(ee,{modelValue:I.username,"onUpdate:modelValue":p[6]||(p[6]=z=>I.username=z),placeholder:"请输入用户名",disabled:!!T.value},null,8,["modelValue","disabled"])]),_:1}),e(de,{label:"邮箱",prop:"email"},{default:t(()=>[e(ee,{modelValue:I.email,"onUpdate:modelValue":p[7]||(p[7]=z=>I.email=z),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),T.value?q("",!0):(y(),Ve(de,{key:0,label:"密码",prop:"password"},{default:t(()=>[e(ee,{modelValue:I.password,"onUpdate:modelValue":p[8]||(p[8]=z=>I.password=z),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),e(de,{label:"真实姓名"},{default:t(()=>[e(ee,{modelValue:I.realName,"onUpdate:modelValue":p[9]||(p[9]=z=>I.realName=z),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),e(de,{label:"手机号"},{default:t(()=>[e(ee,{modelValue:I.phone,"onUpdate:modelValue":p[10]||(p[10]=z=>I.phone=z),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(de,{label:"用户角色",prop:"role"},{default:t(()=>[e(Ke,{modelValue:I.role,"onUpdate:modelValue":p[11]||(p[11]=z=>I.role=z)},{default:t(()=>[e(ze,{label:"user"},{default:t(()=>p[32]||(p[32]=[r("普通用户",-1)])),_:1,__:[32]}),e(ze,{label:"admin"},{default:t(()=>p[33]||(p[33]=[r("管理员",-1)])),_:1,__:[33]})]),_:1},8,["modelValue"])]),_:1}),e(de,{label:"账户状态",prop:"status"},{default:t(()=>[e(Ke,{modelValue:I.status,"onUpdate:modelValue":p[12]||(p[12]=z=>I.status=z)},{default:t(()=>[e(ze,{label:"active"},{default:t(()=>p[34]||(p[34]=[r("正常",-1)])),_:1,__:[34]}),e(ze,{label:"disabled"},{default:t(()=>p[35]||(p[35]=[r("禁用",-1)])),_:1,__:[35]})]),_:1},8,["modelValue"])]),_:1}),T.value?q("",!0):(y(),Ve(de,{key:1,label:"初始余额"},{default:t(()=>[e(re,{modelValue:I.balance,"onUpdate:modelValue":p[13]||(p[13]=z=>I.balance=z),min:0,precision:2,placeholder:"请输入初始余额"},null,8,["modelValue"])]),_:1})),e(de,{label:"会员等级"},{default:t(()=>[e(B,{modelValue:I.level,"onUpdate:modelValue":p[14]||(p[14]=z=>I.level=z),placeholder:"请选择会员等级"},{default:t(()=>[e(H,{label:"普通",value:"普通"}),e(H,{label:"VIP",value:"VIP"}),e(H,{label:"SVIP",value:"SVIP"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Ye,{modelValue:P.value,"onUpdate:modelValue":p[21]||(p[21]=z=>P.value=z),title:"用户余额管理",width:"600px"},{footer:t(()=>[e(M,{onClick:p[20]||(p[20]=z=>P.value=!1)},{default:t(()=>p[43]||(p[43]=[r("取消",-1)])),_:1,__:[43]}),e(M,{type:"primary",onClick:E,loading:G.value,disabled:!v.amount||!v.reason},{default:t(()=>p[44]||(p[44]=[r(" 确认更新 ",-1)])),_:1,__:[44]},8,["loading","disabled"])]),default:t(()=>[V.value?(y(),S("div",vl,[l("div",yl,[p[37]||(p[37]=l("h3",null,"当前余额信息",-1)),e(He,{column:2,border:""},{default:t(()=>[e(ke,{label:"用户名"},{default:t(()=>[r(d(V.value.username),1)]),_:1}),e(ke,{label:"当前余额"},{default:t(()=>[l("span",bl,"¥"+d((V.value.balance||0).toFixed(2)),1)]),_:1}),e(ke,{label:"上次更新"},{default:t(()=>[r(d(V.value.lastBalanceUpdate||"从未更新"),1)]),_:1}),e(ke,{label:"会员等级"},{default:t(()=>[r(d(V.value.level||"普通"),1)]),_:1})]),_:1})]),l("div",wl,[p[41]||(p[41]=l("h3",null,"余额操作",-1)),e(Pe,{model:v,"label-width":"100px"},{default:t(()=>[e(de,{label:"操作类型"},{default:t(()=>[e(Ke,{modelValue:v.operationType,"onUpdate:modelValue":p[17]||(p[17]=z=>v.operationType=z)},{default:t(()=>[e(ze,{label:"set"},{default:t(()=>p[38]||(p[38]=[r("设置余额",-1)])),_:1,__:[38]}),e(ze,{label:"add"},{default:t(()=>p[39]||(p[39]=[r("增加余额",-1)])),_:1,__:[39]}),e(ze,{label:"subtract"},{default:t(()=>p[40]||(p[40]=[r("扣除余额",-1)])),_:1,__:[40]})]),_:1},8,["modelValue"])]),_:1}),e(de,{label:"金额"},{default:t(()=>[e(re,{modelValue:v.amount,"onUpdate:modelValue":p[18]||(p[18]=z=>v.amount=z),min:0,precision:2,placeholder:"请输入金额",style:{width:"200px"}},null,8,["modelValue"]),v.operationType==="set"?(y(),S("span",Vl," 最终余额: ¥"+d(v.amount?v.amount.toFixed(2):"0.00"),1)):v.operationType==="add"?(y(),S("span",hl," 最终余额: ¥"+d(((V.value.balance||0)+(v.amount||0)).toFixed(2)),1)):v.operationType==="subtract"?(y(),S("span",Cl," 最终余额: ¥"+d(Math.max(0,(V.value.balance||0)-(v.amount||0)).toFixed(2)),1)):q("",!0)]),_:1}),e(de,{label:"变更原因"},{default:t(()=>[e(ee,{modelValue:v.reason,"onUpdate:modelValue":p[19]||(p[19]=z=>v.reason=z),type:"textarea",rows:3,placeholder:"请输入余额变更原因（必填）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),l("div",$l,[p[42]||(p[42]=l("h3",null,"最近余额变更记录",-1)),e(Ne,{data:fe.value,style:{width:"100%"},"max-height":"300"},{default:t(()=>[e(be,{prop:"createTime",label:"时间",width:"160"}),e(be,{prop:"oldBalance",label:"原余额",width:"100"},{default:t(z=>[r(" ¥"+d(z.row.oldBalance.toFixed(2)),1)]),_:1}),e(be,{prop:"newBalance",label:"新余额",width:"100"},{default:t(z=>[r(" ¥"+d(z.row.newBalance.toFixed(2)),1)]),_:1}),e(be,{prop:"change",label:"变更",width:"100"},{default:t(z=>[l("span",{class:Vt({"positive-change":z.row.change>0,"negative-change":z.row.change<0})},d(z.row.change>0?"+":"")+d(z.row.change.toFixed(2)),3)]),_:1}),e(be,{prop:"reason",label:"原因"})]),_:1},8,["data"])])])):q("",!0)]),_:1},8,["modelValue"]),e(Ye,{modelValue:K.value,"onUpdate:modelValue":p[23]||(p[23]=z=>K.value=z),title:"用户详情",width:"700px"},{footer:t(()=>[e(M,{onClick:p[22]||(p[22]=z=>K.value=!1)},{default:t(()=>p[46]||(p[46]=[r("关闭",-1)])),_:1,__:[46]})]),default:t(()=>[h.value?(y(),S("div",Il,[e(He,{column:2,border:""},{default:t(()=>[e(ke,{label:"用户ID"},{default:t(()=>[r(d(h.value.id),1)]),_:1}),e(ke,{label:"用户名"},{default:t(()=>[r(d(h.value.username),1)]),_:1}),e(ke,{label:"邮箱"},{default:t(()=>[r(d(h.value.email),1)]),_:1}),e(ke,{label:"真实姓名"},{default:t(()=>[r(d(h.value.realName||"-"),1)]),_:1}),e(ke,{label:"手机号"},{default:t(()=>[r(d(h.value.phone||"-"),1)]),_:1}),e(ke,{label:"用户角色"},{default:t(()=>[e(ge,{type:h.value.role==="admin"?"danger":"primary"},{default:t(()=>[r(d(h.value.role==="admin"?"管理员":"普通用户"),1)]),_:1},8,["type"])]),_:1}),e(ke,{label:"账户状态"},{default:t(()=>[e(ge,{type:ie(h.value.status)},{default:t(()=>[r(d(W(h.value.status)),1)]),_:1},8,["type"])]),_:1}),e(ke,{label:"账户余额"},{default:t(()=>[l("span",Sl,"¥"+d((h.value.balance||0).toFixed(2)),1)]),_:1}),e(ke,{label:"会员等级"},{default:t(()=>[e(ge,{type:i(h.value.level)},{default:t(()=>[r(d(h.value.level||"普通"),1)]),_:1},8,["type"])]),_:1}),e(ke,{label:"邮箱验证"},{default:t(()=>[e(ge,{type:h.value.emailVerified?"success":"warning"},{default:t(()=>[r(d(h.value.emailVerified?"已验证":"未验证"),1)]),_:1},8,["type"])]),_:1}),e(ke,{label:"两步验证"},{default:t(()=>[e(ge,{type:h.value.twoFactorEnabled?"success":"info"},{default:t(()=>[r(d(h.value.twoFactorEnabled?"已开启":"未开启"),1)]),_:1},8,["type"])]),_:1}),e(ke,{label:"注册时间"},{default:t(()=>[r(d(h.value.registerTime),1)]),_:1}),e(ke,{label:"个人简介",span:2},{default:t(()=>[r(d(h.value.bio||"暂无个人简介"),1)]),_:1})]),_:1}),l("div",kl,[p[45]||(p[45]=l("h4",null,"操作记录",-1)),e(Ne,{data:me.value,style:{width:"100%"}},{default:t(()=>[e(be,{prop:"action",label:"操作"}),e(be,{prop:"description",label:"描述"}),e(be,{prop:"time",label:"时间"})]),_:1},8,["data"])])])):q("",!0)]),_:1},8,["modelValue"])])}}},Tl=Xe(xl,[["__scopeId","data-v-46c48e2e"]]),Ul={class:"zone-management"},Dl={class:"card-header"},Al={class:"zones-grid"},Pl={class:"zone-header"},Ll={class:"zone-icon"},Nl={key:0},zl=["src","alt","onError"],Ol={class:"zone-info"},Ml={class:"zone-desc"},Fl={class:"zone-actions"},Rl={class:"zone-stats"},Bl={class:"stat-item"},jl={class:"stat-value"},El={class:"stat-item"},Hl={class:"stat-value"},Zl={class:"stat-item"},Jl={class:"stat-value"},ql={class:"zone-users"},Gl={class:"users-header"},Kl={class:"users-count"},Yl={class:"users-avatars"},Ql=["title"],Wl={key:0,class:"user-level-badge"},Xl=["onClick"],ea={key:1,class:"no-users"},ta={class:"zone-status"},la={class:"update-time"},aa={class:"icon-selector"},oa={class:"icon-grid"},na=["onClick"],sa={class:"custom-icon-upload"},ra={key:0,class:"upload-area"},ia={key:1,class:"custom-icon-preview"},ua=["src"],da={class:"icon-overlay"},ca={key:0,class:"icon-preview"},ma={key:0,class:"preview-icon"},pa=["src"],_a={class:"product-management"},fa={class:"product-toolbar"},ga={class:"toolbar-right"},va={class:"product-name-cell"},ya=["src"],ba={class:"product-name"},wa={class:"product-id"},Va={class:"description-cell"},ha={class:"price-cell"},Ca={class:"current-price"},$a={key:0,class:"original-price"},Ia={class:"product-pagination"},Sa={class:"image-upload"},ka={key:0,class:"image-preview"},xa=["src"],Ta={class:"image-overlay"},Ua={key:1,class:"image-placeholder"},Da={class:"card-types-section"},Aa={class:"card-types-header"},Pa={key:0,class:"card-types-list"},La={class:"card-type-info"},Na={class:"card-type-name"},za={class:"card-type-desc"},Oa={class:"card-type-stats"},Ma={class:"stock-count"},Fa={key:1,class:"empty-card-types"},Ra={class:"custom-duration-input"},Ba={class:"custom-duration-preview"},ja={key:0,class:"duration-preview-text"},Ea={class:"zone-users-content"},Ha={class:"users-stats"},Za={class:"stat-card"},Ja={class:"stat-number"},qa={class:"stat-card"},Ga={class:"stat-number"},Ka={class:"stat-card"},Ya={class:"stat-number"},Qa={class:"users-list"},Wa={class:"user-info"},Xa={class:"user-details"},eo={class:"user-name"},to={class:"user-username"},lo={class:"amount"},ao={__name:"ZoneManagement",setup(tt){$(!1);const ae=$(!1),pe=$(!1),te=$(!1),G=$(!1),j=$(!1),K=$(!1),P=$(!1),T=$(null),h=$(null),V=$(null),D=$(null),le=$(""),me=$(1),fe=$(20),ce=$(),R=$(),I=$(),v=$("emoji"),X=["🎮","💻","👑","💳","📱","🎵","📺","🎬","📚","🛍️","🎯","⚡","🔥","💎","🌟","🚀"],f=$([{id:1,name:"游戏专区",icon:"🎮",description:"热门游戏卡密和充值服务",isActive:!0,productCount:15,totalSales:1250,revenue:125e3,sortOrder:100,updateTime:"2024-01-13 14:30:25"},{id:2,name:"软件专区",icon:"💻",description:"各类软件授权和订阅服务",isActive:!0,productCount:8,totalSales:580,revenue:89e3,sortOrder:90,updateTime:"2024-01-13 12:15:10"}]),ie=$([{id:1,username:"gamer001",realName:"李小明",avatar:"/default-avatar.jpg",level:"黄金会员",totalSpent:"2350.00",registerTime:"2023-08-15T10:30:00Z",lastLoginTime:"2024-01-13T09:20:00Z",favoriteZones:[1],isActive:!0},{id:2,username:"techpro",realName:"张雯雯",avatar:"",level:"钻石会员",totalSpent:"5680.00",registerTime:"2023-06-20T15:45:00Z",lastLoginTime:"2024-01-13T11:15:00Z",favoriteZones:[2],isActive:!0},{id:3,username:"casual_user",realName:"王大华",avatar:"",level:"普通",totalSpent:"320.00",registerTime:"2023-12-01T08:20:00Z",lastLoginTime:"2024-01-12T16:30:00Z",favoriteZones:[1,2],isActive:!0}]),W=$([{id:1,zoneId:1,name:"Steam 钱包充值卡 100元",description:"全球通用，即时到账，支持所有Steam游戏购买",price:100,originalPrice:105,type:"充值卡",validity:"永久有效",stock:150,sales:520,isHot:!0,isNew:!1,isActive:!0,sortOrder:100,image:null,createTime:"2024-01-10 10:30:00",updateTime:"2024-01-13 14:25:00"},{id:2,zoneId:1,name:"原神创世结晶 6480个",description:"官方正版，安全可靠，支持iOS/Android/PC全平台",price:648,originalPrice:680,type:"游戏充值",validity:"永久有效",stock:88,sales:156,isHot:!1,isNew:!0,isActive:!0,sortOrder:95,image:null,createTime:"2024-01-12 15:20:00",updateTime:"2024-01-13 11:45:00"}]),i=ve({name:"",icon:"🎯",customIcon:"",iconType:"emoji",description:"",isActive:!0,sortOrder:50}),s=ve({name:"",description:"",price:0,originalPrice:0,type:"",validity:"",stock:0,isHot:!1,isNew:!1,isActive:!0,sortOrder:50,image:null,cardTypes:[]}),O=$(!1),k=$(-1),N=$(null),c=ve({name:"",description:"",duration:"",customDurationValue:1,customDurationUnit:"天"}),se={name:[{required:!0,message:"请输入类型名称",trigger:"blur"}],duration:[{required:!0,message:"请选择有效期",trigger:"change"}]},ne={name:[{required:!0,message:"请输入专区名称",trigger:"blur"},{min:2,max:20,message:"名称长度在 2 到 20 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入专区描述",trigger:"blur"},{max:100,message:"描述不能超过100个字符",trigger:"blur"}]},Ce={name:[{required:!0,message:"请输入商品名称",trigger:"blur"},{min:2,max:50,message:"名称长度在 2 到 50 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入商品描述",trigger:"blur"},{max:200,message:"描述不能超过200个字符",trigger:"blur"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"},{type:"number",min:.01,message:"价格必须大于0",trigger:"blur"}],stock:[{required:!0,message:"请输入库存数量",trigger:"blur"},{type:"number",min:0,message:"库存不能小于0",trigger:"blur"}],type:[{required:!0,message:"请选择商品类型",trigger:"change"}],validity:[{required:!0,message:"请输入有效期",trigger:"blur"}]},Se=Ae(()=>{if(!V.value)return[];let n=W.value.filter(o=>o.zoneId===V.value.id);if(le.value){const o=le.value.toLowerCase();n=n.filter(w=>w.name.toLowerCase().includes(o)||w.description.toLowerCase().includes(o))}return n}),E=Ae(()=>v.value==="emoji"?i.icon:i.customIcon),x=n=>{T.value=n;const o=n.customIcon&&n.customIcon.trim()!=="";Object.assign(i,{name:n.name,icon:o?"":n.icon||"🎯",customIcon:n.customIcon||"",iconType:o?"custom":"emoji",description:n.description,isActive:n.isActive,sortOrder:n.sortOrder}),v.value=o?"custom":"emoji",G.value=!0},ye=n=>{V.value=n,j.value=!0,te.value=!0,setTimeout(()=>{te.value=!1},500)},Y=async n=>{try{await Ee.confirm(`确认${n.isActive?"禁用":"启用"}专区 "${n.name}"？`,"确认操作",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),n.isActive=!n.isActive,n.updateTime=new Date().toLocaleString("zh-CN"),lt(),b.success(`专区已${n.isActive?"启用":"禁用"}`)}catch{}},A=async n=>{try{await Ee.confirm(`确认删除专区 "${n.name}"？此操作将同时删除该专区下的所有商品，且不可恢复！`,"危险操作",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"error"});const o=f.value.findIndex(w=>w.id===n.id);o!==-1&&f.value.splice(o,1),W.value=W.value.filter(w=>w.zoneId!==n.id),lt(),rt(),b.success("专区及其商品已删除")}catch{}},p=async()=>{ce.value&&(await ce.value.validate(async n=>{if(console.log("基本表单验证结果:",n),n){const o=i.icon&&i.icon.trim()!=="",w=i.customIcon&&i.customIcon.trim()!=="";if(console.log("手动图标检查:",{hasEmojiIcon:o,hasCustomIcon:w,iconValue:i.icon,customIconLength:i.customIcon?i.customIcon.length:0}),!o&&!w){console.error("图标检查失败：未选择任何图标"),b.error("请选择emoji图标或上传自定义图标");return}console.log("图标检查通过，继续保存..."),ae.value=!0;try{if(await new Promise(C=>setTimeout(C,1e3)),console.log("当前表单数据:",{name:i.name,iconType:v.value,icon:i.icon,customIcon:i.customIcon?"已设置（"+i.customIcon.length+"字符）":"未设置"}),T.value){const C={name:i.name,description:i.description,isActive:i.isActive,sortOrder:i.sortOrder,updateTime:new Date().toLocaleString("zh-CN")};v.value==="emoji"?(C.icon=i.icon,C.customIcon=""):(C.icon="",C.customIcon=i.customIcon),Object.assign(T.value,C),console.log("专区数据已更新:",T.value),b.success("专区修改成功")}else{const C={id:Date.now(),name:i.name,description:i.description,isActive:i.isActive,productCount:0,totalSales:0,revenue:0,sortOrder:i.sortOrder,updateTime:new Date().toLocaleString("zh-CN")};v.value==="emoji"?(C.icon=i.icon,C.customIcon=""):(C.icon="",C.customIcon=i.customIcon),f.value.unshift(C),b.success("专区创建成功")}lt(),G.value=!1,setTimeout(()=>{console.log("延迟重置表单..."),re()},300),console.log("保存完成，当前专区数量:",f.value.length)}catch(C){console.error("=== 保存过程中出错 ===",C),b.error("保存失败: "+C.message)}finally{console.log("设置 saving = false"),ae.value=!1}}else console.error("表单验证失败"),b.error("请检查表单数据")}),console.log("=== saveZone 函数结束 ==="))},g=n=>{h.value=n,Object.assign(s,{name:n.name,description:n.description,price:n.price,originalPrice:n.originalPrice,type:n.type,validity:n.validity,stock:n.stock,isHot:n.isHot,isNew:n.isNew,isActive:n.isActive,sortOrder:n.sortOrder,image:n.image,cardTypes:n.cardTypes||[]}),K.value=!0},M=async n=>{try{await Ee.confirm(`确认${n.isActive?"下架":"上架"}商品 "${n.name}"？`,"确认操作",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),n.isActive=!n.isActive,n.updateTime=new Date().toLocaleString("zh-CN"),rt(),b.success(`商品已${n.isActive?"上架":"下架"}`)}catch{}},H=async n=>{try{await Ee.confirm(`确认删除商品 "${n.name}"？此操作不可恢复！`,"确认删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"error"});const o=W.value.findIndex(w=>w.id===n.id);if(o!==-1){W.value.splice(o,1);const w=f.value.find(C=>C.id===n.zoneId);w&&(w.productCount=Math.max(0,w.productCount-1))}rt(),lt(),b.success("商品已删除")}catch{}},B=async()=>{R.value&&await R.value.validate(async n=>{if(n){pe.value=!0;try{if(await new Promise(o=>setTimeout(o,1e3)),h.value)Object.assign(h.value,{name:s.name,description:s.description,price:s.price,originalPrice:s.originalPrice,type:s.type,validity:s.validity,stock:s.stock,isHot:s.isHot,isNew:s.isNew,isActive:s.isActive,sortOrder:s.sortOrder,image:s.image,cardTypes:s.cardTypes||[],updateTime:new Date().toLocaleString("zh-CN")}),b.success("商品修改成功");else{const o={id:Date.now(),zoneId:V.value.id,name:s.name,description:s.description,price:s.price,originalPrice:s.originalPrice,type:s.type,validity:s.validity,stock:s.stock,sales:0,isHot:s.isHot,isNew:s.isNew,isActive:s.isActive,sortOrder:s.sortOrder,image:s.image,cardTypes:s.cardTypes||[],createTime:new Date().toLocaleString("zh-CN"),updateTime:new Date().toLocaleString("zh-CN")};W.value.unshift(o),V.value.productCount++,b.success("商品添加成功")}rt(),lt(),K.value=!1,Ye()}finally{pe.value=!1}}})},de=()=>{b.info("批量导入功能开发中...")},ee=n=>{if(n.raw){const o=new FileReader;o.onload=w=>{s.image=w.target.result},o.readAsDataURL(n.raw)}},Pe=(n,o)=>{},be=n=>{const o=n.type==="image/jpeg"||n.type==="image/png",w=n.size/1024/1024<2;return o||b.error("上传图片只能是 JPG/PNG 格式!"),w||b.error("上传图片大小不能超过 2MB!"),o&&w},ge=n=>{console.log("选择emoji图标:",n),i.icon=n,i.customIcon="",v.value="emoji"},Ne=()=>{console.log("=== 上传组件被点击 ===")},De=(n,o)=>{console.log("=== 上传文件数量超限 ===",n,o),b.warning("只能上传一个文件")},ue=()=>{console.log("=== 保存按钮被点击 ==="),console.log("点击时的详细数据:"),console.log("- name:",i.name),console.log("- iconType:",v.value),console.log("- icon:",i.icon,"(类型:",typeof i.icon,"长度:",i.icon?i.icon.length:0,")"),console.log("- customIcon:",i.customIcon?"有数据":"无数据"),i.customIcon&&(console.log("  - customIcon 类型:",typeof i.customIcon),console.log("  - customIcon 长度:",i.customIcon.length),console.log("  - customIcon 前50字符:",i.customIcon.substring(0,50))),console.log("- description:",i.description),console.log("- isActive:",i.isActive),console.log("- sortOrder:",i.sortOrder);const n=i.icon&&i.icon.trim()!=="",o=i.customIcon&&i.customIcon.trim()!=="";console.log("=== 保存条件检查 ==="),console.log("hasEmojiIcon:",n),console.log("hasCustomIcon:",o),console.log("图标条件满足:",n||o),p()},ze=n=>{var w,C;if(console.log("=== 图片上传开始 ===",{file:n,raw:n==null?void 0:n.raw,name:n==null?void 0:n.name,size:(w=n==null?void 0:n.raw)==null?void 0:w.size,type:(C=n==null?void 0:n.raw)==null?void 0:C.type}),!n||!n.raw){console.error("文件对象为空或缺少raw属性"),b.error("文件选择失败，请重试");return}if(console.log("开始处理文件:",n.name,"大小:",n.raw.size,"bytes"),n.raw.size===0){console.error("文件为空"),b.error("文件为空，请选择有效文件");return}if(n.raw.size>10*1024*1024){console.error("文件太大:",n.raw.size),b.error("文件太大，请选择小于10MB的文件");return}console.log("文件验证通过，开始读取文件...");const o=new FileReader;o.onload=J=>{console.log("FileReader onload 事件触发");try{const _e=J.target.result;console.log("文件读取成功，数据长度:",_e.length),console.log("数据类型:",typeof _e),console.log("数据前50个字符:",_e.substring(0,50)),i.customIcon=_e,i.icon="",v.value="custom",i.iconType="custom",console.log("zoneForm.customIcon 已设置，长度:",i.customIcon.length),console.log("iconType.value:",v.value),console.log("zoneForm.iconType:",i.iconType),b.success("图片上传成功！现在可以保存了")}catch(_e){console.error("文件处理错误:",_e),b.error("文件处理失败: "+_e.message)}},o.onerror=J=>{console.error("FileReader 错误:",J),b.error("文件读取失败，请重试")},o.onprogress=J=>{if(J.lengthComputable){const _e=J.loaded/J.total*100;console.log("文件读取进度:",_e.toFixed(1)+"%")}},console.log("开始调用 reader.readAsDataURL..."),o.readAsDataURL(n.raw)},Ke=()=>{console.log("移除自定义图标，恢复为emoji"),i.customIcon="",i.icon="🎯",v.value="emoji",I.value&&I.value.clearFiles()},re=()=>{console.log("=== 重置表单 ==="),ce.value&&ce.value.clearValidate(),Object.assign(i,{name:"",icon:"🎯",customIcon:"",iconType:"emoji",description:"",isActive:!0,sortOrder:50}),v.value="emoji",T.value=null,I.value&&I.value.clearFiles(),console.log("表单重置完成，默认图标:",i.icon),console.log("重置后的表单数据:",{name:i.name,icon:i.icon,customIcon:i.customIcon,iconType:v.value})},Ye=()=>{Object.assign(s,{name:"",description:"",price:0,originalPrice:0,type:"",validity:"",stock:0,isHot:!1,isNew:!1,isActive:!0,sortOrder:50,image:null,cardTypes:[]}),h.value=null},ke=()=>{Object.assign(c,{name:"",description:"",duration:"",customDurationValue:1,customDurationUnit:"天"}),k.value=-1},He=Ae(()=>{if(c.duration!=="custom"||!c.customDurationValue||!c.customDurationUnit)return"";const n=c.customDurationValue,o=c.customDurationUnit;return`${n}${o}`}),st=n=>{n!=="custom"&&(c.customDurationValue=1,c.customDurationUnit="天")},z=()=>{ke(),O.value=!0},Qe=n=>{const o=s.cardTypes[n];o.isCustomDuration?Object.assign(c,{name:o.name,description:o.description,duration:"custom",customDurationValue:o.customDurationValue||1,customDurationUnit:o.customDurationUnit||"天"}):Object.assign(c,{name:o.name,description:o.description,duration:o.duration,customDurationValue:1,customDurationUnit:"天"}),console.log("编辑卡密类型，原始ID:",o.id,typeof o.id),k.value=n,O.value=!0},St=n=>{s.cardTypes.splice(n,1),b.success("删除成功")},kt=async()=>{try{if(!N.value)return;await N.value.validate();let n=c.duration;if(c.duration==="custom"){if(!c.customDurationValue||!c.customDurationUnit){b.error("请完善自定义时间设置");return}n=`${c.customDurationValue}${c.customDurationUnit}`}const o={id:k.value!==-1?String(s.cardTypes[k.value].id):String(Date.now()),name:c.name,description:c.description,duration:n,isCustomDuration:c.duration==="custom",customDurationValue:c.duration==="custom"?c.customDurationValue:null,customDurationUnit:c.duration==="custom"?c.customDurationUnit:null};console.log("保存卡密类型数据:",o),k.value!==-1?(s.cardTypes[k.value]=o,b.success("修改成功")):(s.cardTypes.push(o),b.success("添加成功")),O.value=!1,ke()}catch(n){console.error("保存卡密类型失败:",n)}},xt=n=>{const o={"7天":"info","1个月":"success","3个月":"warning","6个月":"danger","1年":"danger",永久:"success"};if(o[n])return o[n];const w=n.match(/^(\d+)(天|周|个月|年)$/);if(w){const C=parseInt(w[1]),J=w[2];let _e=0;switch(J){case"天":_e=C;break;case"周":_e=C*7;break;case"个月":_e=C*30;break;case"年":_e=C*365;break}return _e<=30?"info":_e<=90?"success":_e<=180?"warning":"danger"}return"info"},Tt=n=>{var o;try{const w=JSON.parse(localStorage.getItem("all_cards")||"[]"),C=f.value.find(he=>he.id===selectedZone.value),J=C==null?void 0:C.products.find(he=>{var Oe;return he.id===((Oe=h.value)==null?void 0:Oe.id)});if(console.log("=== 统计卡密类型库存 ==="),console.log("卡密类型ID:",n),console.log("当前选中专区:",selectedZone.value,C==null?void 0:C.name),console.log("当前编辑商品:",(o=h.value)==null?void 0:o.id,J==null?void 0:J.name),console.log("所有卡密数量:",w.length),!J||!C)return console.log("找不到当前商品或专区，返回0"),0;const _e=w.filter(he=>he.zoneId===C.id&&he.productId===J.id);console.log("相关商品的所有卡密:",_e.length,"张");const $e=_e.filter(he=>{const Oe=String(he.cardTypeId),it=String(n),Fe=Oe===it,oe=he.status==="unused",Re=!he.purchasedBy;return console.log(`卡密 ${he.cardNumber} 检查:`,{cardTypeId:he.cardTypeId,cardTypeIdStr:Oe,targetTypeId:n,targetTypeIdStr:it,typeMatch:Fe,statusMatch:oe,notPurchased:Re}),Fe&&oe&&Re});return console.log("该类型可用卡密:",$e.length,"张"),_e.length>0&&console.log("卡密样本:",_e.slice(0,3).map(he=>({cardNumber:he.cardNumber,cardTypeId:he.cardTypeId,status:he.status,zoneId:he.zoneId,productId:he.productId}))),$e.length}catch(w){return console.error("统计库存失败:",w),0}},lt=()=>{console.log("=== saveZonesData 开始 ===");try{console.log("准备保存的专区数据:",f.value.length,"个专区"),f.value.forEach((C,J)=>{console.log(`专区 ${J+1}:`,{id:C.id,name:C.name,hasIcon:!!C.icon,hasCustomIcon:!!C.customIcon,customIconLength:C.customIcon?C.customIcon.length:0,customIconType:C.customIcon?C.customIcon.startsWith("data:")?"base64":"other":"none"})});const n=JSON.stringify(f.value);console.log("序列化后的数据大小:",n.length,"字符"),localStorage.setItem("card_zones",n),console.log("localStorage.setItem 调用完成");const o=localStorage.getItem("card_zones");if(!o)throw new Error("保存失败：数据未成功写入localStorage");console.log("验证保存成功，读取数据大小:",o.length,"字符");const w=JSON.parse(o);console.log("解析数据成功，专区数量:",w.length),console.log("=== 专区数据保存成功 ===")}catch(n){console.error("=== 保存专区数据失败 ===",n),b.error("保存失败："+n.message)}},rt=()=>{console.log("=== 保存商品数据 ==="),console.log("商品数量:",W.value.length),W.value.forEach((n,o)=>{var w;console.log(`商品 ${o+1}:`,{id:n.id,name:n.name,zoneId:n.zoneId,cardTypesCount:((w=n.cardTypes)==null?void 0:w.length)||0,cardTypes:n.cardTypes})}),localStorage.setItem("card_products",JSON.stringify(W.value)),console.log("商品数据保存完成")},Ut=()=>{console.log("=== loadData 开始 ===");try{const n=localStorage.getItem("card_zones");if(console.log("localStorage 中的专区数据:",n?n.length+"字符":"无数据"),n){const w=JSON.parse(n);f.value=w,console.log("加载专区数据成功:",w.length,"个专区"),w.forEach((J,_e)=>{console.log(`加载的专区 ${_e+1}:`,{id:J.id,name:J.name,icon:J.icon||"无",hasCustomIcon:!!J.customIcon,customIconLength:J.customIcon?J.customIcon.length:0})});const C=w.filter(J=>J.customIcon&&J.customIcon.trim()!=="");C.length>0?(console.log("发现",C.length,"个专区使用了自定义图标"),C.forEach(J=>{console.log(`- ${J.name}: ${J.customIcon.substring(0,50)}...`)})):console.log("没有发现使用自定义图标的专区")}else console.log("未找到已保存的专区数据，使用默认数据");const o=localStorage.getItem("card_products");o?(W.value=JSON.parse(o),console.log("加载商品数据成功:",W.value.length,"个商品"),W.value.forEach((w,C)=>{var J;console.log(`加载的商品 ${C+1}:`,{id:w.id,name:w.name,zoneId:w.zoneId,cardTypesCount:((J=w.cardTypes)==null?void 0:J.length)||0,cardTypes:w.cardTypes})})):console.log("未找到已保存的商品数据"),console.log("=== loadData 完成 ===")}catch(n){console.error("=== 加载数据失败 ===",n),b.error("加载数据失败，请刷新页面重试")}},Dt=n=>{console.warn(`专区 ${n.name} 的自定义图标加载失败，恢复为emoji图标`),n.customIcon="",n.icon||(n.icon="🎯"),lt()},vt=()=>{try{const n=localStorage.getItem("all_users");n&&(ie.value=JSON.parse(n))}catch(n){console.error("加载用户数据失败:",n)}},Ze=n=>n?ie.value.filter(o=>o.favoriteZones&&o.favoriteZones.includes(n.id)).sort((o,w)=>parseFloat(w.totalSpent||0)-parseFloat(o.totalSpent||0)):[],U=n=>{const o=new Date;return o.setDate(o.getDate()-30),Ze(n).filter(w=>w.lastLoginTime?new Date(w.lastLoginTime)>o:!1)},a=n=>Ze(n).reduce((C,J)=>C+parseFloat(J.totalSpent||0),0).toFixed(2),L=n=>{D.value=n,P.value=!0},Q=n=>{b.info(`查看用户 ${n.realName||n.username} 的详情`)},Z=n=>({普通:"info",青铜会员:"warning",黄金会员:"success",白金会员:"primary",钻石会员:"danger"})[n]||"info",Ie=n=>{console.warn(`用户 ${n.username} 的头像加载失败`)},xe=n=>{if(!n)return"-";try{return new Date(n).toLocaleDateString("zh-CN")}catch{return"-"}};return et(()=>{Ut(),vt()}),(n,o)=>{var bt,pt;const w=u("el-icon"),C=u("el-button"),J=u("el-dropdown-item"),_e=u("el-dropdown-menu"),$e=u("el-dropdown"),he=u("el-avatar"),Oe=u("el-tag"),it=u("el-card"),Fe=u("el-input"),oe=u("el-form-item"),Re=u("el-tab-pane"),Je=u("el-upload"),we=u("el-tabs"),We=u("el-input-number"),Ge=u("el-switch"),at=u("el-form"),qe=u("el-dialog"),Me=u("el-table-column"),At=u("el-tooltip"),mt=u("el-table"),Le=u("el-pagination"),Te=u("el-col"),Ue=u("el-option"),ut=u("el-select"),ot=u("el-row"),yt=dt("loading");return y(),S("div",Ul,[e(it,null,{header:t(()=>[l("div",Dl,[o[37]||(o[37]=l("span",null,"🎯 专区管理",-1)),e(C,{type:"primary",onClick:o[0]||(o[0]=m=>G.value=!0)},{default:t(()=>[e(w,null,{default:t(()=>[e(F(nt))]),_:1}),o[36]||(o[36]=r(" 创建专区 ",-1))]),_:1,__:[36]})])]),default:t(()=>[l("div",Al,[(y(!0),S(Be,null,je(f.value,m=>(y(),S("div",{key:m.id,class:Vt(["zone-card",{active:m.isActive}])},[l("div",Pl,[l("div",Ll,[!m.customIcon||m.customIcon.trim()===""?(y(),S("span",Nl,d(m.icon||"🎯"),1)):(y(),S("img",{key:1,src:m.customIcon,alt:m.name,class:"custom-zone-icon",onError:_=>Dt(m)},null,40,zl))]),l("div",Ol,[l("h3",null,d(m.name),1),l("p",Ml,d(m.description),1)]),l("div",Fl,[e($e,{trigger:"click"},{dropdown:t(()=>[e(_e,null,{default:t(()=>[e(J,{onClick:_=>x(m)},{default:t(()=>[e(w,null,{default:t(()=>[e(F(Lt))]),_:1}),o[38]||(o[38]=r(" 编辑专区 ",-1))]),_:2,__:[38]},1032,["onClick"]),e(J,{onClick:_=>ye(m)},{default:t(()=>[e(w,null,{default:t(()=>[e(F(Ht))]),_:1}),o[39]||(o[39]=r(" 管理商品 ",-1))]),_:2,__:[39]},1032,["onClick"]),e(J,{onClick:_=>Y(m),divided:!0},{default:t(()=>[e(w,null,{default:t(()=>[e(F(Zt))]),_:1}),r(" "+d(m.isActive?"禁用专区":"启用专区"),1)]),_:2},1032,["onClick"]),e(J,{onClick:_=>A(m),style:{color:"#F56C6C"}},{default:t(()=>[e(w,null,{default:t(()=>[e(F(ft))]),_:1}),o[40]||(o[40]=r(" 删除专区 ",-1))]),_:2,__:[40]},1032,["onClick"])]),_:2},1024)]),default:t(()=>[e(C,{type:"text"},{default:t(()=>[e(w,null,{default:t(()=>[e(F(Et))]),_:1})]),_:1})]),_:2},1024)])]),l("div",Rl,[l("div",Bl,[l("div",jl,d(m.productCount),1),o[41]||(o[41]=l("div",{class:"stat-label"},"商品数量",-1))]),l("div",El,[l("div",Hl,d(m.totalSales),1),o[42]||(o[42]=l("div",{class:"stat-label"},"总销量",-1))]),l("div",Zl,[l("div",Jl,"¥"+d(m.revenue.toFixed(2)),1),o[43]||(o[43]=l("div",{class:"stat-label"},"营收",-1))])]),l("div",ql,[l("div",Gl,[o[44]||(o[44]=l("span",{class:"users-title"},"👥 活跃用户",-1)),l("span",Kl,d(Ze(m).length)+"人",1)]),l("div",Yl,[(y(!0),S(Be,null,je(Ze(m).slice(0,5),_=>(y(),S("div",{key:_.id,class:"user-avatar-wrapper",title:`${_.realName||_.username}
等级: ${_.level||"普通"}
消费: ¥${_.totalSpent||"0.00"}`},[e(he,{size:32,src:_.avatar||"",class:"user-avatar",onError:wt=>Ie(_)},{default:t(()=>[e(w,null,{default:t(()=>[e(F(gt))]),_:1})]),_:2},1032,["src","onError"]),_.level&&_.level!=="普通"?(y(),S("div",Wl,d(_.level),1)):q("",!0)],8,Ql))),128)),Ze(m).length>5?(y(),S("div",{key:0,class:"more-users",onClick:_=>L(m)}," +"+d(Ze(m).length-5),9,Xl)):q("",!0),Ze(m).length===0?(y(),S("div",ea,o[45]||(o[45]=[l("span",null,"暂无活跃用户",-1)]))):q("",!0)])]),l("div",ta,[e(Oe,{type:m.isActive?"success":"danger"},{default:t(()=>[r(d(m.isActive?"已启用":"已禁用"),1)]),_:2},1032,["type"]),l("span",la,d(m.updateTime),1)])],2))),128))])]),_:1}),e(qe,{modelValue:G.value,"onUpdate:modelValue":o[8]||(o[8]=m=>G.value=m),title:T.value?"编辑专区":"创建专区",width:"600px"},{footer:t(()=>[e(C,{onClick:o[7]||(o[7]=m=>G.value=!1)},{default:t(()=>o[51]||(o[51]=[r("取消",-1)])),_:1,__:[51]}),e(C,{type:"primary",onClick:ue,loading:ae.value},{default:t(()=>[r(d(T.value?"保存修改":"创建专区"),1)]),_:1},8,["loading"])]),default:t(()=>[e(at,{model:i,rules:ne,ref_key:"zoneFormRef",ref:ce,"label-width":"100px"},{default:t(()=>[e(oe,{label:"专区名称",prop:"name"},{default:t(()=>[e(Fe,{modelValue:i.name,"onUpdate:modelValue":o[1]||(o[1]=m=>i.name=m),placeholder:"请输入专区名称",maxlength:"20","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(oe,{label:"专区图标",prop:"icon"},{default:t(()=>[l("div",aa,[e(we,{modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=m=>v.value=m),class:"icon-tabs"},{default:t(()=>[e(Re,{label:"表情符号",name:"emoji"},{default:t(()=>[e(Fe,{modelValue:i.icon,"onUpdate:modelValue":o[2]||(o[2]=m=>i.icon=m),placeholder:"选择一个表情符号",maxlength:"2",class:"icon-input"},null,8,["modelValue"]),l("div",oa,[(y(),S(Be,null,je(X,m=>l("div",{key:m,class:Vt(["icon-option",{selected:i.icon===m}]),onClick:_=>ge(m)},d(m),11,na)),64))])]),_:1}),e(Re,{label:"自定义图片",name:"custom"},{default:t(()=>[l("div",sa,[e(Je,{ref_key:"iconUploadRef",ref:I,class:"icon-uploader",action:"","auto-upload":!1,"show-file-list":!1,"on-change":ze,"on-exceed":De,limit:1,onClick:Ne},{default:t(()=>[i.customIcon?(y(),S("div",ia,[l("img",{src:i.customIcon,alt:"自定义图标"},null,8,ua),l("div",da,[e(C,{type:"primary",size:"small",onClick:Jt(Ke,["stop"])},{default:t(()=>[e(w,null,{default:t(()=>[e(F(ft))]),_:1}),o[48]||(o[48]=r(" 删除 ",-1))]),_:1,__:[48]})])])):(y(),S("div",ra,[e(w,{class:"upload-icon"},{default:t(()=>[e(F(nt))]),_:1}),o[46]||(o[46]=l("div",{class:"upload-text"},"点击上传图标",-1)),o[47]||(o[47]=l("div",{class:"upload-hint"},"支持 JPG、PNG、SVG 格式，建议尺寸 64x64px",-1))]))]),_:1},512)])]),_:1})]),_:1},8,["modelValue"]),E.value?(y(),S("div",ca,[o[49]||(o[49]=l("span",{class:"preview-label"},"预览：",-1)),v.value==="emoji"?(y(),S("div",ma,d(i.icon),1)):v.value==="custom"&&i.customIcon?(y(),S("img",{key:1,src:i.customIcon,alt:"预览",class:"preview-image"},null,8,pa)):q("",!0)])):q("",!0)])]),_:1}),e(oe,{label:"专区描述",prop:"description"},{default:t(()=>[e(Fe,{modelValue:i.description,"onUpdate:modelValue":o[4]||(o[4]=m=>i.description=m),type:"textarea",rows:3,placeholder:"请输入专区描述",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(oe,{label:"排序权重"},{default:t(()=>[e(We,{modelValue:i.sortOrder,"onUpdate:modelValue":o[5]||(o[5]=m=>i.sortOrder=m),min:0,max:999,"controls-position":"right"},null,8,["modelValue"]),o[50]||(o[50]=l("span",{class:"form-tip"},"数值越大排序越靠前",-1))]),_:1,__:[50]}),e(oe,{label:"专区状态"},{default:t(()=>[e(Ge,{modelValue:i.isActive,"onUpdate:modelValue":o[6]||(o[6]=m=>i.isActive=m),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(qe,{modelValue:j.value,"onUpdate:modelValue":o[13]||(o[13]=m=>j.value=m),title:`${(bt=V.value)==null?void 0:bt.name} - 商品管理`,width:"90%",top:"5vh"},{default:t(()=>[l("div",_a,[l("div",fa,[e(C,{type:"primary",onClick:o[9]||(o[9]=m=>K.value=!0)},{default:t(()=>[e(w,null,{default:t(()=>[e(F(nt))]),_:1}),o[52]||(o[52]=r(" 添加商品 ",-1))]),_:1,__:[52]}),e(C,{onClick:de},{default:t(()=>[e(w,null,{default:t(()=>[e(F(Mt))]),_:1}),o[53]||(o[53]=r(" 批量导入 ",-1))]),_:1,__:[53]}),l("div",ga,[e(Fe,{modelValue:le.value,"onUpdate:modelValue":o[10]||(o[10]=m=>le.value=m),placeholder:"搜索商品...",clearable:"",class:"search-input"},{prefix:t(()=>[e(w,null,{default:t(()=>[e(F($t))]),_:1})]),_:1},8,["modelValue"])])]),ct((y(),Ve(mt,{data:Se.value,style:{width:"100%"}},{default:t(()=>[e(Me,{prop:"name",label:"商品名称",width:"200"},{default:t(m=>[l("div",va,[l("img",{src:m.row.image||"/default-product.jpg",class:"product-thumb"},null,8,ya),l("div",null,[l("div",ba,d(m.row.name),1),l("div",wa,"ID: "+d(m.row.id),1)])])]),_:1}),e(Me,{prop:"description",label:"描述",width:"300"},{default:t(m=>[e(At,{content:m.row.description,placement:"top"},{default:t(()=>[l("div",Va,d(m.row.description),1)]),_:2},1032,["content"])]),_:1}),e(Me,{prop:"price",label:"价格",width:"120"},{default:t(m=>[l("div",ha,[l("span",Ca,"¥"+d(m.row.price.toFixed(2)),1),m.row.originalPrice&&m.row.originalPrice>m.row.price?(y(),S("span",$a," ¥"+d(m.row.originalPrice.toFixed(2)),1)):q("",!0)])]),_:1}),e(Me,{prop:"stock",label:"库存",width:"100"},{default:t(m=>[l("span",{class:Vt({"low-stock":m.row.stock<=10,"out-stock":m.row.stock===0})},d(m.row.stock),3)]),_:1}),e(Me,{prop:"sales",label:"销量",width:"100"}),e(Me,{prop:"status",label:"状态",width:"100"},{default:t(m=>[e(Oe,{type:m.row.isActive?"success":"danger"},{default:t(()=>[r(d(m.row.isActive?"上架":"下架"),1)]),_:2},1032,["type"])]),_:1}),e(Me,{label:"操作",width:"200",fixed:"right"},{default:t(m=>[e(C,{type:"primary",size:"small",onClick:_=>g(m.row)},{default:t(()=>o[54]||(o[54]=[r(" 编辑 ",-1)])),_:2,__:[54]},1032,["onClick"]),e(C,{type:m.row.isActive?"warning":"success",size:"small",onClick:_=>M(m.row)},{default:t(()=>[r(d(m.row.isActive?"下架":"上架"),1)]),_:2},1032,["type","onClick"]),e(C,{type:"danger",size:"small",onClick:_=>H(m.row)},{default:t(()=>o[55]||(o[55]=[r(" 删除 ",-1)])),_:2,__:[55]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[yt,te.value]]),l("div",Ia,[e(Le,{"current-page":me.value,"onUpdate:currentPage":o[11]||(o[11]=m=>me.value=m),"page-size":fe.value,"onUpdate:pageSize":o[12]||(o[12]=m=>fe.value=m),"page-sizes":[10,20,50,100],total:Se.value.length,layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])])]),_:1},8,["modelValue","title"]),e(qe,{modelValue:K.value,"onUpdate:modelValue":o[26]||(o[26]=m=>K.value=m),title:h.value?"编辑商品":"添加商品",width:"800px"},{footer:t(()=>[e(C,{onClick:o[25]||(o[25]=m=>K.value=!1)},{default:t(()=>o[63]||(o[63]=[r("取消",-1)])),_:1,__:[63]}),e(C,{type:"primary",onClick:B,loading:pe.value},{default:t(()=>[r(d(h.value?"保存修改":"添加商品"),1)]),_:1},8,["loading"])]),default:t(()=>[e(at,{model:s,rules:Ce,ref_key:"productFormRef",ref:R,"label-width":"120px"},{default:t(()=>[e(ot,{gutter:20},{default:t(()=>[e(Te,{span:12},{default:t(()=>[e(oe,{label:"商品名称",prop:"name"},{default:t(()=>[e(Fe,{modelValue:s.name,"onUpdate:modelValue":o[14]||(o[14]=m=>s.name=m),placeholder:"请输入商品名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Te,{span:12},{default:t(()=>[e(oe,{label:"商品类型",prop:"type"},{default:t(()=>[e(ut,{modelValue:s.type,"onUpdate:modelValue":o[15]||(o[15]=m=>s.type=m),placeholder:"选择商品类型",style:{width:"100%"}},{default:t(()=>[e(Ue,{label:"游戏充值",value:"游戏充值"}),e(Ue,{label:"软件授权",value:"软件授权"}),e(Ue,{label:"会员服务",value:"会员服务"}),e(Ue,{label:"充值卡",value:"充值卡"}),e(Ue,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(oe,{label:"商品描述",prop:"description"},{default:t(()=>[e(Fe,{modelValue:s.description,"onUpdate:modelValue":o[16]||(o[16]=m=>s.description=m),type:"textarea",rows:3,placeholder:"请输入商品描述",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(ot,{gutter:20},{default:t(()=>[e(Te,{span:8},{default:t(()=>[e(oe,{label:"商品价格",prop:"price"},{default:t(()=>[e(We,{modelValue:s.price,"onUpdate:modelValue":o[17]||(o[17]=m=>s.price=m),min:.01,precision:2,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(Te,{span:8},{default:t(()=>[e(oe,{label:"原价"},{default:t(()=>[e(We,{modelValue:s.originalPrice,"onUpdate:modelValue":o[18]||(o[18]=m=>s.originalPrice=m),min:.01,precision:2,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(Te,{span:8},{default:t(()=>[e(oe,{label:"库存数量",prop:"stock"},{default:t(()=>[e(We,{modelValue:s.stock,"onUpdate:modelValue":o[19]||(o[19]=m=>s.stock=m),min:0,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ot,{gutter:20},{default:t(()=>[e(Te,{span:12},{default:t(()=>[e(oe,{label:"有效期",prop:"validity"},{default:t(()=>[e(Fe,{modelValue:s.validity,"onUpdate:modelValue":o[20]||(o[20]=m=>s.validity=m),placeholder:"如：永久有效、1年、30天等"},null,8,["modelValue"])]),_:1})]),_:1}),e(Te,{span:12},{default:t(()=>[e(oe,{label:"排序权重"},{default:t(()=>[e(We,{modelValue:s.sortOrder,"onUpdate:modelValue":o[21]||(o[21]=m=>s.sortOrder=m),min:0,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(oe,{label:"商品图片"},{default:t(()=>[l("div",Sa,[e(Je,{"show-file-list":!1,"on-success":Pe,"before-upload":be,action:"#","auto-upload":!1,"on-change":ee},{default:t(()=>[s.image?(y(),S("div",ka,[l("img",{src:s.image,alt:"商品图片"},null,8,xa),l("div",Ta,[e(w,null,{default:t(()=>[e(F(Lt))]),_:1}),o[56]||(o[56]=l("span",null,"更换图片",-1))])])):(y(),S("div",Ua,[e(w,null,{default:t(()=>[e(F(nt))]),_:1}),o[57]||(o[57]=l("span",null,"上传图片",-1))]))]),_:1})])]),_:1}),e(oe,{label:"卡密类型"},{default:t(()=>[l("div",Da,[l("div",Aa,[o[59]||(o[59]=l("span",null,"管理商品的卡密类型",-1)),e(C,{size:"small",type:"primary",onClick:z},{default:t(()=>[e(w,null,{default:t(()=>[e(F(nt))]),_:1}),o[58]||(o[58]=r(" 添加类型 ",-1))]),_:1,__:[58]})]),s.cardTypes&&s.cardTypes.length>0?(y(),S("div",Pa,[(y(!0),S(Be,null,je(s.cardTypes,(m,_)=>(y(),S("div",{key:_,class:"card-type-item"},[l("div",La,[l("span",Na,d(m.name),1),l("span",za,d(m.description),1),e(Oe,{type:xt(m.duration),size:"small"},{default:t(()=>[r(d(m.duration),1)]),_:2},1032,["type"])]),l("div",Oa,[l("span",Ma,"库存: "+d(Tt(m.id))+"张",1),e(C,{size:"small",type:"primary",text:"",onClick:wt=>Qe(_)},{default:t(()=>o[60]||(o[60]=[r(" 编辑 ",-1)])),_:2,__:[60]},1032,["onClick"]),e(C,{size:"small",type:"danger",text:"",onClick:wt=>St(_)},{default:t(()=>o[61]||(o[61]=[r(" 删除 ",-1)])),_:2,__:[61]},1032,["onClick"])])]))),128))])):(y(),S("div",Fa,o[62]||(o[62]=[l("span",null,"暂无卡密类型，点击上方按钮添加",-1)])))])]),_:1}),e(ot,{gutter:20},{default:t(()=>[e(Te,{span:8},{default:t(()=>[e(oe,{label:"热销标记"},{default:t(()=>[e(Ge,{modelValue:s.isHot,"onUpdate:modelValue":o[22]||(o[22]=m=>s.isHot=m)},null,8,["modelValue"])]),_:1})]),_:1}),e(Te,{span:8},{default:t(()=>[e(oe,{label:"新品标记"},{default:t(()=>[e(Ge,{modelValue:s.isNew,"onUpdate:modelValue":o[23]||(o[23]=m=>s.isNew=m)},null,8,["modelValue"])]),_:1})]),_:1}),e(Te,{span:8},{default:t(()=>[e(oe,{label:"商品状态"},{default:t(()=>[e(Ge,{modelValue:s.isActive,"onUpdate:modelValue":o[24]||(o[24]=m=>s.isActive=m),"active-text":"上架","inactive-text":"下架"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(qe,{modelValue:O.value,"onUpdate:modelValue":o[33]||(o[33]=m=>O.value=m),title:k.value!==-1?"编辑卡密类型":"添加卡密类型",width:"500px"},{footer:t(()=>[e(C,{onClick:o[32]||(o[32]=m=>O.value=!1)},{default:t(()=>o[64]||(o[64]=[r("取消",-1)])),_:1,__:[64]}),e(C,{type:"primary",onClick:kt},{default:t(()=>[r(d(k.value!==-1?"保存修改":"添加类型"),1)]),_:1})]),default:t(()=>[e(at,{model:c,rules:se,ref_key:"cardTypeFormRef",ref:N,"label-width":"100px"},{default:t(()=>[e(oe,{label:"类型名称",prop:"name"},{default:t(()=>[e(Fe,{modelValue:c.name,"onUpdate:modelValue":o[27]||(o[27]=m=>c.name=m),placeholder:"如：月卡、季卡、年卡",maxlength:"20","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(oe,{label:"类型描述",prop:"description"},{default:t(()=>[e(Fe,{modelValue:c.description,"onUpdate:modelValue":o[28]||(o[28]=m=>c.description=m),type:"textarea",rows:2,placeholder:"请输入类型描述",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(oe,{label:"有效期",prop:"duration"},{default:t(()=>[e(ut,{modelValue:c.duration,"onUpdate:modelValue":o[29]||(o[29]=m=>c.duration=m),placeholder:"选择有效期",style:{width:"100%"},onChange:st},{default:t(()=>[e(Ue,{label:"7天",value:"7天"}),e(Ue,{label:"1个月",value:"1个月"}),e(Ue,{label:"3个月",value:"3个月"}),e(Ue,{label:"6个月",value:"6个月"}),e(Ue,{label:"1年",value:"1年"}),e(Ue,{label:"永久",value:"永久"}),e(Ue,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),c.duration==="custom"?(y(),Ve(oe,{key:0,label:"自定义时间",prop:"customDuration"},{default:t(()=>[l("div",Ra,[e(We,{modelValue:c.customDurationValue,"onUpdate:modelValue":o[30]||(o[30]=m=>c.customDurationValue=m),min:1,max:9999,placeholder:"输入数值",style:{width:"120px","margin-right":"8px"}},null,8,["modelValue"]),e(ut,{modelValue:c.customDurationUnit,"onUpdate:modelValue":o[31]||(o[31]=m=>c.customDurationUnit=m),placeholder:"选择单位",style:{width:"100px"}},{default:t(()=>[e(Ue,{label:"天",value:"天"}),e(Ue,{label:"周",value:"周"}),e(Ue,{label:"个月",value:"个月"}),e(Ue,{label:"年",value:"年"})]),_:1},8,["modelValue"])]),l("div",Ba,[He.value?(y(),S("span",ja," 预览："+d(He.value),1)):q("",!0)])]),_:1})):q("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(qe,{modelValue:P.value,"onUpdate:modelValue":o[35]||(o[35]=m=>P.value=m),title:`${(pt=D.value)==null?void 0:pt.name} - 活跃用户`,width:"800px"},{footer:t(()=>[e(C,{onClick:o[34]||(o[34]=m=>P.value=!1)},{default:t(()=>o[69]||(o[69]=[r("关闭",-1)])),_:1,__:[69]})]),default:t(()=>[l("div",Ea,[l("div",Ha,[e(ot,{gutter:16},{default:t(()=>[e(Te,{span:8},{default:t(()=>[l("div",Za,[l("div",Ja,d(Ze(D.value).length),1),o[65]||(o[65]=l("div",{class:"stat-label"},"总用户数",-1))])]),_:1}),e(Te,{span:8},{default:t(()=>[l("div",qa,[l("div",Ga,d(U(D.value).length),1),o[66]||(o[66]=l("div",{class:"stat-label"},"活跃用户",-1))])]),_:1}),e(Te,{span:8},{default:t(()=>[l("div",Ka,[l("div",Ya,"¥"+d(a(D.value)),1),o[67]||(o[67]=l("div",{class:"stat-label"},"总消费",-1))])]),_:1})]),_:1})]),l("div",Qa,[e(mt,{data:Ze(D.value),style:{width:"100%"}},{default:t(()=>[e(Me,{label:"用户",width:"200"},{default:t(m=>[l("div",Wa,[e(he,{size:40,src:m.row.avatar||"",class:"user-avatar",onError:_=>Ie(m.row)},{default:t(()=>[e(w,null,{default:t(()=>[e(F(gt))]),_:1})]),_:2},1032,["src","onError"]),l("div",Xa,[l("div",eo,d(m.row.realName||m.row.username),1),l("div",to,"@"+d(m.row.username),1)])])]),_:1}),e(Me,{prop:"level",label:"等级",width:"120"},{default:t(m=>[e(Oe,{type:Z(m.row.level)},{default:t(()=>[r(d(m.row.level||"普通"),1)]),_:2},1032,["type"])]),_:1}),e(Me,{label:"消费金额",width:"120"},{default:t(m=>[l("span",lo,"¥"+d(m.row.totalSpent||"0.00"),1)]),_:1}),e(Me,{prop:"registerTime",label:"注册时间",width:"150"},{default:t(m=>[l("span",null,d(xe(m.row.registerTime)),1)]),_:1}),e(Me,{label:"状态",width:"100"},{default:t(m=>[e(Oe,{type:m.row.isActive!==!1?"success":"danger"},{default:t(()=>[r(d(m.row.isActive!==!1?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(Me,{label:"操作",width:"120"},{default:t(m=>[e(C,{type:"primary",size:"small",onClick:_=>Q(m.row)},{default:t(()=>o[68]||(o[68]=[r(" 查看详情 ",-1)])),_:2,__:[68]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])])]),_:1},8,["modelValue","title"])])}}},oo=Xe(ao,[["__scopeId","data-v-45bd35fd"]]),no={class:"vip-management"},so={class:"card-header"},ro={class:"stats-section"},io={class:"stats-grid"},uo={class:"stat-card"},co={class:"stat-content"},mo={class:"stat-number"},po={class:"stat-card"},_o={class:"stat-content"},fo={class:"stat-number"},go={class:"stat-card"},vo={class:"stat-content"},yo={class:"stat-number"},bo={class:"stat-card"},wo={class:"stat-content"},Vo={class:"stat-number"},ho={class:"stat-card"},Co={class:"stat-content"},$o={class:"stat-number"},Io={class:"stat-card"},So={class:"stat-content"},ko={class:"stat-number"},xo={class:"pricing-section"},To={class:"pricing-group"},Uo={class:"pricing-grid"},Do={class:"package-name"},Ao={class:"price-input-group"},Po={class:"package-duration"},Lo={class:"pricing-group"},No={class:"pricing-grid"},zo={class:"package-name"},Oo={class:"price-input-group"},Mo={class:"package-duration"},Fo={class:"orders-section"},Ro={class:"section-header"},Bo={class:"pagination-wrapper"},jo={__name:"VipManagement",setup(tt){const ae=cl(),pe=$(!1),te=$(1),G=$(10),j=Ae(()=>ae.getVipStats()),K=Ae(()=>ae.vipPackages),P=$([]),T=Ae(()=>{const I=(te.value-1)*G.value,v=I+G.value;return P.value.slice(I,v)}),h=async()=>{pe.value=!0;try{P.value=ae.getVipOrders(),b.success("数据刷新成功")}catch{b.error("数据刷新失败")}finally{pe.value=!1}},V=async(I,v,X)=>{pe.value=!0;try{const f=ae.updateVipPricing(I,v,X);f.success?b.success(f.message):b.error(f.message)}catch{b.error("价格更新失败")}finally{pe.value=!1}},D=I=>({pending:"warning",completed:"success",cancelled:"danger"})[I]||"info",le=I=>({pending:"待支付",completed:"已完成",cancelled:"已取消"})[I]||"未知",me=I=>({balance:"余额",alipay:"支付宝",wechat:"微信",bank:"银行卡"})[I]||I,fe=I=>{G.value=I,te.value=1},ce=I=>{te.value=I},R=()=>{try{const I=[["订单号","用户名","套餐名称","时长(天)","金额","支付方式","状态","创建时间","完成时间"].join(","),...P.value.map(ie=>[ie.orderNumber,ie.username,ie.packageName,ie.duration,ie.amount,me(ie.paymentMethod),le(ie.status),ie.createTime,ie.completedTime||""].join(","))].join(`
`),v=new Blob([I],{type:"text/csv;charset=utf-8;"}),X=document.createElement("a"),f=URL.createObjectURL(v);X.setAttribute("href",f),X.setAttribute("download",`vip_orders_${new Date().getTime()}.csv`),X.style.visibility="hidden",document.body.appendChild(X),X.click(),document.body.removeChild(X),b.success("订单导出成功")}catch{b.error("订单导出失败")}};return et(()=>{h()}),(I,v)=>{const X=u("el-button"),f=u("el-input-number"),ie=u("el-table-column"),W=u("el-tag"),i=u("el-table"),s=u("el-pagination"),O=u("el-card");return y(),S("div",no,[e(O,{class:"management-card"},{header:t(()=>[l("div",so,[v[3]||(v[3]=l("h3",null,[l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",class:"header-icon"},[l("path",{d:"M6,2L8,6L12,7L8,8L6,12L4,8L0,7L4,6L6,2M12,8L13.5,11L17,12L13.5,13L12,16L10.5,13L7,12L10.5,11L12,8M19,2L20.5,5L24,6L20.5,7L19,10L17.5,7L14,6L17.5,5L19,2Z"})]),r(" VIP会员管理 ")],-1)),e(X,{type:"primary",onClick:h,loading:pe.value},{default:t(()=>v[2]||(v[2]=[r(" 刷新数据 ",-1)])),_:1,__:[2]},8,["loading"])])]),default:t(()=>[l("div",ro,[v[16]||(v[16]=l("h4",null,"会员统计",-1)),l("div",io,[l("div",uo,[v[5]||(v[5]=l("div",{class:"stat-icon total"},[l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"},[l("path",{d:"M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2M4 18v-6h3v6h2v-7.5c0-1.1.9-2 2-2s2 .9 2 2V18h2v-6h3l-2.54-7.63A1.5 1.5 0 0 0 14.18 3H9.82c-.69 0-1.31.45-1.49 1.1L5.81 12H9v6H4Z"})])],-1)),l("div",co,[l("div",mo,d(j.value.totalUsers),1),v[4]||(v[4]=l("div",{class:"stat-label"},"总用户数",-1))])]),l("div",po,[v[7]||(v[7]=l("div",{class:"stat-icon normal"},[l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"},[l("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 7V9C15 11.8 12.8 14 10 14S5 11.8 5 9V7H3V9C3 13.4 6.6 17 11 17V21H13V17C17.4 17 21 13.4 21 9Z"})])],-1)),l("div",_o,[l("div",fo,d(j.value.normalUsers),1),v[6]||(v[6]=l("div",{class:"stat-label"},"普通用户",-1))])]),l("div",go,[v[9]||(v[9]=l("div",{class:"stat-icon vip"},[l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"},[l("path",{d:"M5 16L3 14l5.5-5.5L10 10l4-4L16.5 8.5L18 7l3 3-8.5 8.5L8 14l-3 2z"})])],-1)),l("div",vo,[l("div",yo,d(j.value.vipUsers),1),v[8]||(v[8]=l("div",{class:"stat-label"},"VIP用户",-1))])]),l("div",bo,[v[11]||(v[11]=l("div",{class:"stat-icon svip"},[l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"},[l("path",{d:"M6,2L8,6L12,7L8,8L6,12L4,8L0,7L4,6L6,2M12,8L13.5,11L17,12L13.5,13L12,16L10.5,13L7,12L10.5,11L12,8M19,2L20.5,5L24,6L20.5,7L19,10L17.5,7L14,6L17.5,5L19,2Z"})])],-1)),l("div",wo,[l("div",Vo,d(j.value.svipUsers),1),v[10]||(v[10]=l("div",{class:"stat-label"},"SVIP用户",-1))])]),l("div",ho,[v[13]||(v[13]=l("div",{class:"stat-icon active"},[l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"},[l("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"})])],-1)),l("div",Co,[l("div",$o,d(j.value.activeVipUsers),1),v[12]||(v[12]=l("div",{class:"stat-label"},"活跃VIP",-1))])]),l("div",Io,[v[15]||(v[15]=l("div",{class:"stat-icon revenue"},[l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"},[l("path",{d:"M7,15H9C9,16.08 10.37,17 12,17C13.63,17 15,16.08 15,15C15,13.9 13.96,13.5 11.76,12.97C9.64,12.44 7,11.78 7,9C7,7.21 8.47,5.69 10.5,5.18V3H13.5V5.18C15.53,5.69 17,7.21 17,9H15C15,7.92 13.63,7 12,7C10.37,7 9,7.92 9,9C9,10.1 10.04,10.5 12.24,11.03C14.36,11.56 17,12.22 17,15C17,16.79 15.53,18.31 13.5,18.82V21H10.5V18.82C8.47,18.31 7,16.79 7,15Z"})])],-1)),l("div",So,[l("div",ko,"¥"+d(j.value.totalRevenue.toFixed(2)),1),v[14]||(v[14]=l("div",{class:"stat-label"},"总收入",-1))])])])]),l("div",xo,[v[23]||(v[23]=l("h4",null,"VIP价格管理",-1)),l("div",To,[v[19]||(v[19]=l("div",{class:"group-header"},[l("h5",null,"VIP会员价格"),l("div",{class:"discount-info"},"用户购买享受95折优惠")],-1)),l("div",Uo,[(y(!0),S(Be,null,je(K.value.VIP,(k,N)=>(y(),S("div",{key:N,class:"pricing-card"},[l("div",Do,d(k.name),1),l("div",Ao,[v[17]||(v[17]=l("label",null,"价格：",-1)),e(f,{modelValue:k.currentPrice,"onUpdate:modelValue":c=>k.currentPrice=c,min:0,precision:2,step:1,size:"small",class:"price-input"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",Po,d(k.duration)+"天",1),e(X,{type:"primary",size:"small",onClick:c=>V("VIP",N,k.currentPrice),loading:pe.value},{default:t(()=>v[18]||(v[18]=[r(" 更新 ",-1)])),_:2,__:[18]},1032,["onClick","loading"])]))),128))])]),l("div",Lo,[v[22]||(v[22]=l("div",{class:"group-header"},[l("h5",null,"SVIP超级会员价格"),l("div",{class:"discount-info svip"},"用户购买享受90折优惠")],-1)),l("div",No,[(y(!0),S(Be,null,je(K.value.SVIP,(k,N)=>(y(),S("div",{key:N,class:"pricing-card svip"},[l("div",zo,d(k.name),1),l("div",Oo,[v[20]||(v[20]=l("label",null,"价格：",-1)),e(f,{modelValue:k.currentPrice,"onUpdate:modelValue":c=>k.currentPrice=c,min:0,precision:2,step:1,size:"small",class:"price-input"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",Mo,d(k.duration)+"天",1),e(X,{type:"primary",size:"small",onClick:c=>V("SVIP",N,k.currentPrice),loading:pe.value},{default:t(()=>v[21]||(v[21]=[r(" 更新 ",-1)])),_:2,__:[21]},1032,["onClick","loading"])]))),128))])])]),l("div",Fo,[l("div",Ro,[v[25]||(v[25]=l("h4",null,"VIP订单管理",-1)),e(X,{type:"success",size:"small",onClick:R},{default:t(()=>v[24]||(v[24]=[r(" 导出订单 ",-1)])),_:1,__:[24]})]),e(i,{data:T.value,class:"vip-orders-table",stripe:"",loading:pe.value},{default:t(()=>[e(ie,{prop:"orderNumber",label:"订单号",width:"140"}),e(ie,{prop:"username",label:"用户",width:"120"}),e(ie,{prop:"packageName",label:"套餐",width:"120"}),e(ie,{prop:"duration",label:"时长",width:"80",align:"center"},{default:t(k=>[r(d(k.row.duration)+"天 ",1)]),_:1}),e(ie,{prop:"amount",label:"金额",width:"100",align:"right"},{default:t(k=>[r(" ¥"+d(k.row.amount),1)]),_:1}),e(ie,{prop:"paymentMethod",label:"支付方式",width:"100",align:"center"},{default:t(k=>[e(W,{size:"small"},{default:t(()=>[r(d(me(k.row.paymentMethod)),1)]),_:2},1024)]),_:1}),e(ie,{prop:"status",label:"状态",width:"100",align:"center"},{default:t(k=>[e(W,{type:D(k.row.status),size:"small"},{default:t(()=>[r(d(le(k.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(ie,{prop:"createTime",label:"创建时间",width:"140"}),e(ie,{prop:"completedTime",label:"完成时间",width:"140"},{default:t(k=>[r(d(k.row.completedTime||"-"),1)]),_:1})]),_:1},8,["data","loading"]),l("div",Bo,[e(s,{"current-page":te.value,"onUpdate:currentPage":v[0]||(v[0]=k=>te.value=k),"page-size":G.value,"onUpdate:pageSize":v[1]||(v[1]=k=>G.value=k),"page-sizes":[10,20,50,100],total:P.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:fe,onCurrentChange:ce},null,8,["current-page","page-size","total"])])])]),_:1})])}}},Eo=Xe(jo,[["__scopeId","data-v-1d710c1b"]]),Ho={class:"announcement-manager"},Zo={class:"card-header"},Jo=["innerHTML"],qo={key:0,class:"announcement-view"},Go={class:"announcement-header"},Ko={class:"announcement-meta"},Yo={class:"meta-info"},Qo=["innerHTML"],Wo={__name:"AnnouncementManager",setup(tt){const ae=ml(),pe=Ct(),te=$(!1),G=$(!1),j=$(!1),K=$(!1),P=$(null),T=$(null),h=$(),V=$([]),D=ve({title:"",content:"",type:"info",priority:"normal",showOnHome:!1}),le={title:[{required:!0,message:"请输入公告标题",trigger:"blur"},{min:5,max:100,message:"标题长度在 5 到 100 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"},{min:10,max:2e3,message:"内容长度在 10 到 2000 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}]},me=i=>({info:"primary",success:"success",warning:"warning",error:"danger"})[i]||"primary",fe=i=>ae.getAnnouncementTypeText(i),ce=i=>ae.getPriorityText(i),R=async()=>{te.value=!0,(await ae.fetchAnnouncements()).success&&(V.value=ae.announcements),te.value=!1},I=async()=>{h.value&&await h.value.validate(async i=>{var s;if(i){G.value=!0;try{const O={...D,author:((s=pe.user)==null?void 0:s.username)||"admin"};let k;P.value?k=await ae.updateAnnouncement(P.value.id,O):k=await ae.createAnnouncement(O),k.success?(b.success(k.message),j.value=!1,R()):b.error(k.message)}finally{G.value=!1}}})},v=i=>{P.value=i,Object.assign(D,{title:i.title,content:i.content,type:i.type,priority:i.priority,showOnHome:i.showOnHome}),j.value=!0},X=i=>{T.value=i,K.value=!0},f=async i=>{try{await Ee.confirm(`确认删除公告 "${i.title}"？`,"确认删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const s=await ae.deleteAnnouncement(i.id);s.success?(b.success(s.message),R()):b.error(s.message)}catch{}},ie=async i=>{const s=await ae.updateAnnouncement(i.id,{title:i.title,content:i.content,type:i.type,priority:i.priority,showOnHome:i.showOnHome});s.success?b.success("设置已更新"):(b.error(s.message),i.showOnHome=!i.showOnHome)},W=()=>{P.value=null,Object.assign(D,{title:"",content:"",type:"info",priority:"normal",showOnHome:!1}),h.value&&h.value.clearValidate()};return et(()=>{R()}),(i,s)=>{const O=u("el-icon"),k=u("el-button"),N=u("el-table-column"),c=u("el-tag"),se=u("el-switch"),ne=u("el-table"),Ce=u("el-card"),Se=u("el-input"),E=u("el-form-item"),x=u("el-option"),ye=u("el-select"),Y=u("el-radio"),A=u("el-radio-group"),p=u("el-checkbox"),g=u("el-form"),M=u("el-dialog"),H=dt("loading");return y(),S("div",Ho,[e(Ce,null,{header:t(()=>[l("div",Zo,[s[11]||(s[11]=l("span",null,"公告管理",-1)),e(k,{type:"primary",onClick:s[0]||(s[0]=B=>j.value=!0)},{default:t(()=>[e(O,null,{default:t(()=>[e(F(nt))]),_:1}),s[10]||(s[10]=r(" 发布公告 ",-1))]),_:1,__:[10]})])]),default:t(()=>[ct((y(),Ve(ne,{data:V.value,style:{width:"100%"}},{default:t(()=>[e(N,{prop:"title",label:"标题","min-width":"200"}),e(N,{prop:"type",label:"类型",width:"100"},{default:t(B=>[e(c,{type:me(B.row.type)},{default:t(()=>[r(d(fe(B.row.type)),1)]),_:2},1032,["type"])]),_:1}),e(N,{prop:"priority",label:"优先级",width:"100"},{default:t(B=>[e(c,{type:B.row.priority==="high"?"danger":B.row.priority==="normal"?"warning":"info",size:"small"},{default:t(()=>[r(d(ce(B.row.priority)),1)]),_:2},1032,["type"])]),_:1}),e(N,{prop:"showOnHome",label:"首页显示",width:"100"},{default:t(B=>[e(se,{modelValue:B.row.showOnHome,"onUpdate:modelValue":de=>B.row.showOnHome=de,onChange:de=>ie(B.row),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(N,{prop:"author",label:"作者",width:"100"}),e(N,{prop:"createTime",label:"创建时间",width:"160"}),e(N,{label:"操作",width:"200",fixed:"right"},{default:t(B=>[e(k,{type:"primary",size:"small",onClick:de=>v(B.row)},{default:t(()=>s[12]||(s[12]=[r(" 编辑 ",-1)])),_:2,__:[12]},1032,["onClick"]),e(k,{type:"info",size:"small",onClick:de=>X(B.row)},{default:t(()=>s[13]||(s[13]=[r(" 查看 ",-1)])),_:2,__:[13]},1032,["onClick"]),e(k,{type:"danger",size:"small",onClick:de=>f(B.row)},{default:t(()=>s[14]||(s[14]=[r(" 删除 ",-1)])),_:2,__:[14]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,te.value]])]),_:1}),e(M,{modelValue:j.value,"onUpdate:modelValue":s[7]||(s[7]=B=>j.value=B),title:P.value?"编辑公告":"发布公告",width:"700px",onClose:W},{footer:t(()=>[e(k,{onClick:s[6]||(s[6]=B=>j.value=!1)},{default:t(()=>s[19]||(s[19]=[r("取消",-1)])),_:1,__:[19]}),e(k,{type:"primary",onClick:I,loading:G.value},{default:t(()=>[r(d(P.value?"更新":"发布"),1)]),_:1},8,["loading"])]),default:t(()=>[e(g,{model:D,rules:le,ref_key:"formRef",ref:h,"label-width":"100px"},{default:t(()=>[e(E,{label:"公告标题",prop:"title"},{default:t(()=>[e(Se,{modelValue:D.title,"onUpdate:modelValue":s[1]||(s[1]=B=>D.title=B),placeholder:"请输入公告标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(E,{label:"公告类型",prop:"type"},{default:t(()=>[e(ye,{modelValue:D.type,"onUpdate:modelValue":s[2]||(s[2]=B=>D.type=B),placeholder:"请选择公告类型"},{default:t(()=>[e(x,{label:"通知",value:"info"}),e(x,{label:"成功",value:"success"}),e(x,{label:"警告",value:"warning"}),e(x,{label:"错误",value:"error"})]),_:1},8,["modelValue"])]),_:1}),e(E,{label:"优先级",prop:"priority"},{default:t(()=>[e(A,{modelValue:D.priority,"onUpdate:modelValue":s[3]||(s[3]=B=>D.priority=B)},{default:t(()=>[e(Y,{label:"high"},{default:t(()=>s[15]||(s[15]=[r("高优先级",-1)])),_:1,__:[15]}),e(Y,{label:"normal"},{default:t(()=>s[16]||(s[16]=[r("普通",-1)])),_:1,__:[16]}),e(Y,{label:"low"},{default:t(()=>s[17]||(s[17]=[r("低优先级",-1)])),_:1,__:[17]})]),_:1},8,["modelValue"])]),_:1}),e(E,{label:"显示设置"},{default:t(()=>[e(p,{modelValue:D.showOnHome,"onUpdate:modelValue":s[4]||(s[4]=B=>D.showOnHome=B)},{default:t(()=>s[18]||(s[18]=[r(" 在首页显示 ",-1)])),_:1,__:[18]},8,["modelValue"])]),_:1}),e(E,{label:"公告内容",prop:"content"},{default:t(()=>[e(Se,{modelValue:D.content,"onUpdate:modelValue":s[5]||(s[5]=B=>D.content=B),type:"textarea",rows:8,placeholder:"请输入公告内容，支持HTML标签",maxlength:"2000","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(E,{label:"内容预览"},{default:t(()=>[l("div",{class:"content-preview",innerHTML:D.content},null,8,Jo)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(M,{modelValue:K.value,"onUpdate:modelValue":s[9]||(s[9]=B=>K.value=B),title:"查看公告",width:"600px"},{footer:t(()=>[e(k,{onClick:s[8]||(s[8]=B=>K.value=!1)},{default:t(()=>s[20]||(s[20]=[r("关闭",-1)])),_:1,__:[20]})]),default:t(()=>[T.value?(y(),S("div",qo,[l("div",Go,[l("h2",null,d(T.value.title),1),l("div",Ko,[e(c,{type:me(T.value.type)},{default:t(()=>[r(d(fe(T.value.type)),1)]),_:1},8,["type"]),l("span",Yo," 作者: "+d(T.value.author)+" | 发布时间: "+d(T.value.createTime),1)])]),l("div",{class:"announcement-content",innerHTML:T.value.content},null,8,Qo)])):q("",!0)]),_:1},8,["modelValue"])])}}},Xo=Xe(Wo,[["__scopeId","data-v-c1c34c0f"]]),en={class:"contact-management"},tn={class:"card-header"},ln={class:"stats-summary"},an={class:"filter-bar"},on={key:0,class:"reply-dialog-content"},nn={class:"contact-info"},sn={class:"problem-description"},rn={class:"reply-form"},un={key:0,class:"reply-history"},dn={class:"history-item"},cn={class:"history-meta"},mn={class:"reply-time"},pn={class:"history-content"},_n={__name:"ContactManagement",setup(tt){const ae=ul(),pe=$(!1),te=$(!1),G=$(!1),j=$(!1),K=$(!1),P=$(null),T=$(""),h=$(),V=Ae(()=>ae.contacts),D=ve({status:"",category:"",priority:"",keyword:""}),le=ve({currentPage:1,pageSize:10,total:0}),me=ve({status:"processing",reply:""}),fe={status:[{required:!0,message:"请选择处理状态",trigger:"change"}],reply:[{required:!0,message:"请输入回复内容",trigger:"blur"},{min:10,max:1e3,message:"回复内容长度在 10 到 1000 个字符",trigger:"blur"}]},ce=Ae(()=>V.value.filter(E=>E.status==="pending").length),R=Ae(()=>V.value.filter(E=>E.status==="processing").length),I=Ae(()=>V.value.filter(E=>E.status==="resolved").length),v=Ae(()=>{let E=V.value;if(D.status&&(E=E.filter(Y=>Y.status===D.status)),D.category&&(E=E.filter(Y=>Y.category===D.category)),D.priority&&(E=E.filter(Y=>Y.priority===D.priority)),D.keyword){const Y=D.keyword.toLowerCase();E=E.filter(A=>A.subject.toLowerCase().includes(Y)||A.username.toLowerCase().includes(Y))}le.total=E.length;const x=(le.currentPage-1)*le.pageSize,ye=x+le.pageSize;return E.slice(x,ye)}),X=()=>{le.currentPage=1},f=()=>{D.status="",D.category="",D.priority="",D.keyword="",le.currentPage=1},ie=E=>{P.value=E,E.adminReply?(me.status=E.status,me.reply=""):(me.status="processing",me.reply=""),j.value=!0},W=async()=>{h.value&&await h.value.validate(async E=>{if(E){te.value=!0;try{const x=await ae.replyContact(P.value.id,me);x.success?(b.success(x.message),j.value=!1,O()):b.error(x.message)}finally{te.value=!1}}})},i=E=>{P.value=E,T.value=E.status,K.value=!0},s=async()=>{if(!T.value||T.value===P.value.status){b.warning("请选择不同的状态");return}G.value=!0;try{const E=await ae.updateContactStatus(P.value.id,T.value);E.success?(b.success(E.message),K.value=!1,O()):b.error(E.message)}finally{G.value=!1}},O=async()=>{await ae.fetchContacts(!0)},k=E=>{le.pageSize=E,le.currentPage=1},N=E=>{le.currentPage=E},c=E=>ae.getStatusType(E),se=E=>ae.getStatusText(E),ne=E=>ae.getPriorityType(E),Ce=E=>ae.getPriorityText(E),Se=E=>ae.getCategoryText(E);return et(()=>{O()}),(E,x)=>{const ye=u("el-tag"),Y=u("el-option"),A=u("el-select"),p=u("el-form-item"),g=u("el-input"),M=u("el-icon"),H=u("el-button"),B=u("el-form"),de=u("el-table-column"),ee=u("el-table"),Pe=u("el-pagination"),be=u("el-card"),ge=u("el-descriptions-item"),Ne=u("el-descriptions"),De=u("el-radio"),ue=u("el-radio-group"),ze=u("el-dialog"),Ke=dt("loading");return y(),S("div",en,[e(be,null,{header:t(()=>[l("div",tn,[x[13]||(x[13]=l("span",null,"用户联系管理",-1)),l("div",ln,[e(ye,{type:"warning"},{default:t(()=>[r("待处理: "+d(ce.value),1)]),_:1}),e(ye,{type:"primary"},{default:t(()=>[r("处理中: "+d(R.value),1)]),_:1}),e(ye,{type:"success"},{default:t(()=>[r("已解决: "+d(I.value),1)]),_:1})])])]),default:t(()=>[l("div",an,[e(B,{model:D,inline:""},{default:t(()=>[e(p,{label:"状态"},{default:t(()=>[e(A,{modelValue:D.status,"onUpdate:modelValue":x[0]||(x[0]=re=>D.status=re),placeholder:"全部状态",clearable:""},{default:t(()=>[e(Y,{label:"待处理",value:"pending"}),e(Y,{label:"处理中",value:"processing"}),e(Y,{label:"已解决",value:"resolved"}),e(Y,{label:"已关闭",value:"closed"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"类别"},{default:t(()=>[e(A,{modelValue:D.category,"onUpdate:modelValue":x[1]||(x[1]=re=>D.category=re),placeholder:"全部类别",clearable:""},{default:t(()=>[e(Y,{label:"技术问题",value:"technical"}),e(Y,{label:"账户问题",value:"account"}),e(Y,{label:"支付问题",value:"payment"}),e(Y,{label:"卡密问题",value:"card"}),e(Y,{label:"意见建议",value:"suggestion"}),e(Y,{label:"投诉举报",value:"complaint"}),e(Y,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"优先级"},{default:t(()=>[e(A,{modelValue:D.priority,"onUpdate:modelValue":x[2]||(x[2]=re=>D.priority=re),placeholder:"全部优先级",clearable:""},{default:t(()=>[e(Y,{label:"一般",value:"low"}),e(Y,{label:"普通",value:"normal"}),e(Y,{label:"紧急",value:"high"}),e(Y,{label:"非常紧急",value:"urgent"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"搜索"},{default:t(()=>[e(g,{modelValue:D.keyword,"onUpdate:modelValue":x[3]||(x[3]=re=>D.keyword=re),placeholder:"标题或用户名",clearable:""},null,8,["modelValue"])]),_:1}),e(p,null,{default:t(()=>[e(H,{type:"primary",onClick:X},{default:t(()=>[e(M,null,{default:t(()=>[e(F($t))]),_:1}),x[14]||(x[14]=r(" 搜索 ",-1))]),_:1,__:[14]}),e(H,{onClick:f},{default:t(()=>[e(M,null,{default:t(()=>[e(F(It))]),_:1}),x[15]||(x[15]=r(" 重置 ",-1))]),_:1,__:[15]})]),_:1})]),_:1},8,["model"])]),ct((y(),Ve(ee,{data:v.value,style:{width:"100%"}},{default:t(()=>[e(de,{prop:"subject",label:"问题标题","min-width":"200"}),e(de,{prop:"username",label:"提交用户",width:"120"}),e(de,{prop:"category",label:"类别",width:"120"},{default:t(re=>[r(d(Se(re.row.category)),1)]),_:1}),e(de,{prop:"priority",label:"优先级",width:"100"},{default:t(re=>[e(ye,{type:ne(re.row.priority),size:"small"},{default:t(()=>[r(d(Ce(re.row.priority)),1)]),_:2},1032,["type"])]),_:1}),e(de,{prop:"status",label:"状态",width:"100"},{default:t(re=>[e(ye,{type:c(re.row.status)},{default:t(()=>[r(d(se(re.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(de,{prop:"createTime",label:"提交时间",width:"160"}),e(de,{prop:"replyTime",label:"回复时间",width:"160"},{default:t(re=>[r(d(re.row.replyTime||"-"),1)]),_:1}),e(de,{label:"操作",width:"220",fixed:"right"},{default:t(re=>[e(H,{type:"primary",size:"small",onClick:Ye=>ie(re.row)},{default:t(()=>[r(d(re.row.adminReply?"查看回复":"立即处理"),1)]),_:2},1032,["onClick"]),re.row.status!=="closed"?(y(),Ve(H,{key:0,type:"warning",size:"small",onClick:Ye=>i(re.row)},{default:t(()=>x[16]||(x[16]=[r(" 更改状态 ",-1)])),_:2,__:[16]},1032,["onClick"])):q("",!0)]),_:1})]),_:1},8,["data"])),[[Ke,pe.value]]),e(Pe,{"current-page":le.currentPage,"onUpdate:currentPage":x[4]||(x[4]=re=>le.currentPage=re),"page-size":le.pageSize,"onUpdate:pageSize":x[5]||(x[5]=re=>le.pageSize=re),"page-sizes":[10,20,50,100],total:le.total,layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:k,onCurrentChange:N},null,8,["current-page","page-size","total"])]),_:1}),e(ze,{modelValue:j.value,"onUpdate:modelValue":x[9]||(x[9]=re=>j.value=re),title:P.value?`处理用户问题 - ${P.value.subject}`:"处理问题",width:"800px"},{footer:t(()=>[e(H,{onClick:x[8]||(x[8]=re=>j.value=!1)},{default:t(()=>x[22]||(x[22]=[r("取消",-1)])),_:1,__:[22]}),e(H,{type:"primary",onClick:W,loading:te.value},{default:t(()=>x[23]||(x[23]=[r(" 提交回复 ",-1)])),_:1,__:[23]},8,["loading"])]),default:t(()=>[P.value?(y(),S("div",on,[l("div",nn,[e(Ne,{column:2,border:"",size:"small"},{default:t(()=>[e(ge,{label:"提交用户"},{default:t(()=>[r(d(P.value.username),1)]),_:1}),e(ge,{label:"联系邮箱"},{default:t(()=>[r(d(P.value.email),1)]),_:1}),e(ge,{label:"问题类别"},{default:t(()=>[r(d(Se(P.value.category)),1)]),_:1}),e(ge,{label:"优先级"},{default:t(()=>[e(ye,{type:ne(P.value.priority),size:"small"},{default:t(()=>[r(d(Ce(P.value.priority)),1)]),_:1},8,["type"])]),_:1}),e(ge,{label:"提交时间",span:2},{default:t(()=>[r(d(P.value.createTime),1)]),_:1}),e(ge,{label:"问题描述",span:2},{default:t(()=>[l("div",sn,d(P.value.message),1)]),_:1})]),_:1})]),l("div",rn,[x[20]||(x[20]=l("h4",null,"管理员回复",-1)),e(B,{model:me,rules:fe,ref_key:"replyFormRef",ref:h,"label-width":"100px"},{default:t(()=>[e(p,{label:"处理状态",prop:"status"},{default:t(()=>[e(ue,{modelValue:me.status,"onUpdate:modelValue":x[6]||(x[6]=re=>me.status=re)},{default:t(()=>[e(De,{label:"processing"},{default:t(()=>x[17]||(x[17]=[r("处理中",-1)])),_:1,__:[17]}),e(De,{label:"resolved"},{default:t(()=>x[18]||(x[18]=[r("已解决",-1)])),_:1,__:[18]}),e(De,{label:"closed"},{default:t(()=>x[19]||(x[19]=[r("关闭",-1)])),_:1,__:[19]})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"回复内容",prop:"reply"},{default:t(()=>[e(g,{modelValue:me.reply,"onUpdate:modelValue":x[7]||(x[7]=re=>me.reply=re),type:"textarea",rows:6,placeholder:"请输入详细的回复内容...",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),P.value.adminReply?(y(),S("div",un,[x[21]||(x[21]=l("h4",null,"历史回复",-1)),l("div",dn,[l("div",cn,[l("span",mn,d(P.value.replyTime),1)]),l("div",pn,d(P.value.adminReply),1)])])):q("",!0)])):q("",!0)]),_:1},8,["modelValue","title"]),e(ze,{modelValue:K.value,"onUpdate:modelValue":x[12]||(x[12]=re=>K.value=re),title:"更改状态",width:"400px"},{footer:t(()=>[e(H,{onClick:x[11]||(x[11]=re=>K.value=!1)},{default:t(()=>x[28]||(x[28]=[r("取消",-1)])),_:1,__:[28]}),e(H,{type:"primary",onClick:s,loading:G.value},{default:t(()=>x[29]||(x[29]=[r(" 确认更改 ",-1)])),_:1,__:[29]},8,["loading"])]),default:t(()=>[e(B,{"label-width":"80px"},{default:t(()=>[P.value?(y(),Ve(p,{key:0,label:"当前状态"},{default:t(()=>[e(ye,{type:c(P.value.status)},{default:t(()=>[r(d(se(P.value.status)),1)]),_:1},8,["type"])]),_:1})):q("",!0),e(p,{label:"新状态"},{default:t(()=>[e(ue,{modelValue:T.value,"onUpdate:modelValue":x[10]||(x[10]=re=>T.value=re)},{default:t(()=>[e(De,{label:"pending"},{default:t(()=>x[24]||(x[24]=[r("待处理",-1)])),_:1,__:[24]}),e(De,{label:"processing"},{default:t(()=>x[25]||(x[25]=[r("处理中",-1)])),_:1,__:[25]}),e(De,{label:"resolved"},{default:t(()=>x[26]||(x[26]=[r("已解决",-1)])),_:1,__:[26]}),e(De,{label:"closed"},{default:t(()=>x[27]||(x[27]=[r("已关闭",-1)])),_:1,__:[27]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},fn=Xe(_n,[["__scopeId","data-v-2c13ea88"]]),gn={class:"server-maintenance"},vn={class:"status-item"},yn={class:"status-content"},bn={class:"status-item"},wn={class:"status-content"},Vn={class:"status-item"},hn={class:"status-content"},Cn={class:"card-header"},$n={class:"card-header"},In={class:"maintenance-preview"},Sn={class:"preview-page"},kn={class:"preview-header"},xn={class:"preview-content"},Tn={class:"maintenance-info"},Un={class:"reason"},Dn={class:"duration"},An={class:"description"},Pn={key:0,class:"contact"},Ln={class:"preview-notice"},Nn={key:0,class:"maintenance-detail"},zn={__name:"ServerMaintenance",setup(tt){const ae=Ct(),pe=$(!1),te=$(!1),G=$(!1),j=$(!1),K=$(!1),P=$(),T=$(null),h=ve({isActive:!1,startTime:null,duration:0}),V=ve({title:"系统维护升级",reason:"upgrade",estimatedDuration:60,description:"系统正在进行维护升级，预计需要1小时。维护期间所有功能将暂停使用，请耐心等待。",contact:"AQ0007N"}),D=$([]),le=ve({currentPage:1,pageSize:10,total:0}),me={title:[{required:!0,message:"请输入维护标题",trigger:"blur"},{min:2,max:50,message:"标题长度在2到50个字符",trigger:"blur"}],reason:[{required:!0,message:"请选择维护原因",trigger:"change"}],estimatedDuration:[{required:!0,message:"请输入预计维护时长",trigger:"blur"},{type:"number",min:5,max:1440,message:"维护时长应在5分钟到24小时之间",trigger:"blur"}],description:[{required:!0,message:"请输入维护说明",trigger:"blur"},{min:10,max:500,message:"说明长度在10到500个字符",trigger:"blur"}]},fe=Ae(()=>h.isActive?JSON.parse(localStorage.getItem("all_users")||"[]").length:0),ce=N=>{if(N<60)return`${N} 分钟`;{const c=Math.floor(N/60),se=N%60;return se>0?`${c} 小时 ${se} 分钟`:`${c} 小时`}},R=N=>({upgrade:"系统升级",security:"安全更新",performance:"性能优化",bugfix:"Bug修复",database:"数据库维护",server:"服务器维护",other:"其他"})[N]||N,I=N=>({upgrade:"primary",security:"danger",performance:"success",bugfix:"warning",database:"info",server:"danger",other:"info"})[N]||"info",v=async N=>{pe.value=!0;try{if(N){await Ee.confirm("启用维护模式后，所有用户将无法正常使用系统功能。确认启用？","启用维护模式",{confirmButtonText:"确认启用",cancelButtonText:"取消",type:"warning"});const c={id:Date.now(),title:V.title,reason:V.reason,estimatedDuration:V.estimatedDuration,description:V.description,contact:V.contact,startTime:new Date().toLocaleString("zh-CN"),endTime:null,actualDuration:0,operator:ae.user.username};localStorage.setItem("maintenance_status",JSON.stringify({isActive:!0,startTime:new Date().toISOString(),...c}));const se=JSON.parse(localStorage.getItem("maintenance_history")||"[]");se.unshift(c),localStorage.setItem("maintenance_history",JSON.stringify(se)),h.isActive=!0,h.startTime=new Date,b.success("维护模式已启用"),W()}else{await Ee.confirm("关闭维护模式后，用户将恢复正常访问。确认关闭？","关闭维护模式",{confirmButtonText:"确认关闭",cancelButtonText:"取消",type:"success"});const c=Math.floor((new Date-h.startTime)/(1e3*60)),se=JSON.parse(localStorage.getItem("maintenance_history")||"[]");se.length>0&&(se[0].endTime=new Date().toLocaleString("zh-CN"),se[0].actualDuration=c,localStorage.setItem("maintenance_history",JSON.stringify(se))),localStorage.removeItem("maintenance_status"),h.isActive=!1,h.startTime=null,h.duration=0,b.success("维护模式已关闭"),W()}}catch{h.isActive=!N}finally{pe.value=!1}},X=async()=>{P.value&&await P.value.validate(async N=>{if(N){te.value=!0;try{const se={...JSON.parse(localStorage.getItem("maintenance_status")||"{}"),title:V.title,reason:V.reason,estimatedDuration:V.estimatedDuration,description:V.description,contact:V.contact};localStorage.setItem("maintenance_status",JSON.stringify(se));const ne=JSON.parse(localStorage.getItem("maintenance_history")||"[]");ne.length>0&&!ne[0].endTime&&(ne[0]={...ne[0],title:V.title,reason:V.reason,estimatedDuration:V.estimatedDuration,description:V.description,contact:V.contact},localStorage.setItem("maintenance_history",JSON.stringify(ne))),b.success("维护信息已更新"),W()}finally{te.value=!1}}})},f=()=>{j.value=!0},ie=N=>{T.value=N,K.value=!0},W=()=>{G.value=!0;try{const N=JSON.parse(localStorage.getItem("maintenance_history")||"[]");D.value=N,le.total=N.length}finally{G.value=!1}},i=()=>{W(),b.success("历史记录已刷新")},s=N=>{le.pageSize=N},O=N=>{le.currentPage=N},k=()=>{h.isActive&&h.startTime&&(h.duration=Math.floor((new Date-h.startTime)/(1e3*60)))};return et(()=>{const N=localStorage.getItem("maintenance_status");if(N){const c=JSON.parse(N);h.isActive=c.isActive,h.startTime=c.startTime?new Date(c.startTime):null,c.title&&(V.title=c.title),c.reason&&(V.reason=c.reason),c.estimatedDuration&&(V.estimatedDuration=c.estimatedDuration),c.description&&(V.description=c.description),c.contact&&(V.contact=c.contact)}W(),setInterval(k,6e4),k()}),(N,c)=>{const se=u("el-icon"),ne=u("el-card"),Ce=u("el-col"),Se=u("el-row"),E=u("el-switch"),x=u("el-input"),ye=u("el-form-item"),Y=u("el-option"),A=u("el-select"),p=u("el-input-number"),g=u("el-button"),M=u("el-form"),H=u("el-table-column"),B=u("el-tag"),de=u("el-table"),ee=u("el-pagination"),Pe=u("el-alert"),be=u("el-dialog"),ge=u("el-descriptions-item"),Ne=u("el-descriptions"),De=dt("loading");return y(),S("div",gn,[e(Se,{gutter:20,class:"status-row"},{default:t(()=>[e(Ce,{xs:24,sm:12,md:8},{default:t(()=>[e(ne,{class:"status-card"},{default:t(()=>[l("div",vn,[e(se,{class:"status-icon",color:h.isActive?"#F56C6C":"#67C23A"},{default:t(()=>[h.isActive?(y(),Ve(F(ht),{key:0})):(y(),Ve(F(qt),{key:1}))]),_:1},8,["color"]),l("div",yn,[l("h3",null,d(h.isActive?"维护中":"正常运行"),1),c[12]||(c[12]=l("p",null,"服务器状态",-1))])])]),_:1})]),_:1}),e(Ce,{xs:24,sm:12,md:8},{default:t(()=>[e(ne,{class:"status-card"},{default:t(()=>[l("div",bn,[e(se,{class:"status-icon",color:"#409EFF"},{default:t(()=>[e(F(Gt))]),_:1}),l("div",wn,[l("h3",null,d(ce(h.duration)),1),l("p",null,d(h.isActive?"维护时长":"正常运行"),1)])])]),_:1})]),_:1}),e(Ce,{xs:24,sm:12,md:8},{default:t(()=>[e(ne,{class:"status-card"},{default:t(()=>[l("div",Vn,[e(se,{class:"status-icon",color:"#E6A23C"},{default:t(()=>[e(F(gt))]),_:1}),l("div",hn,[l("h3",null,d(fe.value),1),c[13]||(c[13]=l("p",null,"受影响用户",-1))])])]),_:1})]),_:1})]),_:1}),e(ne,{class:"maintenance-control"},{header:t(()=>[l("div",Cn,[c[14]||(c[14]=l("span",null,"维护模式控制",-1)),e(E,{modelValue:h.isActive,"onUpdate:modelValue":c[0]||(c[0]=ue=>h.isActive=ue),"active-text":h.isActive?"维护中":"启用维护","inactive-text":"正常运行","active-color":"#F56C6C","inactive-color":"#67C23A",onChange:v,loading:pe.value},null,8,["modelValue","active-text","loading"])])]),default:t(()=>[e(M,{model:V,rules:me,ref_key:"maintenanceFormRef",ref:P,"label-width":"120px"},{default:t(()=>[e(Se,{gutter:20},{default:t(()=>[e(Ce,{xs:24,md:12},{default:t(()=>[e(ye,{label:"维护标题",prop:"title"},{default:t(()=>[e(x,{modelValue:V.title,"onUpdate:modelValue":c[1]||(c[1]=ue=>V.title=ue),placeholder:"请输入维护公告标题",disabled:!h.isActive},null,8,["modelValue","disabled"])]),_:1}),e(ye,{label:"维护原因",prop:"reason"},{default:t(()=>[e(A,{modelValue:V.reason,"onUpdate:modelValue":c[2]||(c[2]=ue=>V.reason=ue),placeholder:"请选择维护原因",disabled:!h.isActive,class:"full-width"},{default:t(()=>[e(Y,{label:"系统升级",value:"upgrade"}),e(Y,{label:"安全更新",value:"security"}),e(Y,{label:"性能优化",value:"performance"}),e(Y,{label:"Bug修复",value:"bugfix"}),e(Y,{label:"数据库维护",value:"database"}),e(Y,{label:"服务器维护",value:"server"}),e(Y,{label:"其他",value:"other"})]),_:1},8,["modelValue","disabled"])]),_:1}),e(ye,{label:"预计时长",prop:"estimatedDuration"},{default:t(()=>[e(p,{modelValue:V.estimatedDuration,"onUpdate:modelValue":c[3]||(c[3]=ue=>V.estimatedDuration=ue),min:5,max:1440,step:5,placeholder:"分钟",disabled:!h.isActive,class:"full-width"},null,8,["modelValue","disabled"]),c[15]||(c[15]=l("span",{class:"duration-hint"},"（单位：分钟，最多24小时）",-1))]),_:1,__:[15]})]),_:1}),e(Ce,{xs:24,md:12},{default:t(()=>[e(ye,{label:"维护说明",prop:"description"},{default:t(()=>[e(x,{modelValue:V.description,"onUpdate:modelValue":c[4]||(c[4]=ue=>V.description=ue),type:"textarea",rows:4,placeholder:"请输入维护详细说明...",disabled:!h.isActive,maxlength:"500","show-word-limit":""},null,8,["modelValue","disabled"])]),_:1}),e(ye,{label:"联系方式",prop:"contact"},{default:t(()=>[e(x,{modelValue:V.contact,"onUpdate:modelValue":c[5]||(c[5]=ue=>V.contact=ue),placeholder:"客服QQ、微信或邮箱",disabled:!h.isActive},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(ye,null,{default:t(()=>[e(g,{type:"primary",onClick:X,loading:te.value,disabled:!h.isActive},{default:t(()=>c[16]||(c[16]=[r(" 更新维护信息 ",-1)])),_:1,__:[16]},8,["loading","disabled"]),e(g,{type:"warning",onClick:f,disabled:!h.isActive},{default:t(()=>c[17]||(c[17]=[r(" 预览维护页面 ",-1)])),_:1,__:[17]},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1}),e(ne,{class:"maintenance-history"},{header:t(()=>[l("div",$n,[c[19]||(c[19]=l("span",null,"维护历史记录",-1)),e(g,{size:"small",onClick:i},{default:t(()=>[e(se,null,{default:t(()=>[e(F(It))]),_:1}),c[18]||(c[18]=r(" 刷新 ",-1))]),_:1,__:[18]})])]),default:t(()=>[ct((y(),Ve(de,{data:D.value,style:{width:"100%"}},{default:t(()=>[e(H,{prop:"title",label:"维护标题",width:"200"}),e(H,{prop:"reason",label:"维护原因",width:"120"},{default:t(ue=>[e(B,{type:I(ue.row.reason)},{default:t(()=>[r(d(R(ue.row.reason)),1)]),_:2},1032,["type"])]),_:1}),e(H,{prop:"startTime",label:"开始时间",width:"160"}),e(H,{prop:"endTime",label:"结束时间",width:"160"},{default:t(ue=>[r(d(ue.row.endTime||"进行中"),1)]),_:1}),e(H,{prop:"actualDuration",label:"实际时长",width:"120"},{default:t(ue=>[r(d(ce(ue.row.actualDuration||0)),1)]),_:1}),e(H,{prop:"operator",label:"操作员",width:"100"}),e(H,{label:"状态",width:"100"},{default:t(ue=>[e(B,{type:ue.row.endTime?"success":"warning"},{default:t(()=>[r(d(ue.row.endTime?"已完成":"进行中"),1)]),_:2},1032,["type"])]),_:1}),e(H,{label:"操作",width:"120",fixed:"right"},{default:t(ue=>[e(g,{type:"info",size:"small",onClick:ze=>ie(ue.row)},{default:t(()=>c[20]||(c[20]=[r(" 详情 ",-1)])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[De,G.value]]),e(ee,{"current-page":le.currentPage,"onUpdate:currentPage":c[6]||(c[6]=ue=>le.currentPage=ue),"page-size":le.pageSize,"onUpdate:pageSize":c[7]||(c[7]=ue=>le.pageSize=ue),"page-sizes":[10,20,50],total:le.total,layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:s,onCurrentChange:O},null,8,["current-page","page-size","total"])]),_:1}),e(be,{modelValue:j.value,"onUpdate:modelValue":c[9]||(c[9]=ue=>j.value=ue),title:"维护页面预览",width:"80%"},{footer:t(()=>[e(g,{type:"primary",onClick:c[8]||(c[8]=ue=>j.value=!1)},{default:t(()=>c[26]||(c[26]=[r(" 关闭预览 ",-1)])),_:1,__:[26]})]),default:t(()=>[l("div",In,[l("div",Sn,[l("div",kn,[e(se,{class:"maintenance-icon",color:"#F56C6C"},{default:t(()=>[e(F(ht))]),_:1}),l("h1",null,d(V.title||"系统维护中"),1)]),l("div",xn,[l("div",Tn,[l("p",Un,[c[21]||(c[21]=l("strong",null,"维护原因：",-1)),r(d(R(V.reason)),1)]),l("p",Dn,[c[22]||(c[22]=l("strong",null,"预计时长：",-1)),r(d(V.estimatedDuration)+" 分钟 ",1)]),l("p",An,[c[23]||(c[23]=l("strong",null,"维护说明：",-1)),r(d(V.description||"系统正在进行维护升级，暂时无法访问。"),1)]),V.contact?(y(),S("p",Pn,[c[24]||(c[24]=l("strong",null,"联系客服：",-1)),r(d(V.contact),1)])):q("",!0)]),l("div",Ln,[e(Pe,{title:"温馨提示",type:"warning",closable:!1},{default:t(()=>c[25]||(c[25]=[l("p",null,"• 维护期间所有功能将暂停使用",-1),l("p",null,"• 请耐心等待维护完成",-1),l("p",null,"• 如有紧急问题请联系客服",-1)])),_:1,__:[25]})])])])])]),_:1},8,["modelValue"]),e(be,{modelValue:K.value,"onUpdate:modelValue":c[11]||(c[11]=ue=>K.value=ue),title:"维护详情",width:"600px"},{footer:t(()=>[e(g,{type:"primary",onClick:c[10]||(c[10]=ue=>K.value=!1)},{default:t(()=>c[27]||(c[27]=[r(" 关闭 ",-1)])),_:1,__:[27]})]),default:t(()=>[T.value?(y(),S("div",Nn,[e(Ne,{column:2,border:""},{default:t(()=>[e(ge,{label:"维护标题",span:2},{default:t(()=>[r(d(T.value.title),1)]),_:1}),e(ge,{label:"维护原因"},{default:t(()=>[e(B,{type:I(T.value.reason)},{default:t(()=>[r(d(R(T.value.reason)),1)]),_:1},8,["type"])]),_:1}),e(ge,{label:"操作员"},{default:t(()=>[r(d(T.value.operator),1)]),_:1}),e(ge,{label:"开始时间"},{default:t(()=>[r(d(T.value.startTime),1)]),_:1}),e(ge,{label:"结束时间"},{default:t(()=>[r(d(T.value.endTime||"进行中"),1)]),_:1}),e(ge,{label:"预计时长"},{default:t(()=>[r(d(T.value.estimatedDuration)+" 分钟 ",1)]),_:1}),e(ge,{label:"实际时长"},{default:t(()=>[r(d(ce(T.value.actualDuration||0)),1)]),_:1}),e(ge,{label:"维护说明",span:2},{default:t(()=>[r(d(T.value.description),1)]),_:1}),e(ge,{label:"联系方式",span:2},{default:t(()=>[r(d(T.value.contact||"-"),1)]),_:1})]),_:1})])):q("",!0)]),_:1},8,["modelValue"])])}}},On=Xe(zn,[["__scopeId","data-v-2585e760"]]),Mn={class:"security-dashboard"},Fn={class:"stats-item"},Rn={class:"stats-content"},Bn={class:"stats-item"},jn={class:"stats-content"},En={class:"stats-item"},Hn={class:"stats-content"},Zn={class:"stats-item"},Jn={class:"stats-content"},qn={class:"card-header"},Gn={class:"header-actions"},Kn={class:"filter-bar"},Yn={class:"event-details"},Qn={key:0},Wn={key:1},Xn={key:2},es={key:3},ts={key:4},ls={key:0,class:"event-detail"},as={__name:"SecurityDashboard",setup(tt){const ae=$(!1),pe=$(!1),te=$(null),G=$([]),j=ve({action:"",username:"",dateRange:[]}),K=ve({currentPage:1,pageSize:20,total:0}),P=Ae(()=>{const i={totalLogins:0,failedLogins:0,blockedAttempts:0,totalEvents:G.value.length};return G.value.forEach(s=>{s.action==="login_success"&&i.totalLogins++,s.action==="login_failed"&&i.failedLogins++,s.action==="login_blocked"&&i.blockedAttempts++}),i}),T=Ae(()=>{let i=G.value;if(j.action&&(i=i.filter(k=>k.action===j.action)),j.username&&(i=i.filter(k=>{var N;return k.username&&k.username.toLowerCase().includes(j.username.toLowerCase())||((N=k.details)==null?void 0:N.username)&&k.details.username.toLowerCase().includes(j.username.toLowerCase())})),j.dateRange&&j.dateRange.length===2){const[k,N]=j.dateRange;i=i.filter(c=>{const se=new Date(c.timestamp).getTime(),ne=new Date(k).getTime(),Ce=new Date(N).getTime();return se>=ne&&se<=Ce})}K.total=i.length;const s=(K.currentPage-1)*K.pageSize,O=s+K.pageSize;return i.slice(s,O)}),h=i=>({login_success:"success",login_failed:"danger",login_blocked:"warning",admin_login_success:"success",admin_login_failed:"warning",register_success:"success",register_failed:"danger",logout:"info",storage_read:"info",storage_write:"primary",storage_delete:"warning"})[i]||"info",V=i=>({login_success:"登录成功",login_failed:"登录失败",login_blocked:"登录被阻止",admin_login_success:"管理员登录成功",admin_login_failed:"管理员登录失败",login_attempt_invalid_username:"用户名格式错误",register_success:"注册成功",register_failed:"注册失败",register_attempt_invalid_username:"注册用户名错误",register_attempt_invalid_email:"注册邮箱错误",register_attempt_weak_password:"密码强度不足",logout:"用户登出",storage_read:"数据读取",storage_write:"数据写入",storage_delete:"数据删除"})[i]||i,D=i=>({user_not_found:"用户不存在",invalid_password:"密码错误",rate_limit:"频率限制",user_exists:"用户已存在"})[i]||i,le=i=>({enabled:"已启用",disabled:"已禁用",disabled_during_login:"登录时禁用"})[i]||i,me=i=>new Date(i).toLocaleString("zh-CN"),fe=()=>{ae.value=!0;try{G.value=Nt.getLogs(1e3)}finally{ae.value=!1}},ce=()=>{fe(),b.success("日志已刷新")},R=async()=>{try{await Ee.confirm("确认清空所有安全事件日志？此操作不可恢复。","清空确认",{confirmButtonText:"确认清空",cancelButtonText:"取消",type:"warning"}),Nt.clearLogs(),G.value=[],b.success("日志已清空")}catch{}},I=()=>{const i=[["时间","事件类型","用户名","详情","用户代理","URL"].join(","),...T.value.map(N=>{var c;return[me(N.timestamp),V(N.action),N.username||((c=N.details)==null?void 0:c.username)||"",JSON.stringify(N.details).replace(/,/g,";"),(N.userAgent||"").replace(/,/g,";"),N.url||""].join(",")})].join(`
`),s=new Blob([i],{type:"text/csv;charset=utf-8;"}),O=document.createElement("a"),k=URL.createObjectURL(s);O.setAttribute("href",k),O.setAttribute("download",`security_logs_${new Date().getTime()}.csv`),O.style.visibility="hidden",document.body.appendChild(O),O.click(),document.body.removeChild(O),b.success("日志导出成功")},v=()=>{K.currentPage=1},X=()=>{j.action="",j.username="",j.dateRange=[],K.currentPage=1},f=i=>{te.value=i,pe.value=!0},ie=i=>{K.pageSize=i,K.currentPage=1},W=i=>{K.currentPage=i};return et(()=>{fe()}),(i,s)=>{const O=u("el-icon"),k=u("el-card"),N=u("el-col"),c=u("el-row"),se=u("el-button"),ne=u("el-option"),Ce=u("el-select"),Se=u("el-form-item"),E=u("el-input"),x=u("el-date-picker"),ye=u("el-form"),Y=u("el-table-column"),A=u("el-tag"),p=u("el-table"),g=u("el-pagination"),M=u("el-descriptions-item"),H=u("el-descriptions"),B=u("el-dialog"),de=dt("loading");return y(),S("div",Mn,[e(c,{gutter:20,class:"security-stats"},{default:t(()=>[e(N,{xs:24,sm:12,md:6},{default:t(()=>[e(k,{class:"stats-card"},{default:t(()=>[l("div",Fn,[e(O,{class:"stats-icon",color:"#67C23A"},{default:t(()=>[e(F(ht))]),_:1}),l("div",Rn,[l("h3",null,d(P.value.totalLogins),1),s[7]||(s[7]=l("p",null,"总登录次数",-1))])])]),_:1})]),_:1}),e(N,{xs:24,sm:12,md:6},{default:t(()=>[e(k,{class:"stats-card"},{default:t(()=>[l("div",Bn,[e(O,{class:"stats-icon",color:"#F56C6C"},{default:t(()=>[e(F(Kt))]),_:1}),l("div",jn,[l("h3",null,d(P.value.failedLogins),1),s[8]||(s[8]=l("p",null,"登录失败次数",-1))])])]),_:1})]),_:1}),e(N,{xs:24,sm:12,md:6},{default:t(()=>[e(k,{class:"stats-card"},{default:t(()=>[l("div",En,[e(O,{class:"stats-icon",color:"#E6A23C"},{default:t(()=>[e(F(Ft))]),_:1}),l("div",Hn,[l("h3",null,d(P.value.blockedAttempts),1),s[9]||(s[9]=l("p",null,"被阻止的尝试",-1))])])]),_:1})]),_:1}),e(N,{xs:24,sm:12,md:6},{default:t(()=>[e(k,{class:"stats-card"},{default:t(()=>[l("div",Zn,[e(O,{class:"stats-icon",color:"#409EFF"},{default:t(()=>[e(F(Yt))]),_:1}),l("div",Jn,[l("h3",null,d(P.value.totalEvents),1),s[10]||(s[10]=l("p",null,"安全事件总数",-1))])])]),_:1})]),_:1})]),_:1}),e(k,{class:"events-card"},{header:t(()=>[l("div",qn,[s[14]||(s[14]=l("span",null,"安全事件日志",-1)),l("div",Gn,[e(se,{size:"small",onClick:ce},{default:t(()=>[e(O,null,{default:t(()=>[e(F(It))]),_:1}),s[11]||(s[11]=r(" 刷新 ",-1))]),_:1,__:[11]}),e(se,{size:"small",type:"warning",onClick:R},{default:t(()=>[e(O,null,{default:t(()=>[e(F(ft))]),_:1}),s[12]||(s[12]=r(" 清空日志 ",-1))]),_:1,__:[12]}),e(se,{size:"small",type:"success",onClick:I},{default:t(()=>[e(O,null,{default:t(()=>[e(F(Rt))]),_:1}),s[13]||(s[13]=r(" 导出日志 ",-1))]),_:1,__:[13]})])])]),default:t(()=>[l("div",Kn,[e(ye,{model:j,inline:""},{default:t(()=>[e(Se,{label:"事件类型"},{default:t(()=>[e(Ce,{modelValue:j.action,"onUpdate:modelValue":s[0]||(s[0]=ee=>j.action=ee),placeholder:"所有事件",clearable:""},{default:t(()=>[e(ne,{label:"登录成功",value:"login_success"}),e(ne,{label:"登录失败",value:"login_failed"}),e(ne,{label:"登录被阻止",value:"login_blocked"}),e(ne,{label:"管理员登录成功",value:"admin_login_success"}),e(ne,{label:"管理员登录失败",value:"admin_login_failed"}),e(ne,{label:"注册成功",value:"register_success"}),e(ne,{label:"注册失败",value:"register_failed"}),e(ne,{label:"登出",value:"logout"}),e(ne,{label:"数据读取",value:"storage_read"}),e(ne,{label:"数据写入",value:"storage_write"}),e(ne,{label:"数据删除",value:"storage_delete"})]),_:1},8,["modelValue"])]),_:1}),e(Se,{label:"用户名"},{default:t(()=>[e(E,{modelValue:j.username,"onUpdate:modelValue":s[1]||(s[1]=ee=>j.username=ee),placeholder:"输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),e(Se,{label:"时间范围"},{default:t(()=>[e(x,{modelValue:j.dateRange,"onUpdate:modelValue":s[2]||(s[2]=ee=>j.dateRange=ee),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(Se,null,{default:t(()=>[e(se,{type:"primary",onClick:v},{default:t(()=>[e(O,null,{default:t(()=>[e(F($t))]),_:1}),s[15]||(s[15]=r(" 筛选 ",-1))]),_:1,__:[15]}),e(se,{onClick:X},{default:t(()=>[e(O,null,{default:t(()=>[e(F(Qt))]),_:1}),s[16]||(s[16]=r(" 重置 ",-1))]),_:1,__:[16]})]),_:1})]),_:1},8,["model"])]),ct((y(),Ve(p,{data:T.value,style:{width:"100%"}},{default:t(()=>[e(Y,{prop:"timestamp",label:"时间",width:"180"},{default:t(ee=>[r(d(me(ee.row.timestamp)),1)]),_:1}),e(Y,{prop:"action",label:"事件类型",width:"150"},{default:t(ee=>[e(A,{type:h(ee.row.action)},{default:t(()=>[r(d(V(ee.row.action)),1)]),_:2},1032,["type"])]),_:1}),e(Y,{prop:"username",label:"用户",width:"120"},{default:t(ee=>{var Pe;return[r(d(((Pe=ee.row.details)==null?void 0:Pe.username)||ee.row.username||"-"),1)]}),_:1}),e(Y,{prop:"details",label:"详情","min-width":"200"},{default:t(ee=>{var Pe,be,ge,Ne,De;return[l("div",Yn,[(Pe=ee.row.details)!=null&&Pe.reason?(y(),S("div",Qn," 原因: "+d(D(ee.row.details.reason)),1)):q("",!0),(be=ee.row.details)!=null&&be.errors?(y(),S("div",Wn," 错误: "+d(ee.row.details.errors.join(", ")),1)):q("",!0),(ge=ee.row.details)!=null&&ge.blockTimeMinutes?(y(),S("div",Xn," 阻止时间: "+d(ee.row.details.blockTimeMinutes)+" 分钟 ",1)):q("",!0),(Ne=ee.row.details)!=null&&Ne.key?(y(),S("div",es," 存储键: "+d(ee.row.details.key),1)):q("",!0),(De=ee.row.details)!=null&&De.securityMode?(y(),S("div",ts," 安全模式: "+d(le(ee.row.details.securityMode)),1)):q("",!0)])]}),_:1}),e(Y,{prop:"userAgent",label:"用户代理",width:"200","show-overflow-tooltip":""}),e(Y,{prop:"url",label:"页面",width:"150","show-overflow-tooltip":""}),e(Y,{label:"操作",width:"100",fixed:"right"},{default:t(ee=>[e(se,{type:"info",size:"small",onClick:Pe=>f(ee.row)},{default:t(()=>s[17]||(s[17]=[r(" 详情 ",-1)])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,ae.value]]),e(g,{"current-page":K.currentPage,"onUpdate:currentPage":s[3]||(s[3]=ee=>K.currentPage=ee),"page-size":K.pageSize,"onUpdate:pageSize":s[4]||(s[4]=ee=>K.pageSize=ee),"page-sizes":[20,50,100,200],total:K.total,layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:ie,onCurrentChange:W},null,8,["current-page","page-size","total"])]),_:1}),e(B,{modelValue:pe.value,"onUpdate:modelValue":s[6]||(s[6]=ee=>pe.value=ee),title:"事件详情",width:"600px"},{footer:t(()=>[e(se,{type:"primary",onClick:s[5]||(s[5]=ee=>pe.value=!1)},{default:t(()=>s[18]||(s[18]=[r(" 关闭 ",-1)])),_:1,__:[18]})]),default:t(()=>[te.value?(y(),S("div",ls,[e(H,{column:1,border:""},{default:t(()=>[e(M,{label:"事件ID"},{default:t(()=>[r(d(te.value.id),1)]),_:1}),e(M,{label:"时间"},{default:t(()=>[r(d(me(te.value.timestamp)),1)]),_:1}),e(M,{label:"事件类型"},{default:t(()=>[e(A,{type:h(te.value.action)},{default:t(()=>[r(d(V(te.value.action)),1)]),_:1},8,["type"])]),_:1}),e(M,{label:"用户ID"},{default:t(()=>[r(d(te.value.userId||"-"),1)]),_:1}),e(M,{label:"用户名"},{default:t(()=>[r(d(te.value.username||"-"),1)]),_:1}),e(M,{label:"URL"},{default:t(()=>[r(d(te.value.url),1)]),_:1}),e(M,{label:"用户代理"},{default:t(()=>[r(d(te.value.userAgent),1)]),_:1}),e(M,{label:"详细信息"},{default:t(()=>[l("pre",null,d(JSON.stringify(te.value.details,null,2)),1)]),_:1})]),_:1})])):q("",!0)]),_:1},8,["modelValue"])])}}},os=Xe(as,[["__scopeId","data-v-b8b056b8"]]),ns={class:"payment-settings"},ss={class:"card-header"},rs={class:"payment-form"},is={key:0},us={class:"payment-form"},ds={key:0},cs={class:"payment-form"},ms={key:0},ps={key:1},_s={class:"payment-form"},fs={class:"test-section"},gs={class:"test-buttons"},vs={__name:"PaymentSettings",setup(tt){const ae=$("alipay"),pe=$(!1),te=$(!1),G=$(!1),j=$(),K=$(),P=ve({enabled:!1,appId:"",privateKey:"",alipayPublicKey:"",gateway:"https://openapi.alipaydev.com/gateway.do",notifyUrl:"",returnUrl:""}),T=ve({enabled:!1,appId:"",mchId:"",apiKey:"",certPath:"",keyPath:"",notifyUrl:""}),h=ve({bankTransfer:{enabled:!1,bankName:"",accountName:"",accountNumber:""},paypal:{enabled:!1,clientId:"",clientSecret:"",environment:"sandbox"}}),V=ve({paymentTimeout:15,minAmount:.01,maxAmount:1e4,feeType:"none",fixedFee:0,feePercentage:0,autoConfirm:!0}),D=ve({todayOrders:0,todayAmount:0,monthOrders:0,monthAmount:0}),le=X=>{X?b.info("请填写支付宝配置信息"):b.warning("支付宝支付已禁用")},me=X=>{X?b.info("请填写微信支付配置信息"):b.warning("微信支付已禁用")},fe=async()=>{pe.value=!0;try{P.enabled&&j.value&&await j.value.validate(),T.enabled&&K.value&&await K.value.validate();const X={alipay:P,wechat:T,other:h,general:V,updateTime:new Date().toISOString()};localStorage.setItem("payment_settings",JSON.stringify(X)),window.dispatchEvent(new CustomEvent("payment-settings-updated",{detail:X})),b.success("支付设置保存成功")}catch{b.error("请完善必填信息")}finally{pe.value=!1}},ce=async()=>{te.value=!0;try{await new Promise(X=>setTimeout(X,2e3)),P.appId&&P.privateKey?b.success("支付宝连接测试成功"):b.error("支付宝配置不完整")}finally{te.value=!1}},R=async()=>{G.value=!0;try{await new Promise(X=>setTimeout(X,2e3)),T.appId&&T.mchId&&T.apiKey?b.success("微信支付连接测试成功"):b.error("微信支付配置不完整")}finally{G.value=!1}},I=()=>{try{const X=localStorage.getItem("payment_settings");if(X){const f=JSON.parse(X);Object.assign(P,f.alipay||{}),Object.assign(T,f.wechat||{}),Object.assign(h,f.other||{}),Object.assign(V,f.general||{})}}catch(X){console.error("加载支付设置失败:",X)}},v=()=>{try{const X=JSON.parse(localStorage.getItem("all_orders")||"[]"),f=new Date().toDateString(),ie=new Date().getMonth(),W=new Date().getFullYear();let i=0,s=0,O=0,k=0;X.forEach(N=>{if(N.status==="completed"&&N.paymentTime){const c=new Date(N.paymentTime);c.toDateString()===f&&(i++,s+=N.totalAmount||0),c.getMonth()===ie&&c.getFullYear()===W&&(O++,k+=N.totalAmount||0)}}),D.todayOrders=i,D.todayAmount=s,D.monthOrders=O,D.monthAmount=k}catch(X){console.error("加载支付统计失败:",X)}};return et(()=>{I(),v()}),(X,f)=>{const ie=u("el-icon"),W=u("el-button"),i=u("el-switch"),s=u("el-form-item"),O=u("el-input"),k=u("el-option"),N=u("el-select"),c=u("el-form"),se=u("el-tab-pane"),ne=u("el-input-number"),Ce=u("el-radio"),Se=u("el-radio-group"),E=u("el-tabs"),x=u("el-divider"),ye=u("el-card"),Y=u("el-statistic"),A=u("el-col"),p=u("el-row");return y(),S("div",ns,[e(ye,null,{header:t(()=>[l("div",ss,[f[31]||(f[31]=l("span",null,"支付设置",-1)),e(W,{type:"primary",onClick:fe,loading:pe.value},{default:t(()=>[e(ie,null,{default:t(()=>[e(F(Wt))]),_:1}),f[30]||(f[30]=r(" 保存设置 ",-1))]),_:1,__:[30]},8,["loading"])])]),default:t(()=>[e(E,{type:"border-card",modelValue:ae.value,"onUpdate:modelValue":f[29]||(f[29]=g=>ae.value=g)},{default:t(()=>[e(se,{label:"支付宝",name:"alipay"},{default:t(()=>[l("div",rs,[e(c,{model:P,"label-width":"120px",ref_key:"alipayFormRef",ref:j},{default:t(()=>[e(s,{label:"启用状态"},{default:t(()=>[e(i,{modelValue:P.enabled,"onUpdate:modelValue":f[0]||(f[0]=g=>P.enabled=g),"active-text":"启用","inactive-text":"禁用",onChange:le},null,8,["modelValue"])]),_:1}),P.enabled?(y(),S("div",is,[e(s,{label:"应用ID",prop:"appId",rules:[{required:!0,message:"请输入应用ID"}]},{default:t(()=>[e(O,{modelValue:P.appId,"onUpdate:modelValue":f[1]||(f[1]=g=>P.appId=g),placeholder:"请输入支付宝应用ID","show-password":""},null,8,["modelValue"])]),_:1}),e(s,{label:"私钥",prop:"privateKey",rules:[{required:!0,message:"请输入私钥"}]},{default:t(()=>[e(O,{modelValue:P.privateKey,"onUpdate:modelValue":f[2]||(f[2]=g=>P.privateKey=g),type:"textarea",rows:4,placeholder:"请输入应用私钥","show-password":""},null,8,["modelValue"])]),_:1}),e(s,{label:"支付宝公钥",prop:"alipayPublicKey",rules:[{required:!0,message:"请输入支付宝公钥"}]},{default:t(()=>[e(O,{modelValue:P.alipayPublicKey,"onUpdate:modelValue":f[3]||(f[3]=g=>P.alipayPublicKey=g),type:"textarea",rows:4,placeholder:"请输入支付宝公钥","show-password":""},null,8,["modelValue"])]),_:1}),e(s,{label:"网关地址"},{default:t(()=>[e(N,{modelValue:P.gateway,"onUpdate:modelValue":f[4]||(f[4]=g=>P.gateway=g),placeholder:"选择网关地址"},{default:t(()=>[e(k,{label:"正式环境",value:"https://openapi.alipay.com/gateway.do"}),e(k,{label:"沙箱环境",value:"https://openapi.alipaydev.com/gateway.do"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"回调地址"},{default:t(()=>[e(O,{modelValue:P.notifyUrl,"onUpdate:modelValue":f[5]||(f[5]=g=>P.notifyUrl=g),placeholder:"支付成功后的回调地址"},null,8,["modelValue"])]),_:1}),e(s,{label:"返回地址"},{default:t(()=>[e(O,{modelValue:P.returnUrl,"onUpdate:modelValue":f[6]||(f[6]=g=>P.returnUrl=g),placeholder:"支付完成后用户返回的页面地址"},null,8,["modelValue"])]),_:1})])):q("",!0)]),_:1},8,["model"])])]),_:1}),e(se,{label:"微信支付",name:"wechat"},{default:t(()=>[l("div",us,[e(c,{model:T,"label-width":"120px",ref_key:"wechatFormRef",ref:K},{default:t(()=>[e(s,{label:"启用状态"},{default:t(()=>[e(i,{modelValue:T.enabled,"onUpdate:modelValue":f[7]||(f[7]=g=>T.enabled=g),"active-text":"启用","inactive-text":"禁用",onChange:me},null,8,["modelValue"])]),_:1}),T.enabled?(y(),S("div",ds,[e(s,{label:"应用ID",prop:"appId",rules:[{required:!0,message:"请输入应用ID"}]},{default:t(()=>[e(O,{modelValue:T.appId,"onUpdate:modelValue":f[8]||(f[8]=g=>T.appId=g),placeholder:"请输入微信应用ID","show-password":""},null,8,["modelValue"])]),_:1}),e(s,{label:"商户号",prop:"mchId",rules:[{required:!0,message:"请输入商户号"}]},{default:t(()=>[e(O,{modelValue:T.mchId,"onUpdate:modelValue":f[9]||(f[9]=g=>T.mchId=g),placeholder:"请输入微信商户号","show-password":""},null,8,["modelValue"])]),_:1}),e(s,{label:"API密钥",prop:"apiKey",rules:[{required:!0,message:"请输入API密钥"}]},{default:t(()=>[e(O,{modelValue:T.apiKey,"onUpdate:modelValue":f[10]||(f[10]=g=>T.apiKey=g),placeholder:"请输入API密钥","show-password":""},null,8,["modelValue"])]),_:1}),e(s,{label:"证书路径"},{default:t(()=>[e(O,{modelValue:T.certPath,"onUpdate:modelValue":f[11]||(f[11]=g=>T.certPath=g),placeholder:"微信支付证书文件路径（可选）"},null,8,["modelValue"])]),_:1}),e(s,{label:"私钥路径"},{default:t(()=>[e(O,{modelValue:T.keyPath,"onUpdate:modelValue":f[12]||(f[12]=g=>T.keyPath=g),placeholder:"微信支付私钥文件路径（可选）"},null,8,["modelValue"])]),_:1}),e(s,{label:"回调地址"},{default:t(()=>[e(O,{modelValue:T.notifyUrl,"onUpdate:modelValue":f[13]||(f[13]=g=>T.notifyUrl=g),placeholder:"支付成功后的回调地址"},null,8,["modelValue"])]),_:1})])):q("",!0)]),_:1},8,["model"])])]),_:1}),e(se,{label:"其他支付",name:"other"},{default:t(()=>[l("div",cs,[e(c,{model:h,"label-width":"120px"},{default:t(()=>[e(s,{label:"银行卡转账"},{default:t(()=>[e(i,{modelValue:h.bankTransfer.enabled,"onUpdate:modelValue":f[14]||(f[14]=g=>h.bankTransfer.enabled=g),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),h.bankTransfer.enabled?(y(),S("div",ms,[e(s,{label:"收款银行"},{default:t(()=>[e(O,{modelValue:h.bankTransfer.bankName,"onUpdate:modelValue":f[15]||(f[15]=g=>h.bankTransfer.bankName=g),placeholder:"收款银行名称"},null,8,["modelValue"])]),_:1}),e(s,{label:"账户名"},{default:t(()=>[e(O,{modelValue:h.bankTransfer.accountName,"onUpdate:modelValue":f[16]||(f[16]=g=>h.bankTransfer.accountName=g),placeholder:"收款人姓名"},null,8,["modelValue"])]),_:1}),e(s,{label:"银行卡号"},{default:t(()=>[e(O,{modelValue:h.bankTransfer.accountNumber,"onUpdate:modelValue":f[17]||(f[17]=g=>h.bankTransfer.accountNumber=g),placeholder:"银行卡号","show-password":""},null,8,["modelValue"])]),_:1})])):q("",!0),e(s,{label:"PayPal"},{default:t(()=>[e(i,{modelValue:h.paypal.enabled,"onUpdate:modelValue":f[18]||(f[18]=g=>h.paypal.enabled=g),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),h.paypal.enabled?(y(),S("div",ps,[e(s,{label:"Client ID"},{default:t(()=>[e(O,{modelValue:h.paypal.clientId,"onUpdate:modelValue":f[19]||(f[19]=g=>h.paypal.clientId=g),placeholder:"PayPal Client ID","show-password":""},null,8,["modelValue"])]),_:1}),e(s,{label:"Client Secret"},{default:t(()=>[e(O,{modelValue:h.paypal.clientSecret,"onUpdate:modelValue":f[20]||(f[20]=g=>h.paypal.clientSecret=g),placeholder:"PayPal Client Secret","show-password":""},null,8,["modelValue"])]),_:1}),e(s,{label:"环境"},{default:t(()=>[e(N,{modelValue:h.paypal.environment,"onUpdate:modelValue":f[21]||(f[21]=g=>h.paypal.environment=g)},{default:t(()=>[e(k,{label:"正式环境",value:"production"}),e(k,{label:"沙箱环境",value:"sandbox"})]),_:1},8,["modelValue"])]),_:1})])):q("",!0)]),_:1},8,["model"])])]),_:1}),e(se,{label:"通用配置",name:"general"},{default:t(()=>[l("div",_s,[e(c,{model:V,"label-width":"120px"},{default:t(()=>[e(s,{label:"支付超时时间"},{default:t(()=>[e(ne,{modelValue:V.paymentTimeout,"onUpdate:modelValue":f[22]||(f[22]=g=>V.paymentTimeout=g),min:5,max:30,suffix:"分钟"},null,8,["modelValue"]),f[32]||(f[32]=l("span",{class:"form-tip"},"支付订单的有效时间（5-30分钟）",-1))]),_:1,__:[32]}),e(s,{label:"最小支付金额"},{default:t(()=>[e(ne,{modelValue:V.minAmount,"onUpdate:modelValue":f[23]||(f[23]=g=>V.minAmount=g),min:.01,precision:2,formatter:g=>`¥ ${g}`,parser:g=>g.replace(/¥\s?|(,*)/g,"")},null,8,["modelValue","formatter","parser"])]),_:1}),e(s,{label:"最大支付金额"},{default:t(()=>[e(ne,{modelValue:V.maxAmount,"onUpdate:modelValue":f[24]||(f[24]=g=>V.maxAmount=g),min:1,precision:2,formatter:g=>`¥ ${g}`,parser:g=>g.replace(/¥\s?|(,*)/g,"")},null,8,["modelValue","formatter","parser"])]),_:1}),e(s,{label:"手续费设置"},{default:t(()=>[e(Se,{modelValue:V.feeType,"onUpdate:modelValue":f[25]||(f[25]=g=>V.feeType=g)},{default:t(()=>[e(Ce,{label:"none"},{default:t(()=>f[33]||(f[33]=[r("免手续费",-1)])),_:1,__:[33]}),e(Ce,{label:"fixed"},{default:t(()=>f[34]||(f[34]=[r("固定金额",-1)])),_:1,__:[34]}),e(Ce,{label:"percentage"},{default:t(()=>f[35]||(f[35]=[r("按比例收取",-1)])),_:1,__:[35]})]),_:1},8,["modelValue"])]),_:1}),V.feeType==="fixed"?(y(),Ve(s,{key:0,label:"固定手续费"},{default:t(()=>[e(ne,{modelValue:V.fixedFee,"onUpdate:modelValue":f[26]||(f[26]=g=>V.fixedFee=g),min:0,precision:2,formatter:g=>`¥ ${g}`,parser:g=>g.replace(/¥\s?|(,*)/g,"")},null,8,["modelValue","formatter","parser"])]),_:1})):q("",!0),V.feeType==="percentage"?(y(),Ve(s,{key:1,label:"手续费比例"},{default:t(()=>[e(ne,{modelValue:V.feePercentage,"onUpdate:modelValue":f[27]||(f[27]=g=>V.feePercentage=g),min:0,max:10,precision:2,suffix:"%"},null,8,["modelValue"])]),_:1})):q("",!0),e(s,{label:"自动确认"},{default:t(()=>[e(i,{modelValue:V.autoConfirm,"onUpdate:modelValue":f[28]||(f[28]=g=>V.autoConfirm=g),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),f[36]||(f[36]=l("span",{class:"form-tip"},"收到支付回调后自动确认订单",-1))]),_:1,__:[36]})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"]),l("div",fs,[e(x,null,{default:t(()=>f[37]||(f[37]=[r("连接测试",-1)])),_:1,__:[37]}),l("div",gs,[P.enabled?(y(),Ve(W,{key:0,type:"primary",onClick:ce,loading:te.value},{default:t(()=>f[38]||(f[38]=[r(" 测试支付宝连接 ",-1)])),_:1,__:[38]},8,["loading"])):q("",!0),T.enabled?(y(),Ve(W,{key:1,type:"success",onClick:R,loading:G.value},{default:t(()=>f[39]||(f[39]=[r(" 测试微信支付连接 ",-1)])),_:1,__:[39]},8,["loading"])):q("",!0)])])]),_:1}),e(ye,{style:{"margin-top":"20px"}},{header:t(()=>f[40]||(f[40]=[l("span",null,"支付统计",-1)])),default:t(()=>[e(p,{gutter:20},{default:t(()=>[e(A,{span:6},{default:t(()=>[e(Y,{title:"今日支付订单",value:D.todayOrders},null,8,["value"])]),_:1}),e(A,{span:6},{default:t(()=>[e(Y,{title:"今日支付金额",value:D.todayAmount,prefix:"¥",precision:2},null,8,["value"])]),_:1}),e(A,{span:6},{default:t(()=>[e(Y,{title:"本月支付订单",value:D.monthOrders},null,8,["value"])]),_:1}),e(A,{span:6},{default:t(()=>[e(Y,{title:"本月支付金额",value:D.monthAmount,prefix:"¥",precision:2},null,8,["value"])]),_:1})]),_:1})]),_:1})])}}},ys=Xe(vs,[["__scopeId","data-v-a5be3463"]]),bs={class:"admin-layout"},ws={class:"sidebar"},Vs={width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",style:{"margin-right":"8px"}},hs={class:"header-content"},Cs={class:"header-actions"},$s={class:"el-dropdown-link"},Is={key:0,class:"admin-content"},Ss={class:"stats-item"},ks={class:"stats-content"},xs={class:"stats-item"},Ts={class:"stats-content"},Us={class:"stats-item"},Ds={class:"stats-content"},As={class:"stats-item"},Ps={class:"stats-content"},Ls={key:1,class:"admin-content"},Ns={key:2,class:"admin-content"},zs={key:3,class:"admin-content"},Os={class:"card-header"},Ms={class:"header-actions"},Fs={key:0,class:"batch-operation-tip"},Rs={class:"batch-tip-actions"},Bs={key:4,class:"admin-content"},js={key:5,class:"admin-content"},Es={key:6,class:"admin-content"},Hs={key:7,class:"admin-content"},Zs={key:8,class:"admin-content"},Js={key:9,class:"admin-content"},qs={key:10,class:"admin-content"},Gs={class:"stats-item"},Ks={class:"stats-content"},Ys={class:"stats-item"},Qs={class:"stats-content"},Ws={class:"stats-item"},Xs={class:"stats-content"},er={class:"stats-item"},tr={class:"stats-content"},lr={key:11,class:"admin-content"},ar={key:12,class:"admin-content"},or={class:"security-settings"},nr={style:{"margin-top":"16px"}},sr={class:"settings-actions"},rr={style:{display:"flex",gap:"10px"}},ir={key:0,class:"empty-card-types-hint"},ur={class:"generate-preview"},dr={class:"import-section"},cr={class:"import-method-selector"},mr={key:0},pr={class:"file-upload"},_r={key:1},fr={class:"manual-input"},gr={key:0,class:"auto-generate-mode"},vr={key:1,class:"manual-input-mode"},yr={class:"import-options"},br={class:"zone-product-selector",style:{"margin-bottom":"20px"}},wr={style:{display:"flex",gap:"8px"}},Vr={class:"file-upload"},hr={key:2,class:"preview-section"},Cr={class:"preview-info"},$r={key:3,class:"import-result"},Ir={key:0,class:"error-list"},Sr={__name:"Admin",setup(tt){const ae=el(),pe=Ct(),te=Xt(),G=$("dashboard"),j=$(!1),K=$(!1),P=$(!1),T=$(),h=$(!1),V=$([]),D=$(null),le=$("file"),me=$(),fe=$([]),ce=$(!1),R=ve({cardData:"",cardType:"monthly",cardValue:"¥29.90",cardStatus:"unused",autoGenerate:0}),I=ve({totalUsers:0,totalCards:0,totalOrders:0,totalRevenue:"0.00"}),v=$([]),X=$([]),f=$([]),ie=$([]);ve({currentPage:1,pageSize:10,total:100});const W=ve({username:"",email:"",password:"",role:"user"}),i=ve({type:"",quantity:10,value:"",zoneId:"",productId:"",cardTypeId:""}),s=$([]),O=$([]),k=$(!1),N=Ae(()=>i.zoneId?O.value.filter(U=>U.zoneId===i.zoneId):[]),c=Ae(()=>B.defaultZoneId?O.value.filter(U=>U.zoneId===B.defaultZoneId):[]),se=()=>{i.productId="",i.cardTypeId=""},ne=Ae(()=>{if(!i.productId)return[];const U=O.value.find(L=>L.id===i.productId),a=(U==null?void 0:U.cardTypes)||[];return console.log("=== 卡密类型检查 ==="),console.log("商品ID:",i.productId),console.log("找到的商品:",U),console.log("商品的卡密类型:",a),console.log("卡密类型数量:",a.length),a}),Ce=()=>{i.cardTypeId=""},Se=U=>{try{return JSON.parse(localStorage.getItem("all_cards")||"[]").filter(L=>String(L.zoneId)===String(i.zoneId)&&String(L.productId)===String(i.productId)&&String(L.cardTypeId)===String(U)&&L.status==="unused"&&!L.purchasedBy).length}catch{return 0}},E=Ae(()=>!(!i.zoneId||!i.productId||!i.value||ne.value.length>0&&!i.cardTypeId)),x=()=>{B.defaultProductId=null},ye=async()=>{k.value=!0;try{b.info("正在重新检测现有专区和商品..."),console.log("=== 手动检查localStorage数据 ===");const U=localStorage.getItem("card_zones"),a=localStorage.getItem("card_products");if(U){const L=JSON.parse(U);console.log("专区数据:",L.length,"个专区"),L.forEach((Q,Z)=>{var Ie;console.log(`专区 ${Z+1}:`,Q.name,((Ie=Q.products)==null?void 0:Ie.length)||0,"个商品"),Q.products&&Q.products.forEach(xe=>{var n;console.log(`  商品: ${xe.name}, 卡密类型: ${((n=xe.cardTypes)==null?void 0:n.length)||0}`)})})}if(a){const L=JSON.parse(a);console.log("商品数据:",L.length,"个商品"),L.forEach((Q,Z)=>{var Ie;console.log(`商品 ${Z+1}:`,Q.name,"卡密类型:",((Ie=Q.cardTypes)==null?void 0:Ie.length)||0),Q.cardTypes&&Q.cardTypes.forEach(xe=>console.log(`  类型: ${xe.name} (${xe.duration})`))})}await A()}finally{k.value=!1}},Y=()=>{const U=s.value.find(L=>L.id===i.zoneId),a=O.value.find(L=>L.id===i.productId);return U&&a?`将为专区「${U.name}」的商品「${a.name}」生成 ${i.quantity} 张卡密`:""},A=async()=>{try{console.log("=== 开始从专区管理中加载专区和商品 ===");const U=JSON.parse(localStorage.getItem("card_zones")||"[]");console.log(`专区管理中的专区数量: ${U.length}`);const a=JSON.parse(localStorage.getItem("card_products")||"[]");console.log(`专区管理中的商品数量: ${a.length}`);const L=JSON.parse(localStorage.getItem("all_cards")||"[]");console.log(`卡密管理中的卡密数量: ${L.length}`);const Q={},Z={};L.forEach(n=>{if(n.zoneId&&n.productId){Q[n.zoneId]||(Q[n.zoneId]=0),Q[n.zoneId]++;const o=`${n.zoneId}-${n.productId}`;Z[o]||(Z[o]=0),Z[o]++}}),console.log("=== 卡密统计结果 ==="),console.log("专区卡密统计:",Q),console.log("商品卡密统计:",Z);const Ie=U.filter(n=>n.isActive!==!1).map(n=>({id:n.id,name:n.name,description:n.description||`专区：${n.name}`,createdAt:n.updateTime||new Date().toISOString(),isDetected:!0,cardCount:Q[n.id]||0,icon:n.icon,customIcon:n.customIcon})).sort((n,o)=>(o.sortOrder||0)-(n.sortOrder||0)||n.id-o.id),xe=a.filter(n=>n.isActive!==!1).map(n=>{const o=`${n.zoneId}-${n.id}`,w=Z[o]||0;return{id:n.id,zoneId:n.zoneId,name:n.name,price:n.price?n.price.toString():"0.00",type:n.type||"general",description:n.description||`商品：${n.name}`,createdAt:n.updateTime||n.createTime||new Date().toISOString(),isDetected:!0,cardCount:w,stock:n.stock||0,validity:n.validity,cardTypes:n.cardTypes||[]}}).sort((n,o)=>n.zoneId-o.zoneId||(o.sortOrder||0)-(n.sortOrder||0)||n.id-o.id);if(console.log("=== 加载结果 ==="),console.log("专区列表:",Ie.map(n=>`${n.name}: ${n.cardCount}张卡密`)),console.log("商品列表:",xe.map(n=>{var o;return`${n.name}: ${n.cardCount}张卡密, 卡密类型: ${((o=n.cardTypes)==null?void 0:o.length)||0}个`})),xe.forEach(n=>{n.cardTypes&&n.cardTypes.length>0&&console.log(`商品「${n.name}」的卡密类型:`,n.cardTypes)}),Ie.length===0?(console.log("专区管理中没有专区数据"),b.warning("专区管理中没有找到专区，请先在专区管理中创建专区"),s.value=[]):s.value=Ie,xe.length===0?(console.log("专区管理中没有商品数据"),b.warning("专区管理中没有找到商品，请先在专区管理中创建商品"),O.value=[]):O.value=xe,Ie.length>0||xe.length>0){const n=Object.values(Q).reduce((w,C)=>w+C,0),o=`加载完成：${Ie.length} 个专区，${xe.length} 个商品，共 ${n} 张卡密`;console.log("=== "+o+" ==="),b.success(o)}}catch(U){console.error("加载专区商品数据失败:",U),b.error("加载专区商品数据失败: "+U.message),s.value=[],O.value=[]}},p=ve({totalRevenue:"0.00",todayRevenue:"0.00",totalTransactions:0,pendingAmount:"0.00"}),g=ve({siteName:"卡密系统",siteDescription:"专业的卡密销售管理系统",allowRegister:!0,emailVerification:!1}),M=ve({monthlyPrice:29.9,quarterlyPrice:79.9,yearlyPrice:299.9}),H=ve({overwriteExisting:!1}),B=ve({defaultZoneId:null,defaultProductId:null}),de=()=>({dashboard:"数据概览",users:"用户管理",zones:"专区管理",cards:"卡密管理",orders:"订单管理",vip:"VIP管理",announcements:"公告管理",contacts:"用户反馈",finance:"财务管理",payment:"支付设置",maintenance:"服务器维护",security:"安全监控",settings:"系统设置"})[G.value]||"管理后台",ee=U=>{G.value=U,U==="dashboard"&&He()},Pe=U=>{switch(U){case"home":ae.push("/");break;case"dashboard":ae.push("/dashboard");break;case"logout":pe.logout(),ae.push("/");break}},be=U=>({已完成:"success",处理中:"warning",已取消:"info"})[U]||"info",ge=U=>({info:"primary",success:"success",warning:"warning",error:"danger"})[U]||"primary",Ne=U=>({unused:"success",sold:"warning",used:"info",expired:"danger"})[U]||"info",De=U=>({unused:"未使用",sold:"已购买",used:"已激活",expired:"已过期"})[U]||"未知",ue=()=>{if(!W.username||!W.email||!W.password){b.error("请填写完整信息");return}b.success("用户添加成功"),j.value=!1,W.username="",W.email="",W.password="",W.role="user"},ze=U=>{b.info(`查看卡密: ${U.cardNumber}`)},Ke=async U=>{try{await Ee.confirm(`确认删除卡密 ${U.cardNumber}？`,"确认删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const a=await te.deleteCard(U.id);a.success?(b.success(a.message),await He()):b.error(a.message)}catch{}},re=async()=>{if(!i.zoneId||!i.productId||!i.cardTypeId||!i.value){b.error("请填写完整信息");return}try{const U=s.value.find(Z=>Z.id===i.zoneId),a=O.value.find(Z=>Z.id===i.productId),L=ne.value.find(Z=>Z.id===i.cardTypeId);console.log("=== 生成卡密请求参数 ==="),console.log("选中的卡密类型ID:",i.cardTypeId),console.log("选中的卡密类型对象:",L),console.log("类型ID类型:",typeof i.cardTypeId);const Q=await te.generateCards({type:i.type,quantity:i.quantity,value:i.value,zoneId:String(i.zoneId),zoneName:(U==null?void 0:U.name)||"",productId:String(i.productId),productName:(a==null?void 0:a.name)||"",cardTypeId:String(i.cardTypeId),cardTypeName:(L==null?void 0:L.name)||"",cardTypeDuration:(L==null?void 0:L.duration)||""});Q.success?(b.success(Q.message),K.value=!1,i.type="",i.quantity=10,i.value="",i.zoneId="",i.productId="",i.cardTypeId="",await He()):b.error(Q.message)}catch{b.error("生成失败")}},Ye=()=>{try{localStorage.setItem("system_settings",JSON.stringify(g)),localStorage.setItem("price_settings",JSON.stringify(M)),b.success("设置保存成功")}catch{b.error("设置保存失败")}},ke=()=>{Object.assign(g,{siteName:"卡密系统",siteDescription:"专业的卡密销售管理系统",allowRegister:!0,emailVerification:!1}),Object.assign(M,{monthlyPrice:29.9,quarterlyPrice:79.9,yearlyPrice:299.9}),b.info("设置已重置")},He=()=>{try{const U=JSON.parse(localStorage.getItem("all_users")||"[]");f.value=U,I.totalUsers=U.length;const a=JSON.parse(localStorage.getItem("all_cards")||"[]");ie.value=a,I.totalCards=a.length;const L=JSON.parse(localStorage.getItem("all_orders")||"[]");I.totalOrders=L.length;const Q=L.filter(w=>w.status==="completed").reduce((w,C)=>w+(C.totalAmount||0),0);I.totalRevenue=Q.toFixed(2),p.totalRevenue=Q.toFixed(2),p.totalTransactions=L.filter(w=>w.status==="completed").length;const Z=new Date().toLocaleDateString("zh-CN"),Ie=L.filter(w=>w.status==="completed"&&new Date(w.paymentTime||w.createTime).toLocaleDateString("zh-CN")===Z).reduce((w,C)=>w+(C.totalAmount||0),0);p.todayRevenue=Ie.toFixed(2);const xe=L.filter(w=>w.status==="pending").reduce((w,C)=>w+(C.totalAmount||0),0);p.pendingAmount=xe.toFixed(2);const n=L.sort((w,C)=>new Date(C.createTime)-new Date(w.createTime)).slice(0,5).map(w=>{var C;return{id:w.orderNumber,username:w.username||"未知用户",amount:`¥${((C=w.totalAmount)==null?void 0:C.toFixed(2))||"0.00"}`,status:st(w.status)}});v.value=n;const o=[];U.slice(-3).forEach(w=>{o.push({id:o.length+1,message:`用户 ${w.username} 注册系统`,time:w.registerTime,level:"info"})}),L.slice(-2).forEach(w=>{o.push({id:o.length+1,message:`订单 ${w.orderNumber} 状态更新为${st(w.status)}`,time:w.createTime,level:w.status==="completed"?"success":"info"})}),o.push({id:o.length+1,message:"管理员查看数据概览",time:new Date().toLocaleString("zh-CN"),level:"info"}),X.value=o.sort((w,C)=>new Date(C.time)-new Date(w.time)).slice(0,5)}catch(U){console.error("加载数据失败:",U),b.error("加载数据失败")}},st=U=>({pending:"待支付",completed:"已完成",cancelled:"已取消",failed:"失败"})[U]||U,z=U=>{if(U.size>2*1024*1024)return b.error("文件大小不能超过2MB"),!1;const a=new FileReader;a.onload=L=>{const Q=L.target.result,Z=te.parseCSV(Q);Z.success?(V.value=Z.data,D.value=null,b.success(`文件解析成功，共 ${Z.data.length} 条数据`)):(b.error(`文件解析失败：${Z.message}`),V.value=[])},a.readAsText(U.raw,"UTF-8")},Qe=()=>{V.value=[],D.value=null},St=async()=>{if(V.value.length===0){b.error("请先选择文件");return}h.value=!0,D.value=null;try{const U=s.value.find(Z=>Z.id===B.defaultZoneId),a=O.value.find(Z=>Z.id===B.defaultProductId),L=V.value.map(Z=>({...Z,zoneId:Z.zoneId||B.defaultZoneId,zoneName:Z.zoneName||(U?U.name:""),productId:Z.productId||B.defaultProductId,productName:Z.productName||(a?a.name:""),createTime:Z.createTime||new Date().toLocaleString("zh-CN"),useTime:Z.useTime||null,expireTime:Z.expireTime||null})),Q=await te.importCards({cards:L,overwriteExisting:H.overwriteExisting,defaultZoneInfo:U?{id:U.id,name:U.name}:null,defaultProductInfo:a?{id:a.id,name:a.name}:null});D.value=Q,Q.success?(b.success(Q.message),await He()):b.error(Q.message)}finally{h.value=!1}},kt=()=>{P.value=!1,V.value=[],D.value=null,H.overwriteExisting=!1,le.value="file",R.cardData="",B.defaultZoneId=null,B.defaultProductId=null,T.value&&T.value.clearFiles()},xt=()=>{if(ie.value.length===0){b.warning("没有卡密数据可导出");return}te.exportCards(ie.value),b.success("导出成功")},Tt=()=>{V.value=[],D.value=null,R.cardData="",T.value&&T.value.clearFiles()},lt=()=>{if(!R.cardType){b.error("请选择卡密类型");return}if(!R.cardValue){b.error("请输入卡密面值");return}let U=[];if(R.autoGenerate>0)for(let Z=0;Z<R.autoGenerate;Z++){const Ie=Date.now().toString(),xe=Math.random().toString(36).substring(2,8).toUpperCase();U.push(`CARD${Ie}${xe}`)}else{if(!R.cardData.trim()){b.error("请输入卡号或设置自动生成数量");return}if(U=R.cardData.split(`
`).map(Z=>Z.trim()).filter(Z=>Z.length>0),U.length===0){b.error("没有找到有效的卡号");return}}const a={monthly:"月卡",quarterly:"季卡",yearly:"年卡",trial:"体验卡"},L=U.map((Z,Ie)=>({cardNumber:Z,cardType:a[R.cardType]||"月卡",value:R.cardValue,status:R.cardStatus||"unused",createTime:new Date().toLocaleString("zh-CN"),useTime:null,expireTime:null,zoneId:null,zoneName:null,productId:null,productName:null}));V.value=L,D.value=null;const Q=R.autoGenerate>0?"自动生成":"手动输入";b.success(`${Q}解析成功，共 ${L.length} 条卡密数据`)},rt=()=>{R.cardData="",R.cardType="monthly",R.cardValue="¥29.90",R.cardStatus="unused",R.autoGenerate=0,V.value=[],D.value=null},Ut=U=>{fe.value=U},Dt=()=>{if(!me.value)return;ie.value.filter(a=>a.status==="unused").forEach(a=>{me.value.toggleRowSelection(a,!0)})},vt=()=>{me.value&&me.value.clearSelection()},Ze=async()=>{if(fe.value.length===0){b.error("请选择要删除的卡密");return}const U=fe.value.filter(Q=>Q.status==="unused"),a=fe.value.filter(Q=>Q.status!=="unused");let L=`确认删除选中的 ${fe.value.length} 个卡密？`;a.length>0&&(L+=`

注意：其中 ${a.length} 个卡密因已被使用或购买将被跳过，只会删除 ${U.length} 个未使用的卡密。`);try{await Ee.confirm(L,"批量删除确认",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}),ce.value=!0;const Q=fe.value.map(Ie=>Ie.id),Z=await te.batchDeleteCards(Q);Z.success?(b.success(Z.message),Z.data&&Z.data.errors.length>0&&Ee.alert(`删除结果：
成功删除：${Z.data.deleteCount} 个
跳过：${Z.data.skipCount} 个

${Z.data.errors.join(`
`)}`,"删除详情",{confirmButtonText:"确定",dangerouslyUseHTMLString:!0}),vt(),await He()):b.error(Z.message)}catch{}finally{ce.value=!1}};return et(()=>{try{const U=localStorage.getItem("system_settings");U&&Object.assign(g,JSON.parse(U));const a=localStorage.getItem("price_settings");a&&Object.assign(M,JSON.parse(a))}catch(U){console.warn("加载设置失败:",U)}He(),A()}),(U,a)=>{const L=u("el-icon"),Q=u("el-menu-item"),Z=u("el-menu"),Ie=u("el-aside"),xe=u("el-dropdown-item"),n=u("el-dropdown-menu"),o=u("el-dropdown"),w=u("el-header"),C=u("el-card"),J=u("el-col"),_e=u("el-row"),$e=u("el-table-column"),he=u("el-tag"),Oe=u("el-table"),it=u("el-timeline-item"),Fe=u("el-timeline"),oe=u("el-button"),Re=u("el-alert"),Je=u("el-input"),we=u("el-form-item"),We=u("el-switch"),Ge=u("el-form"),at=u("el-tab-pane"),qe=u("el-input-number"),Me=u("el-tabs"),At=u("el-main"),mt=u("el-container"),Le=u("el-option"),Te=u("el-select"),Ue=u("el-dialog"),ut=u("RefreshRight"),ot=u("el-text"),yt=u("el-radio"),bt=u("el-radio-group"),pt=u("el-upload"),m=u("el-checkbox");return y(),S("div",bs,[e(mt,null,{default:t(()=>[e(Ie,{width:"240px"},{default:t(()=>[l("div",ws,[a[47]||(a[47]=l("div",{class:"sidebar-header"},[l("h3",null,"管理后台")],-1)),e(Z,{"default-active":G.value,class:"sidebar-menu",onSelect:ee},{default:t(()=>[e(Q,{index:"dashboard"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(tl))]),_:1}),a[33]||(a[33]=l("span",null,"数据概览",-1))]),_:1,__:[33]}),e(Q,{index:"users"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(gt))]),_:1}),a[34]||(a[34]=l("span",null,"用户管理",-1))]),_:1,__:[34]}),e(Q,{index:"zones"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(ll))]),_:1}),a[35]||(a[35]=l("span",null,"专区管理",-1))]),_:1,__:[35]}),e(Q,{index:"cards"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(zt))]),_:1}),a[36]||(a[36]=l("span",null,"卡密管理",-1))]),_:1,__:[36]}),e(Q,{index:"orders"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(Pt))]),_:1}),a[37]||(a[37]=l("span",null,"订单管理",-1))]),_:1,__:[37]}),e(Q,{index:"vip"},{default:t(()=>[(y(),S("svg",Vs,a[38]||(a[38]=[l("path",{d:"M6,2L8,6L12,7L8,8L6,12L4,8L0,7L4,6L6,2M12,8L13.5,11L17,12L13.5,13L12,16L10.5,13L7,12L10.5,11L12,8M19,2L20.5,5L24,6L20.5,7L19,10L17.5,7L14,6L17.5,5L19,2Z"},null,-1)]))),a[39]||(a[39]=l("span",null,"VIP管理",-1))]),_:1,__:[39]}),e(Q,{index:"announcements"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(al))]),_:1}),a[40]||(a[40]=l("span",null,"公告管理",-1))]),_:1,__:[40]}),e(Q,{index:"contacts"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(ol))]),_:1}),a[41]||(a[41]=l("span",null,"用户反馈",-1))]),_:1,__:[41]}),e(Q,{index:"finance"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(_t))]),_:1}),a[42]||(a[42]=l("span",null,"财务管理",-1))]),_:1,__:[42]}),e(Q,{index:"payment"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(nl))]),_:1}),a[43]||(a[43]=l("span",null,"支付设置",-1))]),_:1,__:[43]}),e(Q,{index:"maintenance"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(ht))]),_:1}),a[44]||(a[44]=l("span",null,"服务器维护",-1))]),_:1,__:[44]}),e(Q,{index:"security"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(Ft))]),_:1}),a[45]||(a[45]=l("span",null,"安全监控",-1))]),_:1,__:[45]}),e(Q,{index:"settings"},{default:t(()=>[e(L,null,{default:t(()=>[e(F(sl))]),_:1}),a[46]||(a[46]=l("span",null,"系统设置",-1))]),_:1,__:[46]})]),_:1},8,["default-active"])])]),_:1}),e(mt,null,{default:t(()=>[e(w,null,{default:t(()=>[l("div",hs,[l("h2",null,d(de()),1),l("div",Cs,[e(o,{onCommand:Pe},{dropdown:t(()=>[e(n,null,{default:t(()=>[e(xe,{command:"home"},{default:t(()=>a[49]||(a[49]=[r("返回首页",-1)])),_:1,__:[49]}),e(xe,{command:"dashboard"},{default:t(()=>a[50]||(a[50]=[r("个人中心",-1)])),_:1,__:[50]}),e(xe,{divided:"",command:"logout"},{default:t(()=>a[51]||(a[51]=[r("退出登录",-1)])),_:1,__:[51]})]),_:1})]),default:t(()=>[l("span",$s,[a[48]||(a[48]=r(" 管理员 ",-1)),e(L,{class:"el-icon--right"},{default:t(()=>[e(F(rl))]),_:1})])]),_:1})])])]),_:1}),e(At,null,{default:t(()=>[G.value==="dashboard"?(y(),S("div",Is,[e(_e,{gutter:20},{default:t(()=>[e(J,{span:6},{default:t(()=>[e(C,{class:"stats-card"},{default:t(()=>[l("div",Ss,[e(L,{class:"stats-icon",color:"#409eff"},{default:t(()=>[e(F(gt))]),_:1}),l("div",ks,[l("h3",null,d(I.totalUsers),1),a[52]||(a[52]=l("p",null,"总用户数",-1))])])]),_:1})]),_:1}),e(J,{span:6},{default:t(()=>[e(C,{class:"stats-card"},{default:t(()=>[l("div",xs,[e(L,{class:"stats-icon",color:"#67C23A"},{default:t(()=>[e(F(zt))]),_:1}),l("div",Ts,[l("h3",null,d(I.totalCards),1),a[53]||(a[53]=l("p",null,"总卡密数",-1))])])]),_:1})]),_:1}),e(J,{span:6},{default:t(()=>[e(C,{class:"stats-card"},{default:t(()=>[l("div",Us,[e(L,{class:"stats-icon",color:"#E6A23C"},{default:t(()=>[e(F(Pt))]),_:1}),l("div",Ds,[l("h3",null,d(I.totalOrders),1),a[54]||(a[54]=l("p",null,"总订单数",-1))])])]),_:1})]),_:1}),e(J,{span:6},{default:t(()=>[e(C,{class:"stats-card"},{default:t(()=>[l("div",As,[e(L,{class:"stats-icon",color:"#F56C6C"},{default:t(()=>[e(F(_t))]),_:1}),l("div",Ps,[l("h3",null,"¥"+d(I.totalRevenue),1),a[55]||(a[55]=l("p",null,"总收入",-1))])])]),_:1})]),_:1})]),_:1}),e(_e,{gutter:20,class:"mt-20"},{default:t(()=>[e(J,{span:12},{default:t(()=>[e(C,null,{header:t(()=>a[56]||(a[56]=[l("span",null,"最近订单",-1)])),default:t(()=>[e(Oe,{data:v.value,style:{width:"100%"}},{default:t(()=>[e($e,{prop:"id",label:"订单号",width:"120"}),e($e,{prop:"username",label:"用户"}),e($e,{prop:"amount",label:"金额"}),e($e,{prop:"status",label:"状态"},{default:t(_=>[e(he,{type:be(_.row.status)},{default:t(()=>[r(d(_.row.status),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),e(J,{span:12},{default:t(()=>[e(C,null,{header:t(()=>a[57]||(a[57]=[l("span",null,"系统日志",-1)])),default:t(()=>[e(Fe,null,{default:t(()=>[(y(!0),S(Be,null,je(X.value,_=>(y(),Ve(it,{key:_.id,timestamp:_.time,type:ge(_.level)},{default:t(()=>[r(d(_.message),1)]),_:2},1032,["timestamp","type"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})])):q("",!0),G.value==="users"?(y(),S("div",Ls,[e(Tl)])):q("",!0),G.value==="zones"?(y(),S("div",Ns,[e(oo)])):q("",!0),G.value==="cards"?(y(),S("div",zs,[e(C,null,{header:t(()=>[l("div",Os,[a[61]||(a[61]=l("span",null,"卡密列表",-1)),l("div",Ms,[fe.value.length>0?(y(),Ve(oe,{key:0,type:"danger",onClick:Ze,loading:ce.value},{default:t(()=>[e(L,null,{default:t(()=>[e(F(ft))]),_:1}),r(" 批量删除 ("+d(fe.value.length)+") ",1)]),_:1},8,["loading"])):q("",!0),e(oe,{type:"success",onClick:a[0]||(a[0]=_=>P.value=!0)},{default:t(()=>[e(L,null,{default:t(()=>[e(F(Mt))]),_:1}),a[58]||(a[58]=r(" 导入卡密 ",-1))]),_:1,__:[58]}),e(oe,{type:"primary",onClick:a[1]||(a[1]=_=>K.value=!0)},{default:t(()=>[e(L,null,{default:t(()=>[e(F(nt))]),_:1}),a[59]||(a[59]=r(" 批量生成 ",-1))]),_:1,__:[59]}),e(oe,{type:"info",onClick:xt},{default:t(()=>[e(L,null,{default:t(()=>[e(F(Rt))]),_:1}),a[60]||(a[60]=r(" 导出卡密 ",-1))]),_:1,__:[60]})])])]),default:t(()=>[e(Oe,{data:ie.value,style:{width:"100%"},onSelectionChange:Ut,ref_key:"cardTableRef",ref:me},{default:t(()=>[e($e,{type:"selection",width:"55",selectable:_=>_.status==="unused"},null,8,["selectable"]),e($e,{prop:"cardNumber",label:"卡号",width:"180"}),e($e,{prop:"cardType",label:"类型",width:"100"}),e($e,{prop:"value",label:"面值",width:"100"}),e($e,{prop:"zoneName",label:"所属专区",width:"120"}),e($e,{prop:"productName",label:"关联商品",width:"160"}),e($e,{prop:"status",label:"状态"},{default:t(_=>[e(he,{type:Ne(_.row.status)},{default:t(()=>[r(d(De(_.row.status)),1)]),_:2},1032,["type"])]),_:1}),e($e,{prop:"createTime",label:"创建时间"}),e($e,{prop:"useTime",label:"使用时间"}),e($e,{label:"操作",width:"150"},{default:t(_=>[e(oe,{type:"primary",size:"small",onClick:wt=>ze(_.row)},{default:t(()=>a[62]||(a[62]=[r(" 查看 ",-1)])),_:2,__:[62]},1032,["onClick"]),_.row.status==="unused"?(y(),Ve(oe,{key:0,type:"danger",size:"small",onClick:wt=>Ke(_.row)},{default:t(()=>a[63]||(a[63]=[r(" 删除 ",-1)])),_:2,__:[63]},1032,["onClick"])):q("",!0)]),_:1})]),_:1},8,["data"]),fe.value.length>0?(y(),S("div",Fs,[e(Re,{title:"已选择 "+fe.value.length+" 个卡密，只有未使用状态的卡密可以删除",type:"info",closable:!1,"show-icon":""},{default:t(()=>[l("div",Rs,[e(oe,{size:"small",onClick:Dt},{default:t(()=>a[64]||(a[64]=[r("选择所有未使用",-1)])),_:1,__:[64]}),e(oe,{size:"small",onClick:vt},{default:t(()=>a[65]||(a[65]=[r("清空选择",-1)])),_:1,__:[65]})])]),_:1},8,["title"])])):q("",!0)]),_:1})])):q("",!0),G.value==="orders"?(y(),S("div",Bs,[e(dl)])):q("",!0),G.value==="vip"?(y(),S("div",js,[e(Eo)])):q("",!0),G.value==="announcements"?(y(),S("div",Es,[e(Xo)])):q("",!0),G.value==="contacts"?(y(),S("div",Hs,[e(fn)])):q("",!0),G.value==="maintenance"?(y(),S("div",Zs,[e(On)])):q("",!0),G.value==="security"?(y(),S("div",Js,[e(os)])):q("",!0),G.value==="finance"?(y(),S("div",qs,[e(C,null,{header:t(()=>a[66]||(a[66]=[l("span",null,"财务管理",-1)])),default:t(()=>[e(_e,{gutter:20},{default:t(()=>[e(J,{span:6},{default:t(()=>[e(C,{class:"stats-card"},{default:t(()=>[l("div",Gs,[e(L,{class:"stats-icon",color:"#67C23A"},{default:t(()=>[e(F(_t))]),_:1}),l("div",Ks,[l("h3",null,"¥"+d(p.totalRevenue),1),a[67]||(a[67]=l("p",null,"总收入",-1))])])]),_:1})]),_:1}),e(J,{span:6},{default:t(()=>[e(C,{class:"stats-card"},{default:t(()=>[l("div",Ys,[e(L,{class:"stats-icon",color:"#E6A23C"},{default:t(()=>[e(F(_t))]),_:1}),l("div",Qs,[l("h3",null,"¥"+d(p.todayRevenue),1),a[68]||(a[68]=l("p",null,"今日收入",-1))])])]),_:1})]),_:1}),e(J,{span:6},{default:t(()=>[e(C,{class:"stats-card"},{default:t(()=>[l("div",Ws,[e(L,{class:"stats-icon",color:"#409EFF"},{default:t(()=>[e(F(Pt))]),_:1}),l("div",Xs,[l("h3",null,d(p.totalTransactions),1),a[69]||(a[69]=l("p",null,"总交易数",-1))])])]),_:1})]),_:1}),e(J,{span:6},{default:t(()=>[e(C,{class:"stats-card"},{default:t(()=>[l("div",er,[e(L,{class:"stats-icon",color:"#F56C6C"},{default:t(()=>[e(F(_t))]),_:1}),l("div",tr,[l("h3",null,"¥"+d(p.pendingAmount),1),a[70]||(a[70]=l("p",null,"待结算",-1))])])]),_:1})]),_:1})]),_:1}),a[71]||(a[71]=l("div",{class:"finance-content"},[l("p",{style:{"text-align":"center",color:"#909399",margin:"40px 0"}}," 财务详细功能开发中... ")],-1))]),_:1,__:[71]})])):q("",!0),G.value==="payment"?(y(),S("div",lr,[e(ys)])):q("",!0),G.value==="settings"?(y(),S("div",ar,[e(C,null,{header:t(()=>a[72]||(a[72]=[l("span",null,"系统设置",-1)])),default:t(()=>[e(Me,{type:"border-card"},{default:t(()=>[e(at,{label:"基础设置"},{default:t(()=>[e(Ge,{model:g,"label-width":"120px"},{default:t(()=>[e(we,{label:"网站名称"},{default:t(()=>[e(Je,{modelValue:g.siteName,"onUpdate:modelValue":a[2]||(a[2]=_=>g.siteName=_)},null,8,["modelValue"])]),_:1}),e(we,{label:"网站描述"},{default:t(()=>[e(Je,{modelValue:g.siteDescription,"onUpdate:modelValue":a[3]||(a[3]=_=>g.siteDescription=_),type:"textarea"},null,8,["modelValue"])]),_:1}),e(we,{label:"允许注册"},{default:t(()=>[e(We,{modelValue:g.allowRegister,"onUpdate:modelValue":a[4]||(a[4]=_=>g.allowRegister=_)},null,8,["modelValue"])]),_:1}),e(we,{label:"邮箱验证"},{default:t(()=>[e(We,{modelValue:g.emailVerification,"onUpdate:modelValue":a[5]||(a[5]=_=>g.emailVerification=_)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),e(at,{label:"价格设置"},{default:t(()=>[e(Ge,{model:M,"label-width":"120px"},{default:t(()=>[e(we,{label:"月卡价格"},{default:t(()=>[e(qe,{modelValue:M.monthlyPrice,"onUpdate:modelValue":a[6]||(a[6]=_=>M.monthlyPrice=_),precision:2,min:0},null,8,["modelValue"])]),_:1}),e(we,{label:"季卡价格"},{default:t(()=>[e(qe,{modelValue:M.quarterlyPrice,"onUpdate:modelValue":a[7]||(a[7]=_=>M.quarterlyPrice=_),precision:2,min:0},null,8,["modelValue"])]),_:1}),e(we,{label:"年卡价格"},{default:t(()=>[e(qe,{modelValue:M.yearlyPrice,"onUpdate:modelValue":a[8]||(a[8]=_=>M.yearlyPrice=_),precision:2,min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),e(at,{label:"安全设置"},{default:t(()=>[l("div",or,[e(Re,{title:"安全功能已启用",type:"success",closable:!1,"show-icon":""},{default:t(()=>[a[74]||(a[74]=l("p",null,"系统已集成多层安全保护功能：",-1)),a[75]||(a[75]=l("ul",null,[l("li",null,"密码哈希加密 (PBKDF2)"),l("li",null,"登录限流机制"),l("li",null,"输入数据验证和过滤"),l("li",null,"CSRF保护"),l("li",null,"操作日志记录")],-1)),l("div",nr,[e(oe,{type:"primary",onClick:a[9]||(a[9]=_=>G.value="security")},{default:t(()=>a[73]||(a[73]=[r(" 查看安全监控 ",-1)])),_:1,__:[73]})])]),_:1})])]),_:1})]),_:1}),l("div",sr,[e(oe,{type:"primary",onClick:Ye},{default:t(()=>a[76]||(a[76]=[r(" 保存设置 ",-1)])),_:1,__:[76]}),e(oe,{onClick:ke},{default:t(()=>a[77]||(a[77]=[r(" 重置设置 ",-1)])),_:1,__:[77]})])]),_:1})])):q("",!0)]),_:1})]),_:1})]),_:1}),e(Ue,{modelValue:j.value,"onUpdate:modelValue":a[15]||(a[15]=_=>j.value=_),title:"添加用户",width:"500px"},{footer:t(()=>[e(oe,{onClick:a[14]||(a[14]=_=>j.value=!1)},{default:t(()=>a[78]||(a[78]=[r("取消",-1)])),_:1,__:[78]}),e(oe,{type:"primary",onClick:ue},{default:t(()=>a[79]||(a[79]=[r("确认",-1)])),_:1,__:[79]})]),default:t(()=>[e(Ge,{model:W,"label-width":"80px"},{default:t(()=>[e(we,{label:"用户名"},{default:t(()=>[e(Je,{modelValue:W.username,"onUpdate:modelValue":a[10]||(a[10]=_=>W.username=_)},null,8,["modelValue"])]),_:1}),e(we,{label:"邮箱"},{default:t(()=>[e(Je,{modelValue:W.email,"onUpdate:modelValue":a[11]||(a[11]=_=>W.email=_)},null,8,["modelValue"])]),_:1}),e(we,{label:"密码"},{default:t(()=>[e(Je,{modelValue:W.password,"onUpdate:modelValue":a[12]||(a[12]=_=>W.password=_),type:"password"},null,8,["modelValue"])]),_:1}),e(we,{label:"角色"},{default:t(()=>[e(Te,{modelValue:W.role,"onUpdate:modelValue":a[13]||(a[13]=_=>W.role=_)},{default:t(()=>[e(Le,{label:"普通用户",value:"user"}),e(Le,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(Ue,{modelValue:K.value,"onUpdate:modelValue":a[22]||(a[22]=_=>K.value=_),title:"批量生成卡密",width:"600px"},{footer:t(()=>[e(oe,{onClick:a[21]||(a[21]=_=>K.value=!1)},{default:t(()=>a[82]||(a[82]=[r("取消",-1)])),_:1,__:[82]}),e(oe,{type:"primary",onClick:re,disabled:!E.value},{default:t(()=>a[83]||(a[83]=[r(" 确认生成 ",-1)])),_:1,__:[83]},8,["disabled"])]),default:t(()=>[e(Ge,{model:i,"label-width":"100px"},{default:t(()=>[e(we,{label:"选择专区",required:""},{default:t(()=>[l("div",rr,[e(Te,{modelValue:i.zoneId,"onUpdate:modelValue":a[16]||(a[16]=_=>i.zoneId=_),placeholder:"请选择专区",onChange:se,style:{flex:"1"}},{default:t(()=>[(y(!0),S(Be,null,je(s.value,_=>(y(),Ve(Le,{key:_.id,label:_.name+(_.isDetected?` (检测到${_.cardCount}张卡密)`:" (默认)"),value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(oe,{onClick:ye,loading:k.value,title:"重新检测现有专区和商品",size:"default"},{default:t(()=>[e(L,null,{default:t(()=>[e(ut)]),_:1}),a[80]||(a[80]=r(" 刷新检测 ",-1))]),_:1,__:[80]},8,["loading"])])]),_:1}),e(we,{label:"选择商品",required:""},{default:t(()=>[e(Te,{modelValue:i.productId,"onUpdate:modelValue":a[17]||(a[17]=_=>i.productId=_),placeholder:"请先选择专区",disabled:!i.zoneId,onChange:Ce,style:{width:"100%"}},{default:t(()=>[(y(!0),S(Be,null,je(N.value,_=>(y(),Ve(Le,{key:_.id,label:_.name+" (¥"+_.price+")"+(_.isDetected?` - 检测到${_.cardCount}张卡密`:" - 默认"),value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),e(we,{label:"卡密类型",required:""},{default:t(()=>[e(Te,{modelValue:i.cardTypeId,"onUpdate:modelValue":a[18]||(a[18]=_=>i.cardTypeId=_),placeholder:"请先选择商品",disabled:!i.productId||!ne.value.length,style:{width:"100%"}},{default:t(()=>[(y(!0),S(Be,null,je(ne.value,_=>(y(),Ve(Le,{key:_.id,label:`${_.name} (${_.duration}) - 库存: ${Se(_.id)}张`,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),i.productId&&!ne.value.length?(y(),S("div",ir,[e(ot,{type:"warning",size:"small"},{default:t(()=>a[81]||(a[81]=[r("该商品尚未配置卡密类型，请前往专区管理中配置",-1)])),_:1,__:[81]})])):q("",!0)]),_:1}),e(we,{label:"生成数量"},{default:t(()=>[e(qe,{modelValue:i.quantity,"onUpdate:modelValue":a[19]||(a[19]=_=>i.quantity=_),min:1,max:1e3,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(we,{label:"面值"},{default:t(()=>[e(Je,{modelValue:i.value,"onUpdate:modelValue":a[20]||(a[20]=_=>i.value=_),placeholder:"请输入面值金额",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),i.zoneId&&i.productId?(y(),Ve(we,{key:0},{default:t(()=>[l("div",ur,[e(Re,{title:Y(),type:"info",closable:!1},null,8,["title"])])]),_:1})):q("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(Ue,{modelValue:P.value,"onUpdate:modelValue":a[32]||(a[32]=_=>P.value=_),title:"导入卡密",width:"700px"},{footer:t(()=>[e(oe,{onClick:kt},{default:t(()=>a[99]||(a[99]=[r("取消",-1)])),_:1,__:[99]}),e(oe,{type:"primary",onClick:St,loading:h.value,disabled:V.value.length===0},{default:t(()=>a[100]||(a[100]=[r(" 确认导入 ",-1)])),_:1,__:[100]},8,["loading","disabled"])]),default:t(()=>[l("div",dr,[l("div",cr,[e(bt,{modelValue:le.value,"onUpdate:modelValue":a[23]||(a[23]=_=>le.value=_),onChange:Tt},{default:t(()=>[e(yt,{label:"file"},{default:t(()=>a[84]||(a[84]=[r("文件导入",-1)])),_:1,__:[84]}),e(yt,{label:"manual"},{default:t(()=>a[85]||(a[85]=[r("手动输入",-1)])),_:1,__:[85]})]),_:1},8,["modelValue"])]),le.value==="file"?(y(),S("div",mr,[e(Re,{title:"文件导入说明",type:"info",closable:!1,"show-icon":""},{default:t(()=>a[86]||(a[86]=[l("div",{class:"import-tips"},[l("p",null,"支持CSV格式文件导入，文件应包含以下列："),l("ul",null,[l("li",null,[l("strong",null,"卡号"),r("（必填）：唯一的卡密标识")]),l("li",null,[l("strong",null,"类型"),r("（必填）：月卡、季卡、年卡")]),l("li",null,[l("strong",null,"面值"),r("（必填）：如 ¥29.90")]),l("li",null,[l("strong",null,"状态"),r("（可选）：未使用、已购买、已激活、已过期")]),l("li",null,[l("strong",null,"专区ID"),r("（可选）：专区标识，如果不填写将使用默认专区")]),l("li",null,[l("strong",null,"专区名称"),r("（可选）：专区名称")]),l("li",null,[l("strong",null,"商品ID"),r("（可选）：商品标识，如果不填写将使用默认商品")]),l("li",null,[l("strong",null,"商品名称"),r("（可选）：商品名称")]),l("li",null,[l("strong",null,"创建时间"),r("（可选）：YYYY-MM-DD HH:mm:ss")]),l("li",null,[l("strong",null,"使用时间"),r("（可选）：YYYY-MM-DD HH:mm:ss")])])],-1)])),_:1}),l("div",pr,[e(pt,{ref_key:"uploadRef",ref:T,"auto-upload":!1,"show-file-list":!0,"on-change":z,"before-remove":Qe,accept:".csv",drag:""},{tip:t(()=>a[87]||(a[87]=[l("div",{class:"el-upload__tip"}," 只能上传CSV文件，且不超过2MB ",-1)])),default:t(()=>[e(L,{class:"el-icon--upload"},{default:t(()=>[e(F(Ot))]),_:1}),a[88]||(a[88]=l("div",{class:"el-upload__text"},[r(" 将CSV文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1,__:[88]},512)])])):q("",!0),le.value==="manual"?(y(),S("div",_r,[e(Re,{title:"手动输入说明",type:"info",closable:!1,"show-icon":""},{default:t(()=>a[89]||(a[89]=[l("p",null,[l("strong",null,"简化输入模式"),r("：每行只需要输入卡号即可，其他信息通过下方选择器设定")],-1),l("p",null,[l("strong",null,"示例"),r("：")],-1),l("p",null,[r("CARD123456789"),l("br"),r("CARD987654321"),l("br"),r("CARD555666777")],-1),l("p",null,"卡密类型、面值、专区、商品等信息将使用下方的默认设置统一应用",-1)])),_:1}),l("div",fr,[e(Ge,{model:R,"label-width":"100px"},{default:t(()=>[e(_e,{gutter:20,style:{"margin-bottom":"20px"}},{default:t(()=>[e(J,{span:6},{default:t(()=>[e(we,{label:"卡密类型",required:""},{default:t(()=>[e(Te,{modelValue:R.cardType,"onUpdate:modelValue":a[24]||(a[24]=_=>R.cardType=_),placeholder:"选择类型",style:{width:"100%"}},{default:t(()=>[e(Le,{label:"月卡",value:"monthly"}),e(Le,{label:"季卡",value:"quarterly"}),e(Le,{label:"年卡",value:"yearly"}),e(Le,{label:"体验卡",value:"trial"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(J,{span:6},{default:t(()=>[e(we,{label:"卡密面值",required:""},{default:t(()=>[e(Je,{modelValue:R.cardValue,"onUpdate:modelValue":a[25]||(a[25]=_=>R.cardValue=_),placeholder:"如：¥29.90"},null,8,["modelValue"])]),_:1})]),_:1}),e(J,{span:6},{default:t(()=>[e(we,{label:"初始状态"},{default:t(()=>[e(Te,{modelValue:R.cardStatus,"onUpdate:modelValue":a[26]||(a[26]=_=>R.cardStatus=_),placeholder:"选择状态",style:{width:"100%"}},{default:t(()=>[e(Le,{label:"未使用",value:"unused"}),e(Le,{label:"已购买",value:"sold"}),e(Le,{label:"已激活",value:"used"}),e(Le,{label:"已过期",value:"expired"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(J,{span:6},{default:t(()=>[e(we,{label:"生成数量"},{default:t(()=>[e(qe,{modelValue:R.autoGenerate,"onUpdate:modelValue":a[27]||(a[27]=_=>R.autoGenerate=_),min:0,max:1e3,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"]),a[90]||(a[90]=l("div",{style:{"font-size":"12px",color:"#999","margin-top":"2px"}},"0表示手动输入",-1))]),_:1,__:[90]})]),_:1})]),_:1}),R.autoGenerate>0?(y(),S("div",gr,[e(Re,{title:"自动生成模式",type:"success",closable:!1,"show-icon":"",style:{"margin-bottom":"15px"}},{default:t(()=>[a[91]||(a[91]=r(" 将自动生成 ",-1)),l("strong",null,d(R.autoGenerate),1),a[92]||(a[92]=r(" 个卡号，格式：CARD + 时间戳 + 随机数 ",-1))]),_:1})])):(y(),S("div",vr,[e(we,{label:"批量输入"},{default:t(()=>[e(Je,{modelValue:R.cardData,"onUpdate:modelValue":a[28]||(a[28]=_=>R.cardData=_),type:"textarea",rows:8,placeholder:`每行输入一个卡号，如：
CARD123456789
CARD987654321
CARD555666777

留空将自动生成卡号`,"show-word-limit":""},null,8,["modelValue"])]),_:1})])),e(we,null,{default:t(()=>[e(oe,{type:"primary",onClick:lt},{default:t(()=>[e(L,null,{default:t(()=>[e(F(il))]),_:1}),r(" "+d(R.autoGenerate>0?"生成卡密":"解析数据"),1)]),_:1}),e(oe,{onClick:rt},{default:t(()=>[e(L,null,{default:t(()=>[e(F(ft))]),_:1}),a[93]||(a[93]=r(" 清空 ",-1))]),_:1,__:[93]})]),_:1})]),_:1},8,["model"])])])):q("",!0),l("div",yr,[l("div",br,[e(_e,{gutter:20},{default:t(()=>[e(J,{span:12},{default:t(()=>[e(we,{label:"默认专区"},{default:t(()=>[l("div",wr,[e(Te,{modelValue:B.defaultZoneId,"onUpdate:modelValue":a[29]||(a[29]=_=>B.defaultZoneId=_),placeholder:"选择默认专区",onChange:x,style:{flex:"1"}},{default:t(()=>[(y(!0),S(Be,null,je(s.value,_=>(y(),Ve(Le,{key:_.id,label:_.name+(_.isDetected?` (${_.cardCount}张)`:" (默认)"),value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(oe,{onClick:ye,loading:k.value,title:"重新检测",size:"small"},{default:t(()=>[e(L,null,{default:t(()=>[e(ut)]),_:1})]),_:1},8,["loading"])])]),_:1})]),_:1}),e(J,{span:12},{default:t(()=>[e(we,{label:"默认商品"},{default:t(()=>[e(Te,{modelValue:B.defaultProductId,"onUpdate:modelValue":a[30]||(a[30]=_=>B.defaultProductId=_),placeholder:"选择默认商品",disabled:!B.defaultZoneId,style:{width:"100%"}},{default:t(()=>[(y(!0),S(Be,null,je(c.value,_=>(y(),Ve(Le,{key:_.id,label:_.name+" (¥"+_.price+")"+(_.isDetected?` - ${_.cardCount}张`:" - 默认"),value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(Re,{title:"说明：导入的卡密如果没有指定专区和商品信息，将使用上面选择的默认值",type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"15px"}})]),e(m,{modelValue:H.overwriteExisting,"onUpdate:modelValue":a[31]||(a[31]=_=>H.overwriteExisting=_)},{default:t(()=>a[94]||(a[94]=[r(" 覆盖已存在的卡密（相同卡号） ",-1)])),_:1,__:[94]},8,["modelValue"])]),l("div",Vr,[e(pt,{ref_key:"uploadRef",ref:T,"auto-upload":!1,"show-file-list":!0,"on-change":z,"before-remove":Qe,accept:".csv",drag:""},{tip:t(()=>a[95]||(a[95]=[l("div",{class:"el-upload__tip"}," 只能上传CSV文件，且不超过2MB ",-1)])),default:t(()=>[e(L,{class:"el-icon--upload"},{default:t(()=>[e(F(Ot))]),_:1}),a[96]||(a[96]=l("div",{class:"el-upload__text"},[r(" 将CSV文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1,__:[96]},512)]),V.value.length>0?(y(),S("div",hr,[a[97]||(a[97]=l("h4",null,"预览数据（前10条）",-1)),e(Oe,{data:V.value.slice(0,10),border:"",style:{width:"100%"}},{default:t(()=>[e($e,{prop:"cardNumber",label:"卡号",width:"150"}),e($e,{prop:"cardType",label:"类型",width:"80"}),e($e,{prop:"value",label:"面值",width:"100"}),e($e,{prop:"status",label:"状态",width:"80"},{default:t(_=>[e(he,{type:Ne(_.row.status),size:"small"},{default:t(()=>[r(d(De(_.row.status)),1)]),_:2},1032,["type"])]),_:1}),e($e,{prop:"createTime",label:"创建时间"})]),_:1},8,["data"]),l("p",Cr," 共 "+d(V.value.length)+" 条数据待导入 ",1)])):q("",!0),D.value?(y(),S("div",$r,[e(Re,{title:D.value.success?"导入成功":"导入失败",type:D.value.success?"success":"error",closable:!1,"show-icon":""},{default:t(()=>[l("p",null,d(D.value.message),1),D.value.data&&D.value.data.errors.length>0?(y(),S("div",Ir,[a[98]||(a[98]=l("p",null,[l("strong",null,"错误详情：")],-1)),l("ul",null,[(y(!0),S(Be,null,je(D.value.data.errors,_=>(y(),S("li",{key:_},d(_),1))),128))])])):q("",!0)]),_:1},8,["title","type"])])):q("",!0)])]),_:1},8,["modelValue"])])}}},Dr=Xe(Sr,[["__scopeId","data-v-b8366ef9"]]);export{Dr as default};
